<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: PlotMaker.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>PlotMaker.cpp</h1><div class="fragment"><pre>00001 
00002 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00003 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
00005 <span class="preprocessor">#include &lt;string&gt;</span>
00006 <span class="preprocessor">#include &lt;fstream&gt;</span>
00007 <span class="preprocessor">#include &lt;list&gt;</span>
00008 <span class="preprocessor">#include &lt;cmath&gt;</span>
00009 <span class="preprocessor">#include &lt;gsl/gsl_math.h&gt;</span>
00010 <span class="preprocessor">#include &lt;plot.h&gt;</span>
00011 
00012 <span class="preprocessor">#include  "PlotMaker.h"</span>
00013 <span class="preprocessor">#include "ImageAnalyzer.h"</span>
00014 <span class="preprocessor">#include "Camera.h"</span>
00015 <span class="preprocessor">#include "PedestalFinder.h"</span>
00016 <span class="preprocessor">#include "MuonImageAnalyzer.h"</span>
00017 <span class="preprocessor">#include "StarCatalog.h"</span>
00018 <span class="preprocessor">#include "Types.h"</span>
00019 <span class="preprocessor">#include "AngleConverters.h"</span>
00020 
00021 
00022 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00023 
00024 PlotMaker::PlotMaker( string type, string filename,
00025                       <span class="keywordtype">double</span> minx,<span class="keywordtype">double</span> miny, <span class="keywordtype">double</span> maxx, <span class="keywordtype">double</span> maxy ) {
00026     
00027     PlotState s;
00028     
00029     _minx=_maxx=_miny=_maxy=0;
00030     _pageminx = minx;
00031     _pagemaxx = maxx;
00032     _pageminy = miny; 
00033     _pagemaxy = maxy;
00034     _keyoffset = 0.2;
00035     _keywidth = 0.1;
00036     _numkeycolors = 20;
00037     _pixelscale = -1;
00038     _maxmagnitude = 10.0;
00039     _ticlevel = 0;
00040     _labeloffset=0.1;
00041     _titleoffset=0.12;
00042     _subtitleoffset=0.03;
00043     _ticmarksize=0.06;
00044     _scalefactor = 1.0; 
00045 
00046     s.use_inward_tics = <span class="keyword">true</span>;
00047     s.contourcolor = <span class="stringliteral">"LightGray"</span>;
00048     s.contourlinestyle = LINE_SOLID;
00049     s.ticcolor = <span class="stringliteral">"black"</span>;
00050     s.labelcolor=<span class="stringliteral">"white"</span>;
00051     s.contourwidth = 0.009;
00052     s.markertype = 1;
00053     s.markersize = 0.2;
00054     s.markercolor = <span class="stringliteral">"white"</span>;
00055     s.labelangle = 0.0;
00056     s.labelsize = 0.1;
00057     s.autoscale = <span class="keyword">true</span>;
00058 
00059     _state.push(s);
00060     
00061     setColorMap( COLORMAP_BLUES );
00062 
00063     plotter_params = pl_newplparams();
00064     pl_setplparam( plotter_params, <span class="stringliteral">"PAGESIZE"</span>, (<span class="keywordtype">char</span>*)<span class="stringliteral">"letter"</span>);
00065     pl_setplparam( plotter_params, <span class="stringliteral">"BITMAPSIZE"</span>, (<span class="keywordtype">char</span>*)<span class="stringliteral">"640x640"</span>);
00066     pl_setplparam( plotter_params, <span class="stringliteral">"USE_DOUBLE_BUFFERING"</span>, (<span class="keywordtype">void</span>*)<span class="stringliteral">"yes"</span>);    
00067 
00068     <span class="keywordflow">if</span> (type==<span class="stringliteral">"X"</span>) 
00069         _fp = stdout;
00070     <span class="keywordflow">else</span>
00071         _fp = fopen( filename.c_str(), <span class="stringliteral">"w"</span> );
00072     
00073     <span class="keywordflow">if</span> ((plotter = pl_newpl_r( type.c_str(), stdin, _fp, stderr,
00074                                plotter_params)) == NULL) {
00075         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Couldn't create plotter"</span>);
00076     }
00077     
00078     pl_openpl_r( plotter );
00079     pl_fspace_r( plotter, _pageminx, _pageminy, _pagemaxx, _pagemaxy); 
00080     pl_flinewidth_r( plotter, 0.25); <span class="comment">// line thickness in user coordinates</span>
00081     pl_pencolorname_r(plotter, <span class="stringliteral">"black"</span>); <span class="comment">// line color defaults</span>
00082     pl_erase_r( plotter );      <span class="comment">// erase Plotter's graphics display</span>
00083     pl_fmove_r(plotter ,0.0, 0.0); <span class="comment">// position the graphics cursor</span>
00084     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00085     pl_ffontsize_r( plotter, _scalefactor*0.15);
00086     
00087 
00088 }
00089 
00090 
00096 <span class="keywordtype">void</span> 
00097 <a class="code" href="classPlotMaker.html#a11">PlotMaker::</a>
<a name="l00098"></a><a class="code" href="classPlotMaker.html#a11">00098</a> <a class="code" href="classPlotMaker.html#a11">plotAxes</a>() {
00099 
00100     <span class="keywordtype">double</span> niceminx, niceminy, nicemaxx, nicemaxy;
00101     <span class="keywordtype">int</span> niceticlevel;
00102     <span class="keywordtype">double</span> p;
00103     <span class="keywordtype">double</span> x,y;
00104 
00105     pl_savestate_r( plotter );
00106 
00107     pl_pentype_r( plotter, 1);
00108     pl_filltype_r( plotter, 0);
00109     pl_flinewidth_r( plotter, 0.02*_scalefactor );
00110 
00111     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00112     pl_ffontsize_r( plotter, _scalefactor*0.12);
00113     
00114     <span class="comment">// plot some nice major tic marks</span>
00115 
00116     <span class="comment">//    niceticlevel = (int) log10(_maxx-_minx);</span>
00117     <span class="comment">//    _ticlevel = </span>
00118 
00119     p = pow( 10.0, -_ticlevel );
00120     niceminx =  ceil(_minx * p)/p;
00121     niceminy =  ceil(_miny * p)/p;
00122     nicemaxy = floor(_maxy * p)/p;
00123     nicemaxx = floor(_maxx * p)/p; 
00124 
00125     <span class="keywordflow">for</span> ( x = niceminx; x&lt;=nicemaxx; x+=1.0/p ) {
00126         plotXTicAt( x );
00127     }
00128 
00129     <span class="keywordflow">for</span> ( y = niceminy; y&lt;=nicemaxy; y+=1.0/p ) {
00130         plotYTicAt( y );
00131     }
00132 
00133     <span class="comment">// plot the minor tic marks (at one higher ticlevel magnitude)</span>
00134 
00135     p = pow( 10.0, -(_ticlevel-1) );
00136     niceminx =  ceil(_minx * p)/p;
00137     niceminy =  ceil(_miny * p)/p;
00138     nicemaxy = floor(_maxy * p)/p;
00139     nicemaxx = floor(_maxx * p)/p; 
00140    
00141     <span class="keywordflow">for</span> ( x = niceminx; x&lt;=nicemaxx; x+=1.0/p ) {
00142         plotXMinorTicAt( x );
00143     }
00144 
00145     <span class="keywordflow">for</span> ( y = niceminy; y&lt;=nicemaxy; y+=1.0/p ) {
00146         plotYMinorTicAt( y );
00147     }
00148 
00149 
00150     <span class="comment">// plot the bounding box</span>
00151     pl_pentype_r( plotter, 1);
00152     pl_filltype_r( plotter, 0);
00153     pl_flinewidth_r( plotter, 0.02 );
00154     pl_fbox_r( plotter, _minx, _miny, _maxx, _maxy );
00155 
00156 
00157 
00158     pl_restorestate_r( plotter );
00159 
00160 }
00161 
00162 
00163 <span class="keywordtype">void</span> 
00164 PlotMaker::
00165 plotXTicAt( <span class="keywordtype">double</span> x ) {
00166 
00167     <span class="keywordtype">char</span> text[64];
00168     <span class="keywordtype">double</span> ticoffs;
00169 
00170     pl_flinewidth_r( plotter, 0.02*_scalefactor );
00171 
00172     <span class="keywordflow">if</span> ( _state.top().use_inward_tics == <span class="keyword">true</span> )
00173         ticoffs = -_ticmarksize*_scalefactor;
00174     <span class="keywordflow">else</span> 
00175         ticoffs =  _ticmarksize*_scalefactor;
00176         
00177     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
00178     pl_fline_r( plotter, x ,_maxy,  x,_maxy + ticoffs ) ;
00179     pl_fline_r( plotter, x ,_miny,  x,_miny - ticoffs ) ;
00180     pl_pencolorname_r( plotter, <span class="stringliteral">"black"</span> );
00181 
00182     pl_fmove_r( plotter, x, _miny - _labeloffset );
00183     sprintf( text, <span class="stringliteral">"%.1f"</span>, x );
00184     pl_alabel_r( plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'t'</span>,  text );
00185 
00186 }
00187 
00188 <span class="keywordtype">void</span> 
00189 PlotMaker::
00190 plotYTicAt( <span class="keywordtype">double</span> y ){
00191 
00192     <span class="keywordtype">char</span> text[64];
00193     <span class="keywordtype">double</span> ticoffs;
00194 
00195     pl_flinewidth_r( plotter, 0.02*_scalefactor );
00196 
00197     <span class="keywordflow">if</span> (_state.top().use_inward_tics == <span class="keyword">true</span> )
00198         ticoffs = -_ticmarksize*_scalefactor;
00199     <span class="keywordflow">else</span> 
00200         ticoffs =  _ticmarksize*_scalefactor;
00201 
00202     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
00203     pl_fline_r( plotter, _maxx , y,  _maxx + ticoffs, y ) ;
00204     pl_fline_r( plotter, _minx , y,  _minx - ticoffs, y ) ;
00205     pl_pencolorname_r( plotter, <span class="stringliteral">"black"</span> );
00206 
00207     pl_fmove_r( plotter, _minx - _labeloffset, y );
00208     sprintf( text, <span class="stringliteral">"%.1f"</span>, y );
00209     pl_alabel_r( plotter,<span class="charliteral">'r'</span>,<span class="charliteral">'c'</span>,  text );
00210    
00211 
00212 }
00213 
00214 <span class="keywordtype">void</span> 
00215 PlotMaker::
00216 plotXMinorTicAt( <span class="keywordtype">double</span> x ) {
00217 
00218     <span class="keywordtype">double</span> ticoffs;
00219 
00220     pl_flinewidth_r( plotter, 0.01 );
00221 
00222     <span class="keywordflow">if</span> ( _state.top().use_inward_tics == <span class="keyword">true</span> )
00223         ticoffs = - _ticmarksize/1.5 *_scalefactor;
00224     <span class="keywordflow">else</span> 
00225         ticoffs = _ticmarksize/1.5 *_scalefactor;
00226         
00227     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
00228     pl_fline_r( plotter, x ,_maxy,  x,_maxy + ticoffs ) ;
00229     pl_fline_r( plotter, x ,_miny,  x,_miny - ticoffs ) ;
00230     pl_pencolorname_r( plotter, <span class="stringliteral">"black"</span> );
00231 }
00232 
00233 <span class="keywordtype">void</span> 
00234 PlotMaker::
00235 plotYMinorTicAt( <span class="keywordtype">double</span> y ){
00236 
00237     <span class="keywordtype">double</span> ticoffs;
00238 
00239     pl_flinewidth_r( plotter, 0.01 );
00240 
00241     <span class="keywordflow">if</span> (_state.top().use_inward_tics == <span class="keyword">true</span> )
00242         ticoffs = - _ticmarksize/1.5 *_scalefactor;
00243     <span class="keywordflow">else</span> 
00244         ticoffs = _ticmarksize/1.5 *_scalefactor;
00245 
00246     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
00247     pl_fline_r( plotter, _maxx , y,  _maxx + ticoffs, y ) ;
00248     pl_fline_r( plotter, _minx , y,  _minx - ticoffs, y ) ;
00249     pl_pencolorname_r( plotter, <span class="stringliteral">"black"</span> );
00250 
00251 }
00252 
00253 
00254 <span class="keywordtype">void</span>
00255 PlotMaker:: 
00256 plotTitle( std::string title ) {
00257 
00258     pl_savestate_r( plotter );
00259 
00260     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00261     pl_ffontsize_r( plotter, _scalefactor*0.15);    
00262 
00263     pl_fmove_r( plotter, (_minx+_maxx)/2.0, _maxy+_titleoffset );
00264     pl_alabel_r( plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'b'</span>, title.c_str() );
00265 
00266     pl_restorestate_r(  plotter );
00267 
00268 }
00269 
00270 <span class="keywordtype">void</span>
00271 PlotMaker:: 
00272 plotSubtitle( std::string title ) {
00273 
00274     pl_savestate_r( plotter );
00275 
00276     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00277     pl_ffontsize_r( plotter, _scalefactor*0.09);    
00278 
00279     pl_fmove_r( plotter, (_minx+_maxx)/2.0, _maxy+_subtitleoffset );
00280     pl_alabel_r( plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'b'</span>, title.c_str() );
00281 
00282     pl_restorestate_r(  plotter );
00283 
00284 }
00285 
00286 <span class="keywordtype">void</span> 
00287 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
00288 <a class="code" href="classPlotMaker.html#a25">plot</a>( <a class="code" href="classImage2D.html">Image2D</a> &amp;im2d ) {
00289 
00290     <span class="keywordtype">double</span> minx = im2d.<a class="code" href="classImage2D.html#a4">getMinX</a>();
00291     <span class="keywordtype">double</span> miny = im2d.<a class="code" href="classImage2D.html#a5">getMinY</a>();
00292     <span class="keywordtype">double</span> maxx = im2d.<a class="code" href="classImage2D.html#a6">getMaxX</a>();
00293     <span class="keywordtype">double</span> maxy = im2d.<a class="code" href="classImage2D.html#a7">getMaxY</a>();
00294     <span class="keywordtype">double</span> x1, y1, x2, y2;
00295     <span class="comment">//     double boxsizex = (maxx-minx)/(double)im2d.getXDim();</span>
00296     <span class="comment">//     double boxsizey = (maxy-miny)/(double)im2d.getYDim();</span>
00297     <span class="keywordtype">double</span> boxsizex = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>(1)- im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>(0);
00298     <span class="keywordtype">double</span> boxsizey = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>(1)- im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>(0);
00299     <span class="keywordtype">double</span> min; 
00300     <span class="keywordtype">double</span> max; 
00301     <span class="keywordtype">double</span> colorlevel;
00302     <span class="keywordtype">int</span>  red, green, blue;
00303 
00304     <span class="keywordflow">if</span> (_state.top().autoscale == <span class="keyword">true</span>) {
00305         min = im2d.<a class="code" href="classImage2D.html#a23">minValue</a>();
00306         max = im2d.<a class="code" href="classImage2D.html#a24">maxValue</a>();
00307     }
00308     <span class="keywordflow">else</span> {
00309         min = _state.top().colorscale_lower;
00310         max = _state.top().colorscale_upper;
00311     }
00312 
00313     pl_savestate_r( plotter );
00314 
00315     pl_filltype_r( plotter, 1 );
00316     pl_pentype_r(  plotter, 0 );
00317 
00318     <span class="comment">// plot the image as a grid of boxes:</span>
00319 
00320     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; im2d.<a class="code" href="classImage2D.html#a21">getXDim</a>(); i++) {
00321         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt; im2d.<a class="code" href="classImage2D.html#a22">getYDim</a>(); j++) {
00322 
00323             x1 = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>(i) - boxsizex/2.0;
00324             y1 = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>(j) - boxsizey/2.0;
00325             x2 = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>(i) + boxsizex/2.0;
00326             y2 = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>(j) + boxsizey/2.0;
00327 
00328             colorlevel = ((im2d.<a class="code" href="classImage2D.html#a14">getPixel</a>(i,j)-min) / fabs(max-min));
00329 
00330             <a class="code" href="classPlotMaker.html#a32">getMappedColor</a>( colorlevel, red, green, blue );
00331   
00332             pl_fillcolor_r(  plotter, red, green, blue );
00333             pl_fbox_r(  plotter, x1,y1,x2,y2 );
00334 
00335         }
00336     }
00337 
00338     <span class="comment">// now plot a colormap key</span>
00339 
00340     <span class="keywordtype">double</span> h = (maxy-miny)/(<span class="keywordtype">double</span>)_numkeycolors;
00341     x1 = maxx + _keyoffset;
00342     x2 = x1 + _keywidth;
00343     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;_numkeycolors; i++) {
00344 
00345         colorlevel = (<span class="keywordtype">double</span>)i/(<span class="keywordtype">double</span>)_numkeycolors;
00346         
00347         <a class="code" href="classPlotMaker.html#a32">getMappedColor</a>( colorlevel, red, green, blue );
00348         pl_fillcolor_r( plotter, red, green, blue );
00349 
00350         y1 = miny + i*h;
00351         y2 = miny + (i+1)*h;
00352 
00353         pl_fbox_r( plotter, x1,y1 ,x2,y2 );
00354 
00355     }
00356 
00357     <span class="comment">// plot the labels for the colormap</span>
00358 
00359     <span class="keywordtype">char</span> text[64];
00360 
00361     pl_filltype_r( plotter, 0 );
00362     pl_pentype_r(  plotter, 1 );
00363     pl_flinewidth_r( plotter,0.02 ); 
00364  
00365     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00366     pl_ffontsize_r( plotter, _scalefactor*0.1 );        
00367 
00368     sprintf(text, <span class="stringliteral">"%.1f"</span>, min);
00369     pl_fmove_r( plotter, x2+_ticmarksize, miny );
00370     pl_alabel_r( plotter, <span class="charliteral">'l'</span>,<span class="charliteral">'b'</span>, text );
00371 
00372     sprintf(text, <span class="stringliteral">"%.1f"</span>, max);
00373     pl_fmove_r( plotter, x2+_ticmarksize, maxy );
00374     pl_alabel_r( plotter, <span class="charliteral">'l'</span>,<span class="charliteral">'t'</span>, text );
00375 
00376 
00377 
00378     <span class="keywordflow">if</span> (max&gt;0 &amp;&amp; min&lt;0) {
00379 
00380         y1 = miny +  fabs(min/(max-min)) * (maxy-miny);
00381         pl_pencolorname_r( plotter, <span class="stringliteral">"black"</span> );
00382         pl_fline_r( plotter, x1 -_ticmarksize, y1, x2+_ticmarksize, y1 );
00383         pl_fmove_r( plotter, x2+_ticmarksize, y1 );
00384         pl_alabel_r( plotter, <span class="charliteral">'l'</span>,<span class="charliteral">'c'</span>, <span class="stringliteral">" 0"</span> );
00385             
00386     }
00387 
00388     pl_fbox_r( plotter, x1, miny ,x2, maxy );
00389 
00390     pl_restorestate_r(  plotter );
00391 
00392 }
00393 
00394 
00395 <span class="keywordtype">void</span> 
00396 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
00397 <a class="code" href="classPlotMaker.html#a25">plot</a>( <a class="code" href="classCamera.html">Camera</a> &amp;cam, <span class="keyword">const</span> Array_t &amp;image, <span class="keyword">const</span> vector&lt;Pedestal&gt; &amp;peds,
00398       vector&lt;int&gt; &amp;cleanpixels, CameraPlotType plottype ) {
00399 
00400     <span class="keywordtype">double</span> qr;
00401     <span class="keywordtype">char</span> text[128];
00402     Array_t &amp;xc = cam.<a class="code" href="classCamera.html#a13">xCoords</a>();
00403     Array_t &amp;yc = cam.<a class="code" href="classCamera.html#a14">yCoords</a>();
00404     Array_t &amp;rad  = cam.<a class="code" href="classCamera.html#a15">radii</a>();
00405     <span class="keywordtype">double</span> max;
00406     <span class="keywordtype">double</span> value;
00407     <span class="keyword">register</span> <span class="keywordtype">int</span> i;
00408 
00409     <span class="keywordflow">switch</span> (plottype) {
00410     <span class="keywordflow">case</span> CAMERA_IMAGE:
00411         max = image.max();
00412         <span class="keywordflow">break</span>;
00413 
00414     <span class="keywordflow">case</span> CAMERA_PEDS:
00415         max = -1e10;
00416         <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++) {
00417             <span class="keywordflow">if</span> (peds[i].pedestal &gt; max)
00418                 max = peds[i].pedestal;
00419         }
00420         <span class="keywordflow">break</span>;
00421 
00422     <span class="keywordflow">case</span> CAMERA_PEDDISPS:
00423         max = -1e10;
00424         <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++) {
00425             <span class="keywordflow">if</span> (peds[i].dispersion &gt; max)
00426                 max = peds[i].dispersion;
00427         }
00428         <span class="keywordflow">break</span>;
00429 
00430     <span class="keywordflow">default</span>:
00431         max = image.max();
00432         <span class="keywordflow">break</span>;
00433     }
00434 
00435     pl_savestate_r( plotter );
00436     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00437     pl_ffontsize_r(plotter, _scalefactor*0.07);
00438 
00439     <span class="comment">// ===============================================================</span>
00440     <span class="comment">// Set View parameters</span>
00441 
00442     pl_flinewidth_r( plotter, 0.005);  <span class="comment">// line thickness in user coords </span>
00443     pl_bgcolorname_r(plotter, <span class="stringliteral">"white"</span>); <span class="comment">// background color for the window</span>
00444     pl_pencolorname_r( plotter, <span class="stringliteral">"grey60"</span>); 
00445 
00446     <span class="comment">// ===============================================================</span>
00447     <span class="comment">// draw camera</span>
00448 
00449     pl_filltype_r(plotter, 0);                      <span class="comment">// don't fill</span>
00450     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a9">getNumPixels</a>(); i++) {
00451         pl_fellipse_r(plotter, xc[i], yc[i], rad[i], rad[i],0);
00452     }
00453 
00454     <span class="comment">// ===============================================================</span>
00455     <span class="comment">// draw signal</span>
00456 
00457     pl_filltype_r( plotter, 1 );
00458     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a9">getNumPixels</a>(); i++) {
00459 
00460         pl_fmove_r( plotter, 0.0, _maxy - 0.05);
00461         
00462         <span class="comment">// --------------------------------------------------</span>
00463         <span class="comment">// choose value based on type:</span>
00464 
00465         <span class="keywordflow">switch</span> (plottype) {
00466         <span class="keywordflow">case</span> CAMERA_IMAGE:
00467             value = image[i];
00468             <span class="keywordflow">break</span>;
00469         <span class="keywordflow">case</span> CAMERA_PEDS:
00470             value = peds[i].pedestal;
00471             <span class="keywordflow">break</span>;
00472         <span class="keywordflow">case</span> CAMERA_PEDDISPS:
00473             value = peds[i].dispersion;
00474             <span class="keywordflow">break</span>;
00475         <span class="keywordflow">case</span> CAMERA_TUBENUMS:
00476             value = 0;
00477         <span class="keywordflow">default</span>:
00478             value = image[i];
00479             <span class="keywordflow">break</span>;
00480             
00481         }
00482 
00483         <span class="comment">// --------------------------------------------------</span>
00484         <span class="comment">// choose a color for the plot</span>
00485 
00486         <span class="keywordflow">if</span> (value &gt;= 0) {
00487             pl_pencolorname_r(plotter, <span class="stringliteral">"LightSkyBlue"</span>); 
00488             pl_fillcolorname_r(plotter, <span class="stringliteral">"LightSkyBlue"</span>);
00489         }
00490         <span class="keywordflow">else</span> { 
00491             pl_pencolorname_r( plotter, <span class="stringliteral">"goldenrod"</span>); 
00492             pl_fillcolorname_r( plotter, <span class="stringliteral">"goldenrod"</span>);
00493         }
00494         
00495 
00496         <span class="comment">// --------------------------------------------------</span>
00497         <span class="comment">// apply scaling: </span>
00498 
00499         <span class="keywordflow">if</span> (_pixelscale ==-1) {
00500             <span class="comment">// Autoscale to max</span>
00501             qr =  rad[i]*fabs(value)/max;
00502         }
00503         <span class="keywordflow">else</span> {
00504             <span class="comment">// Fixed scale to _pixelscale</span>
00505             qr = rad[i]*fabs(value)/_pixelscale;
00506             <span class="keywordflow">if</span> (qr &gt; rad[i]) qr = rad[i]; <span class="comment">// saturated</span>
00507         }
00508 
00509 
00510         <span class="comment">// --------------------------------------------------</span>
00511         <span class="comment">// deal with tubes which are off</span>
00512 
00513         <span class="keywordflow">if</span> (peds[i].type != Pedestal::GOOD) {
00514             <span class="keywordflow">if</span> (peds[i].type == Pedestal::TUBEOFF) <span class="comment">// off</span>
00515                 pl_fillcolorname_r( plotter, <span class="stringliteral">"gray60"</span>);
00516             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (peds[i].type == Pedestal::STAR)
00517                 pl_fillcolorname_r( plotter, <span class="stringliteral">"gray90"</span>);
00518             <span class="keywordflow">else</span>
00519                 pl_fillcolorname_r(plotter, <span class="stringliteral">"white"</span>);
00520             pl_pencolorname_r(plotter, <span class="stringliteral">"gray88"</span>); 
00521             qr = rad[i];
00522         }
00523         
00524 
00525         <span class="comment">// plot the value</span>
00526         <span class="keywordflow">if</span> (value&gt;0)
00527             pl_fellipse_r( plotter, xc[i],yc[i],qr,qr,0); 
00528             
00529         
00530     }
00531 
00532     <span class="comment">// ===============================================================</span>
00533     <span class="comment">// mark picture tubes</span>
00534 
00535     <span class="keywordflow">if</span> (plottype == CAMERA_IMAGE ) {
00536         <span class="keywordflow">for</span> (vector&lt;int&gt;::iterator iter=cleanpixels.begin();
00537              iter!=cleanpixels.end(); iter++){
00538             pl_pencolorname_r( plotter, <span class="stringliteral">"darkblue"</span>);
00539             pl_fillcolorname_r( plotter, <span class="stringliteral">"darkblue"</span>);
00540             <span class="keywordflow">if</span> (_pixelscale==-1) qr = fabs(rad[*iter]*image[*iter]/max);
00541             <span class="keywordflow">else</span> qr = rad[*iter]*image[*iter]/_pixelscale; 
00542             <span class="keywordflow">if</span> (qr &gt; rad[*iter]) qr = rad[*iter];
00543             pl_fellipse_r( plotter, xc[*iter],yc[*iter],qr,qr,0);  
00544         }
00545 
00546         <span class="comment">// display the signal value if over a threshold</span>
00547         
00548         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a9">getNumPixels</a>(); i++) {
00549             <span class="keywordflow">if</span>(image[i]&gt;max*0.75 &amp;&amp; rad[i]) {
00550                 sprintf(text,<span class="stringliteral">"%d"</span>, (<span class="keywordtype">int</span>) image[i]);
00551                 <span class="keywordflow">if</span> (pl_flabelwidth_r( plotter,text ) &lt; rad[i]*1.2){
00552                     pl_pencolorname_r( plotter, <span class="stringliteral">"white"</span>); 
00553                     pl_fmove_r( plotter,  xc[i],yc[i] );            
00554                     pl_alabel_r(plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'c'</span>, text );
00555                 }
00556             }
00557         }
00558     }
00559 
00560     <span class="comment">// ===============================================================</span>
00561     <span class="comment">// Display the tube numbers if requested</span>
00562 
00563     pl_fontname_r( plotter, <span class="stringliteral">"HersheySans"</span>);
00564     pl_ffontsize_r( plotter, _scalefactor*0.05 );
00565 
00566     <span class="keywordflow">if</span> (plottype == CAMERA_TUBENUMS) {
00567 
00568         pl_pencolorname_r( plotter, <span class="stringliteral">"black"</span>); 
00569         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a9">getNumPixels</a>(); i++) {
00570             sprintf(text,<span class="stringliteral">"%d"</span>, i);
00571             pl_fmove_r( plotter,  xc[i],yc[i] );            
00572             pl_alabel_r(plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'c'</span>, text );
00573         }
00574     }
00575     
00576     pl_restorestate_r( plotter );
00577 
00578 }
00579 
00583 <span class="keywordtype">void</span> 
00584 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
<a name="l00585"></a><a class="code" href="classPlotMaker.html#a25">00585</a> <a class="code" href="classPlotMaker.html#a25">plot</a>( vector&lt;double&gt; &amp;xpoints, vector&lt;double&gt; &amp;ypoints ) {
00586 
00587     <span class="keywordflow">if</span> (xpoints.size() != ypoints.size()){
00588         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html">MildAnalysisException</a>( <span class="stringliteral">"Couldn't plot x and y "</span>
00589                                      <span class="stringliteral">"vectors with different sizes"</span>);
00590     }
00591 
00592     <span class="keywordflow">if</span> (xpoints.size() ==0 || ypoints.size()==0){
00593         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html">MildAnalysisException</a>( <span class="stringliteral">"Couldn't plot curve with no points "</span>);
00594     }
00595 
00596     pl_savestate_r( plotter );
00597     pl_flinewidth_r( plotter, 0.009 );
00598 
00599     setLineMod();
00600     
00601     pl_fmove_r( plotter, xpoints[0], ypoints[0] );
00602 
00603     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt; (<span class="keywordtype">int</span>)xpoints.size(); i++) {
00604         
00605         pl_fcont_r( plotter, xpoints[i], ypoints[i] );
00606 
00607     }
00608 
00609     pl_endpath_r( plotter );
00610     pl_restorestate_r( plotter );
00611 
00612 }
00613 
00614 
00618 <span class="keywordtype">void</span> 
00619 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
<a name="l00620"></a><a class="code" href="classPlotMaker.html#a26">00620</a> <a class="code" href="classPlotMaker.html#a25">plot</a>( string text, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y ){
00621     
00622     pl_savestate_r( plotter );
00623 
00624     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00625     pl_ffontsize_r( plotter, _state.top().labelsize );
00626     pl_ftextangle_r( plotter, _state.top().labelangle );
00627     pl_pencolorname_r( plotter,_state.top().labelcolor.c_str() );
00628     pl_fmove_r( plotter, x,y );
00629     pl_alabel_r( plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'c'</span>, text.c_str() );
00630     pl_restorestate_r( plotter );
00631 
00632 }
00633 
00634 
00638 <span class="keywordtype">void</span>
00639 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
<a name="l00640"></a><a class="code" href="classPlotMaker.html#a27">00640</a> <a class="code" href="classPlotMaker.html#a25">plot</a>( <a class="code" href="classTelescopeArray.html">TelescopeArray</a> &amp;array ) {
00641 
00642     <span class="keywordtype">double</span> x,y,r;
00643 
00644     pl_savestate_r( plotter );
00645 
00646     pl_pencolorname_r( plotter,<span class="stringliteral">"black"</span> );
00647 
00648     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;array.<a class="code" href="classTelescopeArray.html#a2">getNumTelescopes</a>(); i++){
00649         r = 0.5*(array.<a class="code" href="classTelescopeArray.html#a3">getCamera</a>(i)-&gt;<a class="code" href="classCamera.html#a18">getMaxX</a>() 
00650                  - array.<a class="code" href="classTelescopeArray.html#a3">getCamera</a>(i)-&gt;<a class="code" href="classCamera.html#a16">getMinX</a>());
00651 
00652         x = array.<a class="code" href="classTelescopeArray.html#a4">getLocationX</a>(i);
00653         y = array.<a class="code" href="classTelescopeArray.html#a5">getLocationY</a>(i);
00654         
00655         pl_fellipse_r( plotter, x,y, r,r, 0 );
00656         
00657     }
00658 
00659 
00660     pl_restorestate_r( plotter );
00661 
00662 }
00663 
00664 <span class="keywordtype">void</span>
00665 PlotMaker::
00666 pushState() {
00667     pl_savestate_r( plotter );
00668     _state.push( _state.top() );
00669 }
00670 
00671 <span class="keywordtype">void</span>
00672 PlotMaker::
00673 popState() {
00674     pl_restorestate_r( plotter );
00675     _state.pop();
00676 };
00677 
00678 <span class="keywordtype">void</span> 
00679 PlotMaker::
00680 rotate( <span class="keywordtype">double</span> theta ) {
00681 
00682     pl_frotate_r( plotter, theta );
00683 
00684 }
00685 
00686 
00687 <span class="keywordtype">void</span> 
00688 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
00689 <a class="code" href="classPlotMaker.html#a25">plot</a>( <a class="code" href="structHillasParameterization.html">HillasParameterization</a> &amp;p ) {
00690 
00691     <span class="keyword">const</span> <span class="keywordtype">double</span> step = 0.11;
00692     <span class="keywordtype">char</span> text[128];
00693 
00694     pl_savestate_r( plotter );
00695 
00696     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00697     pl_ffontsize_r(plotter, 0.07);
00698 
00699     <span class="comment">// draw the centeroid</span>
00700 
00701     pl_pencolorname_r( plotter, <span class="stringliteral">"red"</span>);
00702     pl_fillcolorname_r( plotter,<span class="stringliteral">"red"</span>); 
00703     pl_fmarker_r(  plotter,p.<a class="code" href="structHillasParameterization.html#o0">centroid</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>, p.<a class="code" href="structHillasParameterization.html#o0">centroid</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>, 9,0.1);
00704 
00705     <span class="comment">// draw the points or origin</span>
00706 
00707     pl_pencolorname_r(  plotter,<span class="stringliteral">"DarkGreen"</span>);
00708     pl_fmarker_r(plotter,p.<a class="code" href="structHillasParameterization.html#o1">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>, p.<a class="code" href="structHillasParameterization.html#o1">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>, 10,0.4);
00709     pl_fmarker_r(plotter,p.<a class="code" href="structHillasParameterization.html#o2">point_of_origin_b</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>, p.<a class="code" href="structHillasParameterization.html#o2">point_of_origin_b</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>, 10,0.3);
00710     
00711     <span class="comment">// draw the hillas ellipse</span>
00712     pl_pencolorname_r( plotter,<span class="stringliteral">"red"</span>);
00713     pl_flinewidth_r( plotter,0.02); <span class="comment">// line thickness in user coordinates </span>
00714     pl_filltype_r( plotter,0);  
00715     pl_pencolorname_r( plotter,<span class="stringliteral">"red"</span>); 
00716     pl_fellipse_r( plotter,p.<a class="code" href="structHillasParameterization.html#o0">centroid</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>, p.<a class="code" href="structHillasParameterization.html#o0">centroid</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>, 
00717                    p.<a class="code" href="structHillasParameterization.html#o3">length</a>, 
00718                    p.<a class="code" href="structHillasParameterization.html#o4">width</a>, (p.<a class="code" href="structHillasParameterization.html#o11">psi</a> * 180.0/M_PI) );
00719     
00720     <span class="comment">// draw the labels</span>
00721 
00722     pl_fmove_r(  plotter,_minx+0.1,_maxy-step*1 );
00723     sprintf(text, <span class="stringliteral">"max1,2,3: %5.2f %5.2f %5.2f"</span>, p.<a class="code" href="structHillasParameterization.html#o13">max</a>[0], p.<a class="code" href="structHillasParameterization.html#o13">max</a>[1], p.<a class="code" href="structHillasParameterization.html#o13">max</a>[2]);
00724     pl_label_r( plotter, text );
00725 
00726     pl_fmove_r( plotter, _minx+0.1,_maxy-step*2 );
00727     sprintf(text, <span class="stringliteral">"alpha: %3.3g"</span>, p.<a class="code" href="structHillasParameterization.html#o9">alpha</a> *180.0/M_PI);
00728     pl_label_r( plotter, text );
00729 
00730     pl_fmove_r( plotter, _minx+0.1,_maxy-step*3 );
00731     sprintf(text, <span class="stringliteral">"miss: %3.3g"</span>, p.<a class="code" href="structHillasParameterization.html#o6">miss</a>);
00732     pl_label_r( plotter, text );
00733 
00734     pl_fmove_r( plotter, _minx+0.1,_maxy-step*4 );
00735     sprintf(text, <span class="stringliteral">"dist: %3.3g"</span>, p.<a class="code" href="structHillasParameterization.html#o7">distance</a>);
00736     pl_label_r( plotter, text );
00737 
00738     pl_fmove_r( plotter, _minx+0.1,_maxy-step*5 );
00739     sprintf(text, <span class="stringliteral">"length: %3.3g"</span>, p.<a class="code" href="structHillasParameterization.html#o3">length</a>);
00740     pl_label_r( plotter, text );
00741 
00742     pl_fmove_r( plotter, _minx+0.1,_maxy-step*6 );
00743     sprintf(text, <span class="stringliteral">"width: %3.3g"</span>, p.<a class="code" href="structHillasParameterization.html#o4">width</a>);
00744     pl_label_r( plotter, text );
00745 
00746     pl_fmove_r( plotter, _minx+0.1,_maxy-step*7 );
00747     sprintf(text, <span class="stringliteral">"size: %.2f"</span>, p.<a class="code" href="structHillasParameterization.html#o5">size</a>);
00748     pl_label_r( plotter, text );
00749 
00750     pl_fmove_r( plotter, _minx+0.1,_maxy-step*8 );
00751     sprintf(text, <span class="stringliteral">"psi: %3.3g deg"</span>, p.<a class="code" href="structHillasParameterization.html#o11">psi</a>*180.0/M_PI);
00752     pl_label_r( plotter, text );
00753 
00754     pl_fmove_r( plotter, _minx+0.1,_maxy-step*9 );
00755     sprintf(text, <span class="stringliteral">"asym: %3.3g"</span>, p.<a class="code" href="structHillasParameterization.html#o17">asymmetry</a>);
00756     pl_label_r( plotter, text );
00757 
00758     <span class="keywordflow">if</span> (p.<a class="code" href="structImageParameterization.html#o4">invalid</a> != 0){
00759         pl_fmove_r( plotter, _minx+0.1,_maxy-step*10 );
00760         sprintf(text, <span class="stringliteral">"INVALID: %d "</span>,(<span class="keywordtype">int</span>) p.<a class="code" href="structImageParameterization.html#o4">invalid</a>);
00761         pl_label_r( plotter, text );
00762     }
00763 
00764     pl_ffontsize_r( plotter,0.09);
00765     pl_pencolorname_r(  plotter,<span class="stringliteral">"darkgreen"</span> );
00766     pl_fmove_r( plotter, _maxx-0.1, _maxy-step );
00767     sprintf(text,<span class="stringliteral">"%d"</span>, p.<a class="code" href="structImageParameterization.html#o5">event_number</a>);
00768     pl_alabel_r(  plotter,<span class="charliteral">'r'</span>,<span class="charliteral">'c'</span>,text);
00769 
00770     pl_pencolorname_r(  plotter,<span class="stringliteral">"DarkKhaki"</span> );
00771     pl_fmove_r( plotter, _maxx-0.1, _maxy-2*step );
00772     sprintf(text,<span class="stringliteral">"T%2d"</span>, p.<a class="code" href="structImageParameterization.html#o0">telescope_id</a>);
00773     pl_alabel_r(  plotter,<span class="charliteral">'r'</span>,<span class="charliteral">'c'</span>,text);
00774 
00775     <span class="comment">// plot center marker</span>
00776     pl_flinewidth_r( plotter,0.01); <span class="comment">// line thickness in user coordinates </span>
00777     pl_fmarker_r(  plotter,0.0, 0.0,9,0.2);
00778 
00779     pl_restorestate_r( plotter );    
00780 
00781 }
00782 
00783 <span class="keywordtype">void</span> 
00784 PlotMaker::
00785 <a class="code" href="classPlotMaker.html#a25">plot</a>( <a class="code" href="structMuonParameterization.html">MuonParameterization</a> &amp;p ) {
00786 
00787     <span class="keyword">const</span> <span class="keywordtype">double</span> step = 0.11;
00788     <span class="keywordtype">char</span> text[128];
00789 
00790     pl_savestate_r( plotter );
00791 
00792     <span class="comment">// draw the other ring centers</span>
00793     
00794     pl_pencolorname_r( plotter,<span class="stringliteral">"goldenrod1"</span>);
00795     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;p.nplotpoints; i++) {
00796         pl_fmarker_r(  plotter,p.plot[i].x, p.plot[i].y, 10, 0.08 );
00797     }
00798 
00799     <span class="comment">// set color</span>
00800 
00801     pl_pencolorname_r(  plotter,<span class="stringliteral">"orange"</span>);
00802     pl_fillcolorname_r(  plotter,<span class="stringliteral">"orange"</span>);     
00803 
00804     <span class="comment">// draw the muon center position</span>
00805 
00806     pl_fmarker_r(  plotter,p.ringcenter.x, p.ringcenter.y, 2, 0.4 );
00807     
00808     <span class="comment">// draw the ring itself</span>
00809    
00810     pl_linemod_r( plotter, <span class="stringliteral">"shortdashed"</span> );
00811     pl_filltype_r( plotter,0);          <span class="comment">// don't fill</span>
00812     pl_flinewidth_r( plotter,0.02);     <span class="comment">// line thickness in user coordinates </span>
00813     pl_fcircle_r(  plotter,p.ringcenter.x, p.ringcenter.y, p.radius );
00814 
00815     <span class="comment">// draw the arc (philo to phihi) region:</span>
00816 
00817     <span class="keywordtype">double</span> x0 = p.radius*cos(p.philo) + p.ringcenter.x;
00818     <span class="keywordtype">double</span> y0 = p.radius*sin(p.philo) + p.ringcenter.y;
00819     <span class="keywordtype">double</span> x1 = p.radius*cos(p.phihi) + p.ringcenter.x;
00820     <span class="keywordtype">double</span> y1 = p.radius*sin(p.phihi) + p.ringcenter.y;
00821     <span class="keywordtype">double</span> xm = p.radius*cos(p.phimid) + p.ringcenter.x;
00822     <span class="keywordtype">double</span> ym = p.radius*sin(p.phimid) + p.ringcenter.y;
00823 
00824     pl_fline_r( plotter, p.ringcenter.x, p.ringcenter.y, xm,ym );
00825     pl_flinewidth_r( plotter,0.05 );    
00826     pl_linemod_r( plotter, <span class="stringliteral">"solid"</span> );
00827     pl_farc_r( plotter, p.ringcenter.x, p.ringcenter.y, x0,y0,x1,y1 ); 
00828 
00829     pl_pencolorname_r( plotter,<span class="stringliteral">"black"</span>);
00830     pl_fmarker_r( plotter, p.xcs, p.ycs, 6, 0.2 );
00831     pl_pencolorname_r( plotter,<span class="stringliteral">"orange"</span>);
00832 
00833     <span class="comment">// display the relevant parameters</span>
00834 
00835     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00836     pl_ffontsize_r(plotter, 0.07);    
00837     
00838     pl_fmove_r( plotter, _minx+0.1, _miny+step*1 );
00839     sprintf( text, <span class="stringliteral">"S/Arclen: %.2f"</span>, p.soal );
00840     pl_label_r( plotter, text );
00841 
00842     pl_fmove_r( plotter, _minx+0.1, _miny+step*2 );
00843     sprintf( text, <span class="stringliteral">"Radius: %f"</span>, p.radius );
00844     pl_label_r( plotter, text );
00845 
00846     pl_fmove_r( plotter, _minx+0.1, _miny+step*3 );
00847     sprintf( text, <span class="stringliteral">"ArcStrength: %f"</span>, p.arcstrength );
00848     pl_label_r( plotter, text );
00849 
00850     pl_fmove_r( plotter, _minx+0.1, _miny+step*4 );
00851     sprintf( text, <span class="stringliteral">"RingFrac: %.2f %%"</span>, p.ringfrac * 100 );
00852     pl_label_r( plotter, text );
00853 
00854     pl_fmove_r( plotter, _minx+0.1, _miny+step*5 );
00855     sprintf( text, <span class="stringliteral">"MuSkew: %f"</span>, p.muskew );
00856     pl_label_r( plotter, text );
00857 
00858     pl_fmove_r( plotter, _minx+0.1, _miny+step*6 );
00859     sprintf( text, <span class="stringliteral">"MuGain: %f"</span>, p.mugain );
00860     pl_label_r( plotter, text );
00861 
00862     pl_fmove_r( plotter, _minx+0.1, _miny+step*7 );
00863     sprintf( text, <span class="stringliteral">"gain: %f"</span>, p.gain );
00864     pl_label_r( plotter, text );
00865 
00866     pl_fmove_r( plotter, _minx+0.1, _miny+step*8 );
00867     sprintf( text, <span class="stringliteral">"muonness: %.2f"</span>, p.muonness );
00868     pl_label_r( plotter, text );
00869 
00870     pl_fmove_r( plotter, _minx+0.1, _miny+step*9 );
00871     sprintf( text, <span class="stringliteral">"arclength: %.2f"</span>, p.arclen );
00872     pl_label_r( plotter, text );
00873 
00874 
00875     pl_restorestate_r( plotter );
00876 
00877     
00878 
00879 }
00880 
00881 
00890 <span class="keywordtype">void</span>
<a name="l00891"></a><a class="code" href="classPlotMaker.html#a32">00891</a> <a class="code" href="classPlotMaker.html#a32">PlotMaker::getMappedColor</a>( <span class="keywordtype">double</span> value, <span class="keywordtype">int</span> &amp;red, <span class="keywordtype">int</span> &amp;green, <span class="keywordtype">int</span> &amp;blue ) {
00892 
00893   
00894     <span class="keywordflow">switch</span> ( _state.top().colormap) {
00895         
00896     <span class="keywordflow">case</span> COLORMAP_BLUES:
00897         red = static_cast&lt;int&gt;( (value*value)*65535.0);
00898         green = static_cast&lt;int&gt;(value*65535.0);
00899         blue = static_cast&lt;int&gt;(sin(M_PI_2*value)*65535.0);
00900         <span class="keywordflow">break</span>;
00901 
00902     <span class="keywordflow">case</span> COLORMAP_YELLOWGREEN:
00903         red = static_cast&lt;int&gt;( value*(pow(sin(M_PI_2*value),2) + 
00904                                        pow(cos(3*M_PI_2*value),2) )*65535.0);
00905         green = static_cast&lt;int&gt;(sin(M_PI_2*value)* 65535.0);
00906         blue = static_cast&lt;int&gt;( (pow(sin(3*M_PI_2*value),2)/2.0 + value/2.0)
00907                                  *65535.0);     
00908         <span class="keywordflow">break</span>;
00909 
00910     <span class="keywordflow">case</span> COLORMAP_REDBLUE:
00911         red   = static_cast&lt;int&gt;((sqrt(value))*65535.0);
00912         green = static_cast&lt;int&gt;((pow(value,3))*65535.0);
00913         blue  = static_cast&lt;int&gt;((sin(2*M_PI*value))*65535.0);
00914         <span class="keywordflow">break</span>;
00915 
00916     <span class="keywordflow">case</span> COLORMAP_INVERSEGREY:
00917         red   = static_cast&lt;int&gt;((1.0-value)*65535.0);
00918         green = static_cast&lt;int&gt;((1.0-value)*65535.0);
00919         blue  = static_cast&lt;int&gt;((1.0-value)*65535.0);
00920 
00921         <span class="keywordflow">break</span>;
00922 
00923     <span class="keywordflow">case</span> COLORMAP_GREY:
00924         red   = static_cast&lt;int&gt;((value)*65535.0);
00925         green = static_cast&lt;int&gt;((value)*65535.0);
00926         blue  = static_cast&lt;int&gt;((value)*65535.0);
00927         <span class="keywordflow">break</span>;
00928 
00929     <span class="keywordflow">case</span> COLORMAP_RAINBOW:
00930         red   = static_cast&lt;int&gt;((abs(2*value-0.5))*65535.0);
00931         green = static_cast&lt;int&gt;((sin(M_PI*value))*65535.0);
00932         blue  = static_cast&lt;int&gt;((cos(M_PI/2.0*value))*65535.0);
00933         <span class="keywordflow">break</span>;
00934 
00935     <span class="keywordflow">case</span> COLORMAP_HOT:
00936         red   = static_cast&lt;int&gt;((3*value)*65535.0);
00937         green = static_cast&lt;int&gt;((3*value-1)*65535.0);
00938         blue  = static_cast&lt;int&gt;((3*value-2)*65535.0);
00939         <span class="keywordflow">break</span>;
00940 
00941     <span class="keywordflow">case</span> COLORMAP_PRINTABLE:
00942         red   = static_cast&lt;int&gt;((value/0.32-0.78125)*65535.0);
00943         green = static_cast&lt;int&gt;((2*value-0.84)*65535.0);
00944         blue  = static_cast&lt;int&gt;((4*value)*65535.0);
00945         <span class="keywordflow">break</span>;
00946 
00947     <span class="keywordflow">default</span>:
00948         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html">MildAnalysisException</a>(<span class="stringliteral">"unknown color map value"</span>);
00949 
00950     };
00951 
00952 
00953     <span class="keywordflow">if</span> (red &gt; 65535)   red   = 65535;
00954     <span class="keywordflow">if</span> (green &gt; 65535) green = 65535;
00955     <span class="keywordflow">if</span> (blue &gt; 65535)  blue  = 65535;
00956 
00957     <span class="keywordflow">if</span> (red &lt; 0)    red   = 0;
00958     <span class="keywordflow">if</span> (green &lt; 0 ) green = 0;
00959     <span class="keywordflow">if</span> (blue &lt; 0 )  blue  = 0;
00960 
00961 
00962 
00963 }
00964 
00965 
00966 <span class="keywordtype">void</span> 
00967 <a class="code" href="classPlotMaker.html#a25">PlotMaker::</a>
00968 <a class="code" href="classPlotMaker.html#a25">plot</a>( <a class="code" href="classStar.html">Star</a> &amp;star, <span class="keywordtype">int</span> symbol ) {
00969     
00970     <span class="keywordtype">double</span> size = (_maxmagnitude - star.<a class="code" href="classStar.html#o4">magnitude</a>)/40.0;
00971     <span class="keywordflow">if</span> (size&lt;=0) <span class="keywordflow">return</span>;
00972 
00973     pl_savestate_r( plotter );
00974     pl_fontname_r( plotter, <span class="stringliteral">"HersheySerif"</span>);
00975     pl_ffontsize_r( plotter, 0.06 );    
00976     pl_pencolorname_r( plotter, <span class="stringliteral">"yellow"</span> );
00977     pl_fmarker_r(plotter,star.<a class="code" href="classStar.html#o8">tx</a>,star.<a class="code" href="classStar.html#o9">ty</a>, symbol ,size );
00978     <span class="keywordflow">if</span> ( star.<a class="code" href="classStar.html#o10">catalog_id</a> == 0 ) {
00979         pl_fmove_r( plotter, star.<a class="code" href="classStar.html#o8">tx</a>, star.<a class="code" href="classStar.html#o9">ty</a>-size );
00980         pl_alabel_r( plotter, <span class="charliteral">'c'</span>,<span class="charliteral">'t'</span>,star.<a class="code" href="classStar.html#o0">name</a>.c_str() );
00981     }
00982     pl_restorestate_r( plotter );
00983     
00984 }
00985 
00986 
00990 <span class="keywordtype">void</span> 
00991 <a class="code" href="classPlotMaker.html#a18">PlotMaker::</a>
<a name="l00992"></a><a class="code" href="classPlotMaker.html#a18">00992</a> <a class="code" href="classPlotMaker.html#a18">contourPlot</a>( <a class="code" href="classImage2D.html">Image2D</a> &amp;im2d, <span class="keywordtype">double</span> zmin, <span class="keywordtype">double</span> zmax, <span class="keywordtype">double</span> dz ) {
00993 
00994     <span class="keywordtype">int</span> nlevels = static_cast&lt;int&gt;( (zmax-zmin)/dz );
00995     <span class="keywordtype">int</span> nx = im2d.<a class="code" href="classImage2D.html#a21">getXDim</a>();
00996     <span class="keywordtype">int</span> ny = im2d.<a class="code" href="classImage2D.html#a22">getYDim</a>();
00997     <span class="keywordtype">double</span> x00,x01,x10,x11;
00998     <span class="keywordtype">double</span> y00,y01,y10,y11;
00999     <span class="keywordtype">double</span> z00,z01,z10,z11;
01000     <span class="keywordtype">double</span> zc;  
01001     <span class="keywordtype">int</span> k, red,green,blue;
01002     <span class="keywordtype">bool</span> iny, inx;
01003     <span class="keywordtype">double</span> x[5], y[5];
01004     <span class="keywordtype">double</span> xin, yin;            <span class="comment">// x, y intercepts</span>
01005 
01006     ContourSegment segment;
01007 
01008     <span class="keywordflow">if</span> (fabs(zmin-zmax) &lt; 1e-10) {
01009         cout &lt;&lt; <span class="stringliteral">"contourPlot: too small a contour range! ("</span> 
01010              &lt;&lt; zmin &lt;&lt; <span class="stringliteral">","</span>&lt;&lt;zmax&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt;endl;
01011         <span class="keywordflow">return</span>;
01012      }
01013 
01014     <span class="comment">// Set up the colors for plotting </span>
01015 
01016     pl_savestate_r( plotter );
01017     <span class="comment">//    pl_flinewidth_r( plotter, 0.009 );</span>
01018 
01019     setLineMod();
01020         
01021     <span class="comment">// First we need to figure out where all the contours go, then</span>
01022     <span class="comment">// we'll plot them</span>
01023     
01024     <span class="comment">// For each grid box</span>
01025     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> yi=0; yi&lt;nx-1; yi++ ) {
01026         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xi=0; xi&lt;ny-1; xi++ ) {
01027             
01028             <span class="comment">// get the coordinate centers of the current block of four</span>
01029             <span class="comment">// pixels (just to make them easier to type)</span>
01030 
01031             x00 = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>( xi   );
01032             x10 = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>( xi+1 );
01033             x01 = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>( xi   );
01034             x11 = im2d.<a class="code" href="classImage2D.html#a2">getXCoord</a>( xi+1 );
01035 
01036             y00 = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>( yi );
01037             y10 = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>( yi );
01038             y01 = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>( yi+1 );
01039             y11 = im2d.<a class="code" href="classImage2D.html#a3">getYCoord</a>( yi+1 );
01040 
01041             z00 = im2d.<a class="code" href="classImage2D.html#a14">getPixel</a>( xi   , yi );
01042             z10 = im2d.<a class="code" href="classImage2D.html#a14">getPixel</a>( xi+1 , yi );
01043             z01 = im2d.<a class="code" href="classImage2D.html#a14">getPixel</a>( xi   , yi+1 );
01044             z11 = im2d.<a class="code" href="classImage2D.html#a14">getPixel</a>( xi+1 , yi+1 );
01045             
01046 
01047             <span class="comment">// For each contour j:</span>
01048             
01049             zc = zmin;
01050             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;nlevels; j++) {
01051                 
01052                 k = 0;
01053 
01054                 <span class="comment">// Check if the contour passes through the 4 pixel block</span>
01055 
01056                 iny = ( ((z00&lt;=zc)&amp;&amp;(zc&lt;=z01))||((z00&gt;=zc)&amp;&amp;(zc&gt;=z01)) ) ;
01057                 iny = iny ||( ((z10&lt;=zc)&amp;&amp;(zc&lt;=z11))||((z10&gt;=zc)&amp;&amp;(zc&gt;=z11)) );
01058                 inx = ( ((z00&lt;=zc)&amp;&amp;(zc&lt;=z10))||((z00&gt;=zc)&amp;&amp;(zc&gt;=z10)) ) ;
01059                 inx = inx ||( ((z01&lt;=zc)&amp;&amp;(zc&lt;=z11))||((z01&gt;=zc)&amp;&amp;(zc&gt;=z11)) );
01060                 
01061                 <span class="keywordflow">if</span> (inx || iny) {
01062                     
01063                     xin = xIntercept(z00,z01,z10,z11,zc,0.0);
01064                     yin = yIntercept(z00,z01,z10,z11,zc,0.0);
01065                     <span class="keywordflow">if</span> ( xin &gt; 0 ){
01066                         x[k] = x00 + xin*(x10-x00);
01067                         y[k] = y00 + xin*(y10-y00);
01068                         k++;
01069                     }
01070                     <span class="keywordflow">if</span>( yin &gt; 0.00) {
01071                         x[k] = x00+yin*(x01-x00) ;
01072                         y[k] = y00+yin*(y01-y00) ;
01073                         k++;
01074                     }
01075 
01076                     xin=xIntercept(z00,z01,z10,z11,zc,1.0);
01077                     yin=yIntercept(z00,z01,z10,z11,zc,1.0);
01078                     <span class="keywordflow">if</span> ( xin &gt; 0.00 ){
01079                         x[k] = x01+xin*(x11-x01) ;
01080                         y[k] = y01+xin*(y11-y01) ;
01081                         k++;
01082                     }
01083                     <span class="keywordflow">if</span>( yin &gt; 0.00) {
01084                         x[k] = x10+yin*(x11-x10) ;
01085                         y[k] = y10+yin*(y11-y10) ;
01086                         k++;
01087                     }
01088                     
01089                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;k-1; i++ ) {
01090                         
01091                         <span class="comment">// contour segment is: x[i],y[i] - x[i+1],y[i+1]</span>
01092 
01093                         segment.start.x = x[i];
01094                         segment.start.y = y[i];
01095                         segment.end.x   = x[i+1];
01096                         segment.end.y   = y[i+1];
01097 
01098                         <span class="comment">// plot it!</span>
01099                         <a class="code" href="classPlotMaker.html#a32">getMappedColor</a>(((<span class="keywordtype">double</span>)j/(<span class="keywordtype">double</span>)nlevels), 
01100                                        red,green,blue );
01101                         <span class="keywordflow">if</span> ( _state.top().contourcolor == <span class="stringliteral">"MAPPED"</span>)
01102                             pl_pencolor_r( plotter, red,green,blue  );
01103 
01104                         pl_fline_r( plotter, 
01105                                     segment.start.x,
01106                                     segment.start.y,
01107                                     segment.end.x,
01108                                     segment.end.y );    
01109                     }
01110                     
01111                 }
01112 
01113                 <span class="comment">// move to the next contour level</span>
01114                 zc += dz; 
01115 
01116             }
01117         }
01118     }
01119 
01120     <span class="comment">// Now, we know all the contours, so on to plotting...</span>
01121     
01122     pl_restorestate_r( plotter );
01123     
01124 
01125 }
01126 
01127 
01131 <span class="keywordtype">void</span> 
01132 <a class="code" href="classPlotMaker.html#a28">PlotMaker::</a>
<a name="l01133"></a><a class="code" href="classPlotMaker.html#a28">01133</a> <a class="code" href="classPlotMaker.html#a28">plotEllipse</a>( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> r1, <span class="keywordtype">double</span> r2,<span class="keywordtype">double</span> theta) {
01134 
01135     pl_savestate_r( plotter );
01136     pl_filltype_r( plotter, 0 );
01137     pl_flinewidth_r( plotter, 0.009 );
01138     setLineMod();
01139     pl_fellipse_r( plotter, x,y, r1,r2, theta );
01140     pl_restorestate_r( plotter );    
01141 
01142 }
01143 
01144 
01148 <span class="keywordtype">void</span> 
01149 <a class="code" href="classPlotMaker.html#a19">PlotMaker::</a>
<a name="l01150"></a><a class="code" href="classPlotMaker.html#a19">01150</a> <a class="code" href="classPlotMaker.html#a19">plotRADecGrid</a>( <a class="code" href="classImage2D.html">Image2D</a> &amp;ragrid, <a class="code" href="classImage2D.html">Image2D</a> &amp;decgrid ) {
01151     
01152     <span class="comment">// get RA/DEC of center pixel:</span>
01153     
01154     <span class="keywordtype">int</span> xcenterpix = (ragrid.<a class="code" href="classImage2D.html#a21">getXDim</a>()/2);
01155     <span class="keywordtype">int</span> ycenterpix = (ragrid.<a class="code" href="classImage2D.html#a22">getYDim</a>()/2);
01156 
01157     <span class="keywordtype">double</span> ra = ragrid.<a class="code" href="classImage2D.html#a14">getPixel</a>( xcenterpix, ycenterpix ) *M_PI/12.0;
01158     <span class="keywordtype">double</span> dec = decgrid.<a class="code" href="classImage2D.html#a14">getPixel</a>( xcenterpix, ycenterpix )*M_PI/180.0;
01159 
01160 
01161     <span class="comment">// get the nice contour values:</span>
01162 
01163     <span class="keywordtype">double</span> xcont[NCONTSTEPS];
01164     <span class="keywordtype">double</span> ycont[NCONTSTEPS];
01165     <span class="keywordtype">double</span> nice_dec[NCONTSTEPS];
01166     <span class="keywordtype">double</span> nice_ra[NCONTSTEPS];
01167     <span class="keywordtype">int</span>    drawx[NCONTSTEPS];
01168     <span class="keywordtype">int</span>    drawy[NCONTSTEPS];
01169     <span class="keywordtype">char</span>   ra_str[NCONTSTEPS][128];
01170     <span class="keywordtype">char</span>   dec_str[NCONTSTEPS][128];
01171 
01172     niceRaDecContours( ra, dec, 
01173                        xcont, ycont,
01174                        nice_ra, nice_dec,
01175                        drawx, drawy,
01176                        ra_str, dec_str );
01177 
01178     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;NCONTSTEPS; i++) {
01179 
01180 
01181         <span class="comment">// Plot the RA contours and labels</span>
01182         
01183         <a class="code" href="classPlotMaker.html#a18">contourPlot</a>( ragrid,    <span class="comment">// kind of a hack to plot just one contour</span>
01184                      nice_ra[i]*12.0/M_PI, 
01185                      nice_ra[i]*12.0/M_PI + 4.0, 3.9 );
01186         
01187         <span class="keywordflow">if</span> ( drawx[i] ){
01188             <a class="code" href="classPlotMaker.html#a25">plot</a>( ra_str[i], xcont[i], _miny + _ticmarksize*2 );
01189         }
01190 
01191 
01192         <span class="comment">// plot the dec contours and labels </span>
01193 
01194         <a class="code" href="classPlotMaker.html#a18">contourPlot</a>( decgrid, 
01195                      nice_dec[i]*180.0/M_PI, 
01196                      nice_dec[i]*180.0/M_PI + 4.0, 3.9 );
01197 
01198         <span class="keywordflow">if</span> ( drawy[i] ){
01199             pushState();
01200             _state.top().labelangle = 90.0;
01201             <a class="code" href="classPlotMaker.html#a25">plot</a>( dec_str[i], _minx+_ticmarksize*2, ycont[i] );
01202             popState();
01203         }       
01204         
01205         
01206     }
01207 
01208 }
01209 
01210 
01214 <span class="keywordtype">void</span> 
01215 PlotMaker::
01216 setLineMod() {
01217     
01218     <span class="keywordflow">switch</span> (_state.top().contourlinestyle) {
01219 
01220     <span class="keywordflow">case</span> LINE_SOLID:
01221         pl_linemod_r( plotter, <span class="stringliteral">"solid"</span> );
01222         <span class="keywordflow">break</span>;
01223 
01224     <span class="keywordflow">case</span> LINE_DOTTED:
01225         pl_linemod_r( plotter, <span class="stringliteral">"dotted"</span> );
01226         <span class="keywordflow">break</span>;  
01227         
01228     <span class="keywordflow">case</span>  LINE_DASHED:
01229         pl_linemod_r( plotter, <span class="stringliteral">"shortdashed"</span> );
01230         <span class="keywordflow">break</span>;
01231 
01232     <span class="keywordflow">default</span>:
01233         pl_linemod_r( plotter, <span class="stringliteral">"solid"</span> );
01234         <span class="keywordflow">break</span>;
01235     }
01236 
01237     <span class="keywordflow">if</span> ( _state.top().contourcolor != <span class="stringliteral">"MAPPED"</span> )
01238         pl_pencolorname_r( plotter,_state.top().contourcolor.c_str() );
01239     
01240     pl_flinewidth_r( plotter,_state.top().contourwidth );
01241 
01242 }
01243 
01244 <span class="keywordtype">void</span> 
01245 PlotMaker::
01246 plotMarker( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y ) {
01247     
01248     pl_savestate_r( plotter );    
01249     pl_pencolorname_r( plotter,_state.top().markercolor.c_str() );
01250     pl_fmarker_r( plotter, x,y,_state.top().markertype,_state.top().markersize );
01251     pl_restorestate_r( plotter);
01252 
01253 }
01254 
01255 
01256 <span class="keywordtype">double</span>  
01257 PlotMaker::
01258 yIntercept(<span class="keywordtype">double</span> z00, <span class="keywordtype">double</span> z01, <span class="keywordtype">double</span> z10, <span class="keywordtype">double</span> z11, 
01259            <span class="keywordtype">double</span> zc, <span class="keywordtype">double</span> xr) {
01260     <span class="keywordtype">double</span>      yr ;
01261     <span class="keywordtype">double</span>      t1,t2 ;
01262     
01263     t1 = zc-xr*(z10-z00)-z00 ;
01264     t2 = xr*(z11-z01-z10+z00)+z01-z00 ;
01265     
01266     yr=(<span class="keywordtype">double</span>)t1/(<span class="keywordtype">double</span>)t2 ;
01267     <span class="keywordflow">if</span>((yr&gt;=0.00) &amp;&amp; (yr&lt;=1.00)) 
01268         <span class="keywordflow">return</span>(yr) ;
01269     <span class="keywordflow">else</span>
01270         <span class="keywordflow">return</span>(-1.00) ;
01271     
01272 }
01273 
01274 <span class="keywordtype">double</span>
01275 PlotMaker::     
01276 xIntercept(<span class="keywordtype">double</span> z00, <span class="keywordtype">double</span> z01, <span class="keywordtype">double</span> z10, <span class="keywordtype">double</span> z11, 
01277            <span class="keywordtype">double</span> zc, <span class="keywordtype">double</span> yr) {
01278 
01279     <span class="keywordtype">double</span> xr ;
01280     <span class="keywordtype">double</span> t1,t2 ;
01281     
01282     t1 = zc-yr*(z01-z00)-z00 ;
01283     t2 = yr*(z11-z01-z10+z00)+z10-z00 ;
01284     
01285     xr = (<span class="keywordtype">double</span>)t1/(<span class="keywordtype">double</span>)t2 ;
01286     <span class="keywordflow">if</span>((xr&gt;=0.00) &amp;&amp; (xr&lt;=1.00))
01287         <span class="keywordflow">return</span>(xr) ;
01288     <span class="keywordflow">else</span>
01289         <span class="keywordflow">return</span>(-1.00) ;
01290     
01291 }
01292 
01293 
01319 <span class="keywordtype">void</span> 
01320 PlotMaker::
01321 niceRaDecContours(<span class="keywordtype">double</span> ra,  <span class="keywordtype">double</span> dec, 
01322                   <span class="keywordtype">double</span> xcont[],<span class="keywordtype">double</span> ycont[], 
01323                   <span class="keywordtype">double</span> ra_nice[], <span class="keywordtype">double</span> dec_nice[], 
01324                   <span class="keywordtype">int</span> drawx[], <span class="keywordtype">int</span> drawy[], 
01325                   <span class="keywordtype">char</span> ra_str[17][128],
01326                   <span class="keywordtype">char</span> dec_str[17][128]) {
01327 
01328     <span class="keyword">register</span> <span class="keywordtype">int</span> i, j, k ;
01329     <span class="keywordtype">double</span> hh, mm, ss ;
01330     <span class="keywordtype">double</span> fraz ;       <span class="comment">/* RA in radians but truncated to the nearest min */</span>
01331     <span class="keywordtype">double</span> radeg ;      <span class="comment">/* RA in decimal degrees */</span>
01332     <span class="keywordtype">double</span> dd, arcmm, archm, arcss ;
01333     <span class="keywordtype">double</span> fdecz ;  <span class="comment">/* DEC in radians but truncated to the nearest arcmin */</span>
01334     <span class="keywordtype">double</span> decdeg ; <span class="comment">/* DEC in decimal degrees */</span>
01335     <span class="keywordtype">double</span> ratmp, dectmp,dectmp2,denom;
01336     <span class="keyword">static</span> <span class="keywordtype">int</span>  nbins = 6 ;
01337     <span class="keyword">static</span> <span class="keywordtype">double</span> xoff_dec[] = {-32.0, -16.0, -8.0,-4.0, -8.0, -16.0, -32.0} ;
01338     <span class="keyword">static</span> <span class="keywordtype">double</span> xstep_dec[] = {4.0, 2.0, 1.0, 0.5, 1.0, 2.0, 4.0} ;
01339     <span class="keyword">static</span> <span class="keywordtype">double</span> dec_bins[] = {-90.1, -73.0, 
01340                                 -67.0 ,-45, 
01341                                 45.0, 67.0, 
01342                                 73.0, 90.1};
01343     <span class="keywordtype">double</span> xoff ;       <span class="comment">/* Starting RA offset in degrees */</span>
01344     <span class="keywordtype">double</span> dx ; <span class="comment">/* RA step in degrees */</span>
01345     <span class="keywordtype">char</span> tempstra[100] ;
01346     <span class="keywordtype">double</span> frahh[NCONTSTEPS+1] ;
01347     <span class="keywordtype">double</span> framm[NCONTSTEPS+1] ;
01348     <span class="keywordtype">int</span> irahh[NCONTSTEPS+1] ;
01349     <span class="keywordtype">int</span> iramm[NCONTSTEPS+1] ;
01350     <span class="keywordtype">double</span> fdecdd[NCONTSTEPS+1] ;
01351     <span class="keywordtype">double</span> fdecmm[NCONTSTEPS+1] ;
01352     <span class="keywordtype">int</span> idecdd[NCONTSTEPS+1] ;
01353     <span class="keywordtype">int</span> idecmm[NCONTSTEPS+1] ;
01354     
01355     <span class="comment">// KPK: this routine (which was taken from the old quicklook kumac</span>
01356     <span class="comment">// files originally assumed that ra and dec were in "formatted"</span>
01357     <span class="comment">// format (ie, hhmmss.ss) instead of radians.  We use radians, so</span>
01358     <span class="comment">// we need to first convert to the hhmmss format!  (confusing, but</span>
01359     <span class="comment">// easier than modifying this code!)</span>
01360 
01361     <span class="keywordtype">double</span> ra_h, ra_m, ra_s;
01362     <span class="keywordtype">double</span> dec_d, dec_m, dec_s;
01363 
01364     radToHMS( ra, ra_h,ra_m,ra_s );
01365     radToDMS( dec, dec_d,dec_m,dec_s );
01366 
01367     ra = (((<span class="keywordtype">int</span>)ra_h)*10000 +
01368           ((<span class="keywordtype">int</span>)ra_m)*100 +
01369           ra_s);
01370     
01371     dec = (((<span class="keywordtype">int</span>)dec_d)*10000 +
01372            ((<span class="keywordtype">int</span>)dec_m)*100 +
01373            dec_s);
01374            
01375     <span class="comment">// done with conversion!</span>
01376 
01377     hh = int(ra/10000.) ;
01378     mm = int((ra-hh*10000)/100.) ;
01379     ss = ra - hh*10000 - mm*100. ;
01380 
01381     fraz = (hh+mm/60.)*15.0/(180.0/M_PI) ;
01382     radeg = (hh+mm/60.+ss/3600.)*15.0 ;
01383 
01384     dd = int(dec/10000.) ;
01385     arcmm = int((dec-dd*10000.)/100.) ;
01386     archm = int((dec-dd*10000.)/(100.*30.)) ;
01387     arcss = dec-dd*10000.-arcmm*100. ;
01388     fdecz = (dd+0.5*archm)/(180.0/M_PI) ;  <span class="comment">/* DEC in rad truncated to min */</span>
01389     decdeg = dd+arcmm/60.0+arcss/3600. ;  <span class="comment">/* DEC in degrees */</span>
01390 
01391     <span class="keywordflow">for</span>(i=0; i&lt;nbins; i++) {    <span class="comment">/* Find good values for RA given DEC */</span>
01392         <span class="keywordflow">if</span>((decdeg &gt; dec_bins[i]) &amp;&amp; (decdeg &lt; dec_bins[i+1])) {
01393             xoff = xoff_dec[i] ;
01394             dx = xstep_dec[i] ;
01395         }
01396     }
01397     ra = radeg/(180.0/M_PI) ;   
01398     dec = decdeg/(180.0/M_PI) ;
01399       
01400     <span class="keywordflow">for</span>(i=0; i&lt;NCONTSTEPS; i++) {
01401         ratmp = fraz*(180.0/M_PI)+xoff ;
01402         dectmp = fdecz*(180.0/M_PI)+xoff ;
01403         frahh[i] = floor(ratmp*24./360.+0.0001) ;
01404         framm[i] = floor((ratmp*24./360.-frahh[i])*60.+0.0001) ;
01405         irahh[i] = (<span class="keywordtype">int</span>)floor(frahh[i]+0.0001) ;
01406         iramm[i] = (<span class="keywordtype">int</span>)floor(framm[i]+0.0001) ;
01407 
01408         <span class="keywordflow">if</span> (dectmp&lt;0) dectmp2 = dectmp*-1;
01409         <span class="keywordflow">else</span> dectmp2 = dectmp;
01410 
01411         fdecdd[i] = floor((dectmp2+0.0001)) ;
01412         fdecmm[i] = floor((dectmp2-fdecdd[i])*60.+0.0001) ;
01413         idecdd[i] = (<span class="keywordtype">int</span>)floor(fdecdd[i]+0.001) ;
01414         idecmm[i] = (<span class="keywordtype">int</span>)floor(fdecmm[i]+0.001) ;
01415 
01416         <span class="keywordflow">if</span> (dectmp&lt;0) {
01417             fdecdd[i] *= -1;
01418             idecdd[i] *= -1;
01419         }
01420 
01421         xoff += dx ;
01422         
01423         dec_nice[i] = dectmp /= (180.0/M_PI) ;
01424         ra_nice[i] = ratmp /= (180.0/M_PI) ;
01425 
01426         denom = sin(dec)*sin(dectmp)+cos(dec)*cos(dectmp)*cos(ratmp-ra) ;
01427         <span class="keywordflow">if</span>(denom &gt; 0.0) {
01428             xcont[i]=-(180.0/M_PI)*cos(dectmp)*sin(ratmp-ra)/denom ;
01429             ycont[i]=(180.0/M_PI)*(cos(dec)*sin(dectmp)-
01430                                   sin(dec)*cos(dectmp)*cos(ratmp-ra))/denom ;
01431             <span class="keywordflow">if</span>((xcont[i] &gt; _minx) &amp;&amp; (xcont[i] &lt; _maxx)) 
01432                 drawx[i] = 1 ;
01433             <span class="keywordflow">else</span> 
01434                 drawx[i] = 0 ;
01435             <span class="keywordflow">if</span>((ycont[i] &gt; _miny) &amp;&amp; (ycont[i] &lt; _maxy)) 
01436                 drawy[i] = 1 ;
01437             <span class="keywordflow">else</span> 
01438                 drawy[i] = 0 ;
01439         } 
01440         <span class="keywordflow">else</span> {
01441             xcont[i] = 1000.0 ;
01442             ycont[i] = 1000.0 ;
01443             drawx[i] = 0 ;
01444             drawy[i] = 0 ;
01445         }
01446         
01447         sprintf(ra_str[i], <span class="stringliteral">"%2d\\sph\\ep%2d\\spm\\ep"</span>, irahh[i], iramm[i]) ;
01448         sprintf(dec_str[i], <span class="stringliteral">"%3d\\de%02d'"</span>, idecdd[i], idecmm[i]) ;
01449     } 
01450 
01451 } 
01452                            
01453     
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:46 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
