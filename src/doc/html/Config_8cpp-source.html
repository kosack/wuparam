<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: Config.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Config.cpp</h1><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">// Config.cpp  - reads analysis configuration from file</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// Karl Kosack &lt;kosack@hbar.wustl.edu&gt;</span>
00005 
00006 
00007 <span class="preprocessor">#include &lt;fstream&gt;</span>
00008 <span class="preprocessor">#include &lt;string&gt;</span>
00009 <span class="preprocessor">#include &lt;queue&gt;</span>
00010 <span class="preprocessor">#include &lt;sstream&gt;</span>
00011 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00012 <span class="preprocessor">#include &lt;cctype&gt;</span>
00013 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00014 <span class="preprocessor">#include &lt;cstring&gt;</span>
00015 <span class="preprocessor">#include &lt;glob.h&gt;</span>
00016 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00017 <span class="preprocessor">#include &lt;map&gt;</span>
00018 
00019 <span class="preprocessor">#include "Config.h"</span>
00020 <span class="preprocessor">#include "Exceptions.h"</span>
00021 <span class="preprocessor">#include "Types.h"</span>
00022 
00023 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00024 
00025 Config::Config(<span class="keywordtype">char</span> *filename) {
00026     
00027     <span class="comment">// init variables with defaults:</span>
00028 
00029     _curinfo.<a class="code" href="classRunInfo.html#o12">ntubes</a> = 0;
00030     _curinfo.<a class="code" href="classRunInfo.html#o4">onid</a> = <span class="stringliteral">""</span>;
00031     _curinfo.<a class="code" href="classRunInfo.html#o5">offid</a> = <span class="stringliteral">""</span>;
00032     _curinfo.<a class="code" href="classRunInfo.html#o6">n2id</a> = <span class="stringliteral">""</span>;
00033     _curinfo.<a class="code" href="classRunInfo.html#o3">sourcename</a> = <span class="stringliteral">""</span>;
00034     _curinfo.<a class="code" href="classRunInfo.html#o8">arrayconfig</a> = <span class="stringliteral">"whipple-1"</span>;
00035     _curinfo.<a class="code" href="classRunInfo.html#o9">ra</a> = 0.0;
00036     _curinfo.<a class="code" href="classRunInfo.html#o10">dec</a>= 0.0;
00037     _curinfo.<a class="code" href="classRunInfo.html#o11">zenithoverride</a>=0.0;
00038     _curinfo.<a class="code" href="classRunInfo.html#o1">datadir</a>=<span class="stringliteral">"./"</span>;
00039     _curinfo.<a class="code" href="classRunInfo.html#o2">cachedir</a>=<span class="stringliteral">"./"</span>;
00040     _curinfo.<a class="code" href="classRunInfo.html#o13">picthresh</a>=4.25;
00041     _curinfo.<a class="code" href="classRunInfo.html#o14">bndthresh</a>=2.25;
00042     _curinfo.<a class="code" href="classRunInfo.html#o17">padding</a> = <span class="keyword">true</span>;
00043     _curinfo.<a class="code" href="classRunInfo.html#o19">derotation</a> = <span class="keyword">true</span>;
00044     _curinfo.<a class="code" href="classRunInfo.html#o21">outtype</a> = Config::TEXT;
00045     _curinfo.<a class="code" href="classRunInfo.html#o15">padlevel</a> = 5.0;
00046     _curinfo.<a class="code" href="classRunInfo.html#o16">utbase</a> = 50000.0; 
00047     _curinfo.<a class="code" href="classRunInfo.html#o20">muoncalibrate</a>=<span class="keyword">false</span>;
00048     _curinfo.<a class="code" href="classRunInfo.html#o23">muon_threshold</a> = 0.7;
00049     _curinfo.<a class="code" href="classRunInfo.html#o25">mcdatabase</a> = <span class="stringliteral">"/data/Whipple/Simulations/mall.dat"</span>;
00050     _curinfo.<a class="code" href="classRunInfo.html#o27">emin_tev</a> = 0.01;
00051     _curinfo.<a class="code" href="classRunInfo.html#o28">emax_tev</a> = 128.0;
00052     _curinfo.<a class="code" href="classRunInfo.html#o29">num_e_bins</a> = 27;
00053     _curinfo.<a class="code" href="classRunInfo.html#o24">cuttype</a> = Config::SUPERCUTTER;
00054     _curinfo.<a class="code" href="classRunInfo.html#o26">energyestimator</a> = <span class="stringliteral">"SZA"</span>;
00055 
00056 
00057     _curinfo.<a class="code" href="classRunInfo.html#o31">camera_offset_analysis</a> = <span class="keyword">false</span>;
00058     _curinfo.<a class="code" href="classRunInfo.html#o32">camera_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>=0.0;
00059     _curinfo.<a class="code" href="classRunInfo.html#o32">camera_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>=0.0;
00060 
00061     _curinfo.<a class="code" href="classRunInfo.html#o33">max_ped_events</a> = 1e6;
00062 
00063     _curinfo.<a class="code" href="classRunInfo.html#o34">image_filter</a> = <span class="keyword">false</span>;
00064     _curinfo.<a class="code" href="classRunInfo.html#o35">filter_amount</a> = 0.3;
00065     _curinfo.<a class="code" href="classRunInfo.html#o36">filter_subdivide</a> = 3;
00066     _curinfo.<a class="code" href="classRunInfo.html#o37">filter_iter</a> = 2;
00067     _curinfo.<a class="code" href="classRunInfo.html#o38">filter_smoothness</a> = 0.0;
00068     _curinfo.<a class="code" href="classRunInfo.html#o39">filter_percent</a> = 0.25;
00069     _curinfo.<a class="code" href="classRunInfo.html#o40">filter_threshold</a> = 1.5;
00070 
00071     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;1024; i++)
00072         _curinfo.<a class="code" href="classRunInfo.html#o30">tubemask</a>[i] = 0;
00073 
00074     cout &lt;&lt; <span class="stringliteral">"Reading configuration..."</span> &lt;&lt; endl;
00075     parse( filename );
00076     cout &lt;&lt; <span class="stringliteral">"Done reading configuration."</span> &lt;&lt; endl;
00077 
00078 
00079 }
00080 
00081 
00082 <span class="keywordtype">void</span>
00083 Config::openFailed(<span class="keywordtype">char</span> *filename) {
00084 
00085     string answer;
00086     cout &lt;&lt;endl;
00087     cout &lt;&lt; <span class="stringliteral">"The configuration file you specified ('"</span>&lt;&lt; filename 
00088          &lt;&lt;<span class="stringliteral">"') doesn't exist."</span> &lt;&lt; endl;
00089     cout &lt;&lt; <span class="stringliteral">"Would you like to generate a sample configuration "</span>
00090          &lt;&lt; <span class="stringliteral">"file (y/n)?"</span>&lt;&lt;endl;
00091     cin &gt;&gt; answer;
00092     
00093     <span class="keywordflow">if</span> (answer == <span class="stringliteral">"y"</span> || answer == <span class="stringliteral">"Y"</span>) {
00094         
00095         <a class="code" href="classConfig.html#a2">writeSample</a>(filename);
00096         cout &lt;&lt; <span class="stringliteral">"*** A sample configuration file has been written to '"</span>
00097              &lt;&lt; filename &lt;&lt; <span class="stringliteral">"'. Please "</span> &lt;&lt; endl 
00098              &lt;&lt; <span class="stringliteral">"*** edit it and try again."</span> &lt;&lt;endl;
00099         exit(1);
00100         
00101     }
00102     
00103     <span class="keywordflow">throw</span>(<a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Config file didn't exist."</span>));
00104 
00105 }
00106 
00107 
00108 Config::~Config() {
00109 
00110 
00111 }
00112 
00117 <a class="code" href="classRunInfo.html">RunInfo</a> 
<a name="l00118"></a><a class="code" href="classConfig.html#a3">00118</a> <a class="code" href="classConfig.html#a3">Config::getNextRun</a>() { 
00119     
00120     <a class="code" href="classRunInfo.html">RunInfo</a> ri = ((<a class="code" href="classRunInfo.html">RunInfo</a> &amp;) _runqueue.front());
00121     
00122     <span class="keywordflow">if</span> (!_runqueue.empty()) {
00123         _runqueue.pop_front();
00124     }
00125     <span class="keywordflow">else</span> 
00126         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html">MildAnalysisException</a>(<span class="stringliteral">"No more runs in config file."</span>);
00127 
00128     <span class="keywordflow">return</span> ri;
00129 }    
00130 
00131 
00136 <span class="keywordtype">void</span>
00137 Config::parse( <span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> level ) {
00138 
00139     <span class="keywordtype">char</span> buffer[128];
00140     <span class="keywordtype">int</span> i;
00141     <span class="keywordtype">int</span> num=0;
00142     <span class="keywordtype">bool</span> errorflag = <span class="keyword">false</span>;
00143     string line;
00144     std::string key,value;
00145     ifstream conf;
00146 
00147     <span class="comment">// Bail out of recursion limit is met</span>
00148     
00149     <span class="keywordflow">if</span> (level &gt; 100) {
00150         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Level of 'Include' recursion is too deep!"</span>);
00151     }
00152 
00153     <span class="comment">// open file</span>
00154 
00155     conf.open( filename, ios::in );
00156 
00157     <span class="keywordflow">if</span> (conf.fail()) {
00158         conf.close();
00159         conf.clear();
00160         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;level+1; k++) cout &lt;&lt; <span class="stringliteral">"  "</span>;
00161         cout &lt;&lt; <span class="stringliteral">"Looking for '"</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">"' in $WUPARAMDIR "</span>&lt;&lt;endl;
00162         string supportfile = getSupportDir() +  filename;
00163         conf.open( supportfile.c_str(), ios::in );
00164         <span class="keywordflow">if</span> (!conf) {
00165             openFailed( filename );
00166             <span class="keywordflow">throw</span>(<a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Couldn't open config file: "</span>
00167                                             +supportfile));
00168         }
00169     }
00170 
00171     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;level+1; k++) cout &lt;&lt; <span class="stringliteral">"  "</span>;
00172     cout &lt;&lt; <span class="stringliteral">"reading from '"</span>&lt;&lt; filename &lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt;endl;
00173 
00174     <span class="comment">// read config file....</span>
00175 
00176     <span class="keywordflow">while</span> (conf) {
00177 
00178         conf.getline( buffer, 128 );
00179         line = buffer;
00180         
00181         i = line.find(<span class="stringliteral">"#"</span>);
00182         line = line.substr(0,i);
00183 
00184         num++;
00185 
00186         <span class="keywordflow">if</span>(line.length() &gt; 0 ) {
00187 
00188             <span class="keywordflow">if</span> ( (i=line.find(<span class="charliteral">'='</span>))&gt;0 ) {
00189             
00190                 key = line.substr(0,i);
00191                 value=line.substr(i+1,line.length());
00192 
00193                 <span class="comment">// convert to lower case and strip off white space</span>
00194                 transform(key.begin(),key.end(), key.begin(),
00195                           (int(*)(<span class="keywordtype">int</span>))tolower);
00196                 removeWhiteSpace( key );
00197                 removeWhiteSpace( value );
00198 
00199                 <span class="comment">//-----------------------------------</span>
00200                 <span class="comment">// Handle each key/value pair...</span>
00201                 <span class="comment">//-----------------------------------</span>
00202 
00203                 <span class="comment">// source name override</span>
00204 
00205                 <span class="keywordflow">if</span> ( key == <span class="stringliteral">"overridesource"</span> ) {
00206 
00207                     _curinfo.<a class="code" href="classRunInfo.html#o3">sourcename</a> = value;
00208 
00209                 }
00210 
00211                 <span class="comment">// Set data directory:</span>
00212                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"datadir"</span> ) {
00213                     
00214                     _curinfo.<a class="code" href="classRunInfo.html#o1">datadir</a> = value;
00215                     <span class="keywordflow">if</span> (_curinfo.<a class="code" href="classRunInfo.html#o1">datadir</a>[_curinfo.<a class="code" href="classRunInfo.html#o1">datadir</a>.size()-1] != <span class="charliteral">'/'</span>)
00216                         _curinfo.<a class="code" href="classRunInfo.html#o1">datadir</a> += <span class="stringliteral">"/"</span>;
00217 
00218                 }
00219 
00220                 <span class="comment">// Set peds directory:</span>
00221                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"cachedir"</span> ) {
00222                     
00223                     _curinfo.<a class="code" href="classRunInfo.html#o2">cachedir</a> = value;
00224                     <span class="keywordflow">if</span> (_curinfo.<a class="code" href="classRunInfo.html#o2">cachedir</a>[_curinfo.<a class="code" href="classRunInfo.html#o2">cachedir</a>.size()-1] != <span class="charliteral">'/'</span>)
00225                         _curinfo.<a class="code" href="classRunInfo.html#o2">cachedir</a> += <span class="stringliteral">"/"</span>;
00226 
00227                 }
00228 
00229                 <span class="comment">// Set peds directory:</span>
00230                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"arrayconfig"</span> ) {    
00231                     _curinfo.<a class="code" href="classRunInfo.html#o8">arrayconfig</a> = value;
00232                 }
00233                 
00234                 <span class="comment">// Parse cut values</span>
00235                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key.substr(0,3) == <span class="stringliteral">"cut"</span>) {
00236                     
00237                     <span class="keywordtype">int</span> i = value.find(<span class="stringliteral">","</span>,0);
00238                     <span class="keywordtype">double</span> min=0,max=0;
00239 
00240                     <span class="keywordflow">if</span> (i&lt;=0) {
00241                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: (line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00242                              &lt;&lt; <span class="stringliteral">"Cuts should specify "</span>
00243                              &lt;&lt; <span class="stringliteral">"lower,upper bounds (separated by comma)"</span>
00244                              &lt;&lt; endl;
00245                         errorflag=<span class="keyword">true</span>;
00246                         <span class="keywordflow">continue</span>;
00247                     }
00248 
00249                     value[i] = <span class="charliteral">' '</span>;
00250                     istringstream ist(value);
00251                     ist &gt;&gt; min &gt;&gt; max;
00252 
00253                     <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutalpha"</span>) {
00254                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o2">alpha</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00255                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o2">alpha</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00256                     }
00257                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutlength"</span>) {
00258                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o4">length</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00259                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o4">length</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00260                     }
00261                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutwidth"</span>) {
00262                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o5">width</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00263                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o5">width</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00264                     }
00265                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutdistance"</span>) {
00266                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o3">distance</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00267                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o3">distance</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00268                     }
00269                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutsize"</span>) {
00270                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o6">size</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00271                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o6">size</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00272                     }
00273                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutlensize"</span>) {
00274                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o7">lensize</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00275                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o7">lensize</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00276                     }
00277                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutmax1"</span>) {
00278                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o8">max1</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00279                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o8">max1</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00280                     }
00281                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutmax2"</span>) {
00282                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o9">max2</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00283                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o9">max2</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00284                     }
00285                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutmax3"</span>) {
00286                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o10">max3</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00287                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o10">max3</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00288                     }
00289                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutfrac3"</span>) {
00290                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o11">frac3</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00291                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o11">frac3</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00292                     }
00293                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cutasymmdist"</span>) {
00294                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o12">asymmdist</a>.<a class="code" href="structCut.html#o0">lower</a> = min;
00295                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o12">asymmdist</a>.<a class="code" href="structCut.html#o1">upper</a> = max;
00296                     }
00297                     <span class="keywordflow">else</span> {
00298                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: (line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00299                              &lt;&lt; <span class="stringliteral">"Unknown cut '"</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">"'"</span> &lt;&lt; endl;
00300                         errorflag=<span class="keyword">true</span>;
00301                         <span class="keywordflow">continue</span>;                       
00302                     }
00303 
00304                 }
00305                 
00306                 <span class="comment">// SpectralCuts parameters</span>
00307                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"spectralcutdeltalength"</span>) {
00308                     _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o13">dlength</a> = atof(value.c_str());
00309                 }
00310                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"spectralcutdeltawidth"</span>) {
00311                     _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o14">dwidth</a> = atof(value.c_str());
00312                 }
00313                 
00314 
00315                 <span class="comment">// On/Off Pair - parse on,off,n2</span>
00316 
00317                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"pr"</span> ) {
00318 
00319                     istringstream ist(value);
00320 
00321                     <span class="keywordflow">if</span>( !((ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o4">onid</a>) &amp;&amp; 
00322                         (ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o5">offid</a>) &amp;&amp;
00323                         (ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o6">n2id</a>) &amp;&amp;
00324                           (ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o7">utdate</a>))) {
00325 
00326                         errorflag = 1;
00327                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: "</span>
00328                              &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00329                              &lt;&lt; <span class="stringliteral">"should be tr=onid offid n2id utdate"</span>&lt;&lt;endl;
00330                         <span class="keywordflow">continue</span>;
00331                     }
00332 
00333                     _curinfo.<a class="code" href="classRunInfo.html#o0">type</a>  = ONOFF;
00334 
00335                     <span class="keywordflow">if</span> (_curinfo.<a class="code" href="classRunInfo.html#o7">utdate</a>.length() != 6 ){
00336                         cout &lt;&lt;<span class="stringliteral">"** WARNING: utdate '"</span>&lt;&lt;_curinfo.<a class="code" href="classRunInfo.html#o7">utdate</a>
00337                              &lt;&lt; <span class="stringliteral">"' looks suspect at line "</span>
00338                              &lt;&lt;num&lt;&lt; endl;
00339                     } 
00340                     
00341 
00342                     <span class="comment">// if alignment is enabled, look in alignment list</span>
00343                     <span class="comment">// for the runid and set alignment accordingly</span>
00344 
00345                     <span class="keywordflow">if</span> (_curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o18">alignment</a> == <span class="keyword">true</span>) {
00346                         map&lt;string,Coordinate_t&gt;::iterator coord;
00347                         
00348                         coord = _alignmap.find(_curinfo.<a class="code" href="classRunInfo.html#o4">onid</a>);
00349                         
00350                         <span class="keywordflow">if</span> (coord != _alignmap.end()){
00351                             
00352                             _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o19">align_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a> 
00353                                 = _alignmap[_curinfo.<a class="code" href="classRunInfo.html#o4">onid</a>].x;
00354                             _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o19">align_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>
00355                                 = _alignmap[_curinfo.<a class="code" href="classRunInfo.html#o4">onid</a>].y;
00356 
00357                         }
00358 
00359                     }
00360 
00361                     addRun();
00362 
00363                 }
00364 
00365                 <span class="comment">// Tracking run  - parse run,n2</span>
00366 
00367                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key==<span class="stringliteral">"tr"</span>) {
00368 
00369                     vector&lt;string&gt; tokens;
00370 
00371                     tokenize( value, tokens );
00372 
00373                     <span class="keywordflow">if</span> ( tokens.size() == 3 ) {
00374                         _curinfo.<a class="code" href="classRunInfo.html#o4">onid</a> = tokens[0];
00375                         _curinfo.<a class="code" href="classRunInfo.html#o5">offid</a> = <span class="stringliteral">""</span>;
00376                         _curinfo.<a class="code" href="classRunInfo.html#o6">n2id</a> = tokens[1];
00377                         _curinfo.<a class="code" href="classRunInfo.html#o7">utdate</a> = tokens[2];
00378                         _curinfo.<a class="code" href="classRunInfo.html#o18">pad_track_with_run</a> = <span class="keyword">false</span>;
00379                     }
00380                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( tokens.size() == 4 ) {
00381                         _curinfo.<a class="code" href="classRunInfo.html#o4">onid</a> = tokens[0];
00382                         _curinfo.<a class="code" href="classRunInfo.html#o5">offid</a> = tokens[1];
00383                         _curinfo.<a class="code" href="classRunInfo.html#o6">n2id</a> = tokens[2];
00384                         _curinfo.<a class="code" href="classRunInfo.html#o7">utdate</a> = tokens[3];
00385                         _curinfo.<a class="code" href="classRunInfo.html#o18">pad_track_with_run</a> = <span class="keyword">true</span>;
00386 
00387                     }
00388                     <span class="keywordflow">else</span> {
00389 
00390                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: "</span>
00391                              &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00392                              &lt;&lt; <span class="stringliteral">"should be tr=onid &lt;padid&gt; n2id utdate"</span>
00393                              &lt;&lt;endl;
00394                         
00395                         errorflag = <span class="keyword">true</span>;
00396                         <span class="keywordflow">continue</span>;
00397                     }
00398 
00399                     _curinfo.<a class="code" href="classRunInfo.html#o0">type</a>   = TRACK;
00400                         
00401                     addRun();
00402 
00403                 }
00404 
00405                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"picturethresh"</span>) {
00406 
00407                     istringstream ist(value);
00408                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o13">picthresh</a>;
00409 
00410                 }
00411 
00412                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"boundarythresh"</span>) {
00413 
00414                     istringstream ist(value);
00415                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o14">bndthresh</a>;
00416 
00417                 }
00418 
00419                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"trackingratio"</span>) {
00420 
00421                     istringstream ist(value);
00422                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o0">tracking_ratio</a>;
00423 
00424                 }
00425 
00426                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"smoothingradius"</span>) {
00427 
00428                     istringstream ist(value);
00429                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o15">smoothing_radius</a>;
00430 
00431                 }
00432 
00433                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"radialanalysis"</span>) {
00434                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>)
00435                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o16">radial_analysis</a>=<span class="keyword">true</span>;
00436                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>)
00437                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o16">radial_analysis</a>=<span class="keyword">false</span>;
00438                     <span class="keywordflow">else</span> {
00439                         errorflag = 1;
00440                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: "</span>
00441                              &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00442                              &lt;&lt; <span class="stringliteral">"should be true or false"</span>&lt;&lt;endl;
00443                     }
00444                         
00445                 }
00446 
00447                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"xradialoffset"</span>) {
00448 
00449                     istringstream ist(value);
00450                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o17">radial_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>;
00451 
00452                 }
00453 
00454                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"yradialoffset"</span>) {
00455 
00456                     istringstream ist(value);
00457                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o17">radial_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>;
00458 
00459                 }
00460 
00461                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"cameraoffset"</span>) {
00462                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>)
00463                         _curinfo.<a class="code" href="classRunInfo.html#o31">camera_offset_analysis</a>=<span class="keyword">true</span>;
00464                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>)
00465                         _curinfo.<a class="code" href="classRunInfo.html#o31">camera_offset_analysis</a>=<span class="keyword">false</span>;
00466                     <span class="keywordflow">else</span> {
00467                         errorflag = 1;
00468                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: "</span>
00469                              &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00470                              &lt;&lt; <span class="stringliteral">"should be true or false"</span>&lt;&lt;endl;
00471                     }
00472                         
00473                 }
00474 
00475                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"xcameraoffset"</span>) {
00476 
00477                     istringstream ist(value);
00478                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o32">camera_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>;
00479 
00480                 }
00481 
00482                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"ycameraoffset"</span>) {
00483 
00484                     istringstream ist(value);
00485                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o32">camera_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>;
00486 
00487                 }
00488 
00489                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"alignmentfile"</span> ) {
00490                     loadAlignmentMap(value);
00491                 }
00492                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"alignment"</span>) {
00493                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>)
00494                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o18">alignment</a>=<span class="keyword">true</span>;
00495                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>)
00496                         _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o18">alignment</a>=<span class="keyword">false</span>;
00497                     <span class="keywordflow">else</span> {
00498                         errorflag = 1;
00499                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: "</span>
00500                              &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00501                              &lt;&lt; <span class="stringliteral">"should be true or false"</span>&lt;&lt;endl;
00502                     }
00503                         
00504                 }
00505 
00506                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"xalign"</span>) {
00507 
00508                     istringstream ist(value);
00509                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o19">align_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>;
00510 
00511                 }
00512 
00513                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"yalign"</span>) {
00514 
00515                     istringstream ist(value);
00516                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o19">align_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>;
00517 
00518                 }
00519 
00520                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"lightcurveutbase"</span>) {
00521 
00522                     istringstream ist(value);
00523                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o16">utbase</a>;
00524 
00525                 }
00526 
00527                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"montecarlodatabase"</span>) {
00528 
00529                     _curinfo.<a class="code" href="classRunInfo.html#o25">mcdatabase</a> = value;
00530 
00531                 }
00532 
00533                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"energyestimator"</span>) {
00534 
00535                     _curinfo.<a class="code" href="classRunInfo.html#o26">energyestimator</a> = value;
00536 
00537                 }
00538 
00539                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"energyrangetev"</span>) {
00540                     vector&lt;string&gt; tmptok;
00541                     tokenize( value, tmptok,<span class="stringliteral">","</span>);
00542                     <span class="keywordflow">if</span> (tmptok.size() == 2) {
00543                         _curinfo.<a class="code" href="classRunInfo.html#o27">emin_tev</a> = atof(tmptok[0].c_str()); 
00544                         _curinfo.<a class="code" href="classRunInfo.html#o28">emax_tev</a> = atof(tmptok[1].c_str()); 
00545                     }
00546                     <span class="keywordflow">else</span> {
00547                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: EnergyRangeTeV must be "</span>
00548                              &lt;&lt; <span class="stringliteral">"min,max "</span>
00549                              &lt;&lt; <span class="stringliteral">"at line "</span>&lt;&lt; num &lt;&lt; endl;
00550                         errorflag = <span class="keyword">true</span>;
00551                     }
00552                 }
00553 
00554 
00555                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"energybins"</span>) {
00556                     _curinfo.<a class="code" href="classRunInfo.html#o29">num_e_bins</a> = atoi(value.c_str()); 
00557                 }
00558 
00559                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"overridera"</span> ) {
00560 
00561                     istringstream ist(value);
00562                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o9">ra</a>;
00563 
00564                 }
00565                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"overridedec"</span> ) {
00566 
00567                     istringstream ist(value);
00568                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o10">dec</a>;
00569                     
00570                 }
00571                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key == <span class="stringliteral">"overridezenith"</span> ) {
00572 
00573                     istringstream ist(value);
00574                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o11">zenithoverride</a>;
00575                     
00576                 }
00577                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"padding"</span>) {
00578                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>) {
00579                         _curinfo.<a class="code" href="classRunInfo.html#o17">padding</a> = <span class="keyword">true</span>;
00580                     }
00581                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>) {
00582                         _curinfo.<a class="code" href="classRunInfo.html#o17">padding</a> = <span class="keyword">false</span>;
00583                     }
00584                     <span class="keywordflow">else</span> {
00585                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: padding must be "</span>
00586                              &lt;&lt; <span class="stringliteral">"'true' or 'false' "</span>
00587                              &lt;&lt; <span class="stringliteral">"at line "</span>&lt;&lt; num &lt;&lt; endl;
00588                         errorflag = <span class="keyword">true</span>;
00589                     }
00590                 }
00591                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"padlevel"</span>) {
00592                     istringstream ist(value);
00593                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o15">padlevel</a>;
00594                 }
00595                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"elongation"</span>) {
00596                     istringstream ist(value);
00597                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o22">cuts</a>.<a class="code" href="structCutInfo.html#o1">elongation</a>;
00598                 }
00599                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"maxpedestalevents"</span>) {
00600                     istringstream ist(value);
00601                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o33">max_ped_events</a>;
00602                 }
00603                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"derotation"</span>) {
00604                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>) {
00605                         _curinfo.<a class="code" href="classRunInfo.html#o19">derotation</a> = <span class="keyword">true</span>;
00606                     }
00607                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>) {
00608                         _curinfo.<a class="code" href="classRunInfo.html#o19">derotation</a> = <span class="keyword">false</span>;
00609                     }
00610                     <span class="keywordflow">else</span> {
00611                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: derotation must be "</span>
00612                              &lt;&lt; <span class="stringliteral">"'true' or 'false' "</span>
00613                              &lt;&lt; <span class="stringliteral">"at line "</span>&lt;&lt; num &lt;&lt; endl;
00614                         errorflag = <span class="keyword">true</span>;
00615                     }
00616                 }
00617 
00618                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"muoncalibration"</span>) {
00619                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>) {
00620                         _curinfo.<a class="code" href="classRunInfo.html#o20">muoncalibrate</a> = <span class="keyword">true</span>;
00621                     }
00622                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>) {
00623                         _curinfo.<a class="code" href="classRunInfo.html#o20">muoncalibrate</a> = <span class="keyword">false</span>;
00624                     }
00625                     <span class="keywordflow">else</span> {
00626                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: MuonCalibration must be "</span>
00627                              &lt;&lt; <span class="stringliteral">"'true' or 'false' "</span>
00628                              &lt;&lt; <span class="stringliteral">"at line "</span>&lt;&lt; num &lt;&lt; endl;
00629                         errorflag = <span class="keyword">true</span>;
00630                     }
00631                 }
00632 
00633                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"muonthreshold"</span>) {
00634                     istringstream ist(value);
00635                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o23">muon_threshold</a>;
00636                 }
00637 
00638 
00639                 <span class="comment">// Choose output type</span>
00640 
00641                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"outputtype"</span>) {
00642 
00643                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"ntuple"</span> ) {
00644                         _curinfo.<a class="code" href="classRunInfo.html#o21">outtype</a> = Config::NTUPLE;
00645                     }
00646                         
00647                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value ==  <span class="stringliteral">"text"</span>) {
00648                         _curinfo.<a class="code" href="classRunInfo.html#o21">outtype</a> = Config::TEXT;
00649                     }
00650                     <span class="keywordflow">else</span> {
00651                         cerr &lt;&lt; <span class="stringliteral">"*** Unknown output type '"</span>&lt;&lt;value&lt;&lt;<span class="stringliteral">"', using "</span>
00652                              &lt;&lt; <span class="stringliteral">" TEXT instead"</span>&lt;&lt; endl;
00653                         _curinfo.<a class="code" href="classRunInfo.html#o21">outtype</a> = Config::TEXT;
00654                     }
00655 
00656                 }
00657 
00658 
00659                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"usecuttype"</span>) {
00660                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"supercuts"</span>){
00661                         _curinfo.<a class="code" href="classRunInfo.html#o24">cuttype</a> = Config::SUPERCUTTER;
00662                     }
00663                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( value == <span class="stringliteral">"zcuts"</span> ){
00664                         _curinfo.<a class="code" href="classRunInfo.html#o24">cuttype</a> = Config::ZCUTTER;
00665                     }
00666                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( value == <span class="stringliteral">"spectralcuts"</span> ){
00667                         _curinfo.<a class="code" href="classRunInfo.html#o24">cuttype</a> = Config::SPECTRALCUTTER;
00668                     }
00669                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( value == <span class="stringliteral">"ezcuts"</span> ){
00670                         _curinfo.<a class="code" href="classRunInfo.html#o24">cuttype</a> = Config::EZCUTTER;
00671                     }
00672                     <span class="keywordflow">else</span> {
00673                         cerr &lt;&lt; <span class="stringliteral">"*** Unknown cut type '"</span>&lt;&lt;value&lt;&lt;<span class="stringliteral">"', using "</span>
00674                              &lt;&lt; <span class="stringliteral">" SuperCuts instead"</span>&lt;&lt; endl;
00675                         _curinfo.<a class="code" href="classRunInfo.html#o21">outtype</a> = Config::SUPERCUTTER;
00676                     }
00677 
00678                 }
00679 
00680                 <span class="comment">// handle tube masking</span>
00681 
00682                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key==<span class="stringliteral">"masktubes"</span> ) {
00683 
00684                     vector&lt;string&gt; tokens;
00685                     tokenize( value, tokens );
00686                     <span class="keywordtype">int</span> tube;
00687 
00688                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;tokens.size(); k++) {
00689                         
00690                         tube = atoi( tokens[k].c_str() );
00691 
00692                         <span class="keywordflow">if</span> (tube &gt;= 0 &amp;&amp; tube&lt;1024) {
00693                             _curinfo.<a class="code" href="classRunInfo.html#o30">tubemask</a>[tube] = 1;
00694                         }
00695                         <span class="keywordflow">else</span> {
00696                             cout &lt;&lt; <span class="stringliteral">"** ERROR: invalid tube "</span>&lt;&lt;tube
00697                                  &lt;&lt; <span class="stringliteral">" at line "</span>&lt;&lt;num&lt;&lt;endl;
00698                             errorflag =<span class="keyword">true</span>;
00699                         }
00700 
00701                     }
00702 
00703                 }
00704                 
00705                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( key==<span class="stringliteral">"unmasktubes"</span> ) {
00706 
00707                     vector&lt;string&gt; tokens;
00708                     tokenize( value, tokens );
00709                     <span class="keywordtype">int</span> tube;
00710 
00711                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;tokens.size(); k++) {
00712                         
00713                         tube = atoi( tokens[k].c_str() );
00714                         <span class="keywordflow">if</span> (tube &gt;= 0 &amp;&amp; tube&lt;1024) {
00715                             _curinfo.<a class="code" href="classRunInfo.html#o30">tubemask</a>[tube] = 0;
00716                         }
00717                         <span class="keywordflow">else</span> {
00718                             cout &lt;&lt; <span class="stringliteral">"** ERROR: invalid tube "</span>&lt;&lt;tube
00719                                  &lt;&lt; <span class="stringliteral">" at line "</span>&lt;&lt;num&lt;&lt;endl;
00720                             errorflag=<span class="keyword">true</span>;
00721                         }
00722                     }
00723 
00724                 }
00725 
00726                  
00727                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"imagefilter"</span>) {
00728                     <span class="keywordflow">if</span> (value == <span class="stringliteral">"true"</span>)
00729                         _curinfo.<a class="code" href="classRunInfo.html#o34">image_filter</a>=<span class="keyword">true</span>;
00730                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"false"</span>)
00731                         _curinfo.<a class="code" href="classRunInfo.html#o34">image_filter</a>=<span class="keyword">false</span>;
00732                     <span class="keywordflow">else</span> {
00733                         errorflag = 1;
00734                         cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: "</span>
00735                              &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00736                              &lt;&lt; <span class="stringliteral">"should be true or false"</span>&lt;&lt;endl;
00737                     }
00738                 }
00739 
00740                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"filteramount"</span>) {
00741                     istringstream ist(value);
00742                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o35">filter_amount</a>;
00743                 }
00744 
00745                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"filtersubdivide"</span>) {
00746                     istringstream ist(value);
00747                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o36">filter_subdivide</a>;
00748                 }
00749 
00750                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"filteriter"</span>) {
00751                     istringstream ist(value);
00752                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o37">filter_iter</a>;
00753                 }
00754 
00755                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"filtersmoothness"</span>) {
00756                     istringstream ist(value);
00757                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o38">filter_smoothness</a>;
00758                 }
00759 
00760                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"filterpercent"</span>) {
00761                     istringstream ist(value);
00762                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o39">filter_percent</a>;
00763                 }
00764                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"filterthresh"</span>) {
00765                     istringstream ist(value);
00766                     ist &gt;&gt; _curinfo.<a class="code" href="classRunInfo.html#o40">filter_threshold</a>;
00767                 }
00768 
00769                 <span class="comment">// handle included files (recursively call parse())</span>
00770 
00771                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">"include"</span>) {
00772 
00773                     parse( (<span class="keywordtype">char</span>*)value.c_str(), level+1 );
00774                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;level+1; k++)
00775                         cout &lt;&lt; <span class="stringliteral">"  "</span>;
00776                     cout &lt;&lt; <span class="stringliteral">"proceeding with '"</span>&lt;&lt; filename 
00777                          &lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt; endl;
00778 
00779                 }
00780 
00781                 <span class="comment">// unknown key/value</span>
00782                 <span class="keywordflow">else</span> {
00783 
00784                     cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR: unrecognized setting: "</span>
00785                          &lt;&lt; key &lt;&lt; endl;
00786  
00787                     errorflag = <span class="keyword">true</span>;
00788                     
00789                 }
00790 
00791             }
00792             <span class="keywordflow">else</span> {
00793 
00794                 cerr &lt;&lt; <span class="stringliteral">"** SYNTAX ERROR "</span>
00795                      &lt;&lt; <span class="stringliteral">"(line "</span>&lt;&lt;num&lt;&lt;<span class="stringliteral">") "</span>
00796                      &lt;&lt; <span class="stringliteral">"commands should be in form: key=value"</span>&lt;&lt;endl;
00797                 
00798                 errorflag = <span class="keyword">true</span>;
00799 
00800             }
00801             
00802         }
00803 
00804         <span class="keywordflow">if</span> (errorflag==<span class="keyword">true</span>) {
00805 
00806             cout &lt;&lt; <span class="charliteral">'\a'</span>;  <span class="comment">// sound a bell</span>
00807             cout &lt;&lt; endl 
00808                  &lt;&lt; <span class="stringliteral">"*******************************************************"</span>
00809                  &lt;&lt; endl
00810                  &lt;&lt; <span class="stringliteral">"** There was a syntax error in the configuration file"</span> 
00811                  &lt;&lt; endl
00812                  &lt;&lt; <span class="stringliteral">"** '"</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">"'. Please fix it (see above for "</span>
00813                  &lt;&lt; <span class="stringliteral">"specific"</span> &lt;&lt;endl&lt;&lt;<span class="stringliteral">"** error message)"</span>&lt;&lt; endl
00814                  &lt;&lt; <span class="stringliteral">"** The error occured at line: "</span>&lt;&lt; num &lt;&lt; endl
00815                  &lt;&lt; <span class="stringliteral">"*******************************************************"</span>
00816                  &lt;&lt; endl &lt;&lt; endl;           
00817             
00818             <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Configuration syntax error"</span>);
00819 
00820         }
00821         
00822     }
00823 
00824     conf.close();
00825     
00826 }
00827 
00828 
00832 <span class="keywordtype">void</span>
00833 Config::addRun() {
00834 
00835     _runqueue.push_back(_curinfo);
00836 
00837     
00838 }
00839 
00840 
00841 
00845 <span class="keywordtype">void</span>
<a name="l00846"></a><a class="code" href="classConfig.html#a2">00846</a> <a class="code" href="classConfig.html#a2">Config::writeSample</a>( <span class="keywordtype">char</span> *filename) {
00847 
00848     ofstream outfile(filename);
00849     
00850     <span class="keywordflow">if</span> (!outfile) {
00851         
00852         cout &lt;&lt; <span class="stringliteral">"** Couldn't write default configuration file '"</span>
00853              &lt;&lt; filename &lt;&lt;<span class="stringliteral">"' to the current directory."</span> &lt;&lt; endl;
00854         <span class="keywordflow">return</span>;
00855 
00856     }
00857     
00858     
00859     outfile &lt;&lt; <span class="stringliteral">"##"</span>&lt;&lt;endl
00860             &lt;&lt; <span class="stringliteral">"## Whipple Analysis Configuration File"</span> &lt;&lt; endl
00861             &lt;&lt; <span class="stringliteral">"## -------------------------------------------------"</span> &lt;&lt; endl
00862             &lt;&lt; <span class="stringliteral">"##     Edit this file, adding the correct information"</span> &lt;&lt; endl
00863             &lt;&lt; <span class="stringliteral">"##     for the runs to be analyzed. Default values will be"</span>
00864             &lt;&lt; endl
00865             &lt;&lt; <span class="stringliteral">"##     used if parameters are left unspecified. "</span> &lt;&lt; endl
00866             &lt;&lt; <span class="stringliteral">"##"</span> &lt;&lt; endl 
00867             &lt;&lt; <span class="stringliteral">"##     Parameters are specified by 'key=value' pairs, each on "</span>
00868             &lt;&lt;endl
00869             &lt;&lt; <span class="stringliteral">"##     a separate lines. "</span> &lt;&lt; endl 
00870             &lt;&lt; <span class="stringliteral">"##"</span> &lt;&lt;endl
00871             &lt;&lt; <span class="stringliteral">"##     Everything after a '#' is treated as a comment."</span> &lt;&lt; endl
00872             &lt;&lt; <span class="stringliteral">"##"</span> &lt;&lt;endl
00873             &lt;&lt; <span class="stringliteral">"##     You can include other configuration files by using the "</span>
00874             &lt;&lt;endl
00875             &lt;&lt; <span class="stringliteral">"##        include=filename.conf"</span> &lt;&lt; endl
00876             &lt;&lt; <span class="stringliteral">"##     command. This is useful for storing options common to"</span>
00877             &lt;&lt; endl
00878             &lt;&lt; <span class="stringliteral">"##     a set of configurations."</span> &lt;&lt; endl
00879             &lt;&lt; <span class="stringliteral">"##"</span> &lt;&lt; endl 
00880             &lt;&lt; endl
00881             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00882             &lt;&lt; <span class="stringliteral">"## ENTER THE DIRECTORY WHERE THE RAW DATA FILES ARE STORED:"</span>
00883             &lt;&lt;endl
00884             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00885             &lt;&lt; <span class="stringliteral">"#DataDir = /data/Whipple/raw10/"</span>&lt;&lt;endl
00886             &lt;&lt; endl
00887             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00888             &lt;&lt; <span class="stringliteral">"## ENTER THE DIRECTORY FOR THE PEDESTAL/GAINS CACHES:"</span> &lt;&lt; endl
00889             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00890             &lt;&lt; <span class="stringliteral">"#CacheDir = /data/Analysis/CACHE/"</span>&lt;&lt;endl
00891             &lt;&lt; endl
00892             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00893             &lt;&lt; <span class="stringliteral">"## ENTER THE ARRAY DEFINITION (without the .array extension):"</span> 
00894             &lt;&lt; endl
00895             &lt;&lt; <span class="stringliteral">"## These can be found in the wuparam support directory"</span>&lt;&lt;endl
00896             &lt;&lt; <span class="stringliteral">"## the default is 'whipple-1' if none is specified"</span>&lt;&lt;endl
00897             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00898             &lt;&lt; <span class="stringliteral">"#ArrayConfig = whipple-1"</span>&lt;&lt;endl
00899             &lt;&lt; <span class="stringliteral">"#ArrayConfig = veritas-4"</span>&lt;&lt;endl
00900             &lt;&lt; endl
00901             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00902             &lt;&lt; <span class="stringliteral">"## SELECT THE OUTPUT DATA TYPE FOR PARAMETERIZED FILES"</span> &lt;&lt; endl
00903             &lt;&lt; <span class="stringliteral">"## (the options are: ntuple, text)"</span>&lt;&lt; endl
00904             &lt;&lt; <span class="stringliteral">"## In general, leave this at 'ntuple', you can always "</span>&lt;&lt;endl
00905             &lt;&lt; <span class="stringliteral">"## convert .ntuple files to text with the 'wu2txt' command"</span>
00906             &lt;&lt; endl
00907             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00908             &lt;&lt; <span class="stringliteral">"OutputType = ntuple"</span> &lt;&lt; endl 
00909             &lt;&lt; endl
00910             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00911             &lt;&lt; <span class="stringliteral">"## Specify the MonteCarlo database and energy estimator"</span>&lt;&lt;endl 
00912             &lt;&lt; <span class="stringliteral">"## for spectral fits"</span>&lt;&lt;endl
00913             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00914             &lt;&lt; <span class="stringliteral">"MonteCarloDatabase = /data/Whipple/Simulations/mall.dat"</span>&lt;&lt;endl
00915             &lt;&lt; <span class="stringliteral">"EnergyEstimator = SZA"</span>&lt;&lt;endl
00916             &lt;&lt; <span class="stringliteral">"EnergyRangeTeV = 0.01,128"</span>&lt;&lt;endl
00917             &lt;&lt; <span class="stringliteral">"EnergyBins = 27"</span> &lt;&lt; endl
00918             &lt;&lt; endl
00919             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00920             &lt;&lt; <span class="stringliteral">"## Parameterization options:"</span> &lt;&lt;endl
00921             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00922             &lt;&lt; <span class="stringliteral">"Padding = true        # enable noise padding "</span> &lt;&lt;endl
00923             &lt;&lt; <span class="stringliteral">"PadLevel = 5.0        # noise level if there is no OFF run"</span>
00924             &lt;&lt; endl
00925             &lt;&lt; <span class="stringliteral">"Derotation = true     # correct for camera rotation "</span> &lt;&lt;endl
00926             &lt;&lt; <span class="stringliteral">"MuonCalibration=false # do muon ring calibration (slow)"</span>&lt;&lt;endl
00927             &lt;&lt; <span class="stringliteral">"MaxPedestalEvents=1000000 # max number of ped events to use"</span>
00928             &lt;&lt; endl&lt;&lt;endl
00929             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00930             &lt;&lt; <span class="stringliteral">"## Cleaning thresholds: since these are tied to the"</span>&lt;&lt;endl
00931             &lt;&lt; <span class="stringliteral">"## particular set of cuts, they are usually specified"</span>&lt;&lt;endl
00932             &lt;&lt; <span class="stringliteral">"## in the included cuts file, but you can override them"</span>&lt;&lt;endl
00933             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00934             &lt;&lt; <span class="stringliteral">"#PictureThresh = 5.0   # Image cleaning major threshold"</span>&lt;&lt;endl
00935             &lt;&lt; <span class="stringliteral">"#BoundaryThresh = 2.5  # Image cleaning minor threshold"</span>&lt;&lt;endl
00936             &lt;&lt; endl&lt;&lt;endl
00937             &lt;&lt; <span class="stringliteral">"## Parameters for hexagonal FFT filtering, if enabled"</span>&lt;&lt;endl
00938             &lt;&lt; <span class="stringliteral">"ImageFilter=false      # Hexagonal FFT filtering "</span>&lt;&lt;endl
00939             &lt;&lt; <span class="stringliteral">"FilterThresh=1.5       # Cleaning threshold in sigma"</span>&lt;&lt;endl
00940             &lt;&lt; <span class="stringliteral">"#FilterSubdivide=2     # camera pixel subdivision"</span>&lt;&lt;endl
00941             &lt;&lt; <span class="stringliteral">"#FilterAmount=0.3      # filter strength (0-1)"</span>&lt;&lt;endl
00942             &lt;&lt; <span class="stringliteral">"#FilterIter=2          # iterations for derivative calc"</span>&lt;&lt;endl
00943             &lt;&lt; <span class="stringliteral">"#FilterSmoothness=0.0  # smoothness of cutoff "</span> &lt;&lt;endl
00944             &lt;&lt; <span class="stringliteral">"#FilterPercent=0.2     # smoothness of cutoff "</span> &lt;&lt;endl
00945             &lt;&lt; endl;
00946     outfile &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00947             &lt;&lt; <span class="stringliteral">"## Camera offset: affects the parameterization of "</span>&lt;&lt;endl
00948             &lt;&lt; <span class="stringliteral">"## datafiles. If enabled and set to a position other"</span>&lt;&lt;endl
00949             &lt;&lt; <span class="stringliteral">"## than (0,0), the center of the camera is shifted to"</span>&lt;&lt;endl
00950             &lt;&lt; <span class="stringliteral">"## the specified coordinate before the parmeters are"</span>&lt;&lt;endl
00951             &lt;&lt; <span class="stringliteral">"## calculated.  Useful for systematic pointing offsets."</span>&lt;&lt;endl
00952             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00953         
00954             &lt;&lt; <span class="stringliteral">"CameraOffset = false"</span>&lt;&lt; endl
00955             &lt;&lt; <span class="stringliteral">"XCameraOffset = 0.0     # x parameterization offset"</span>&lt;&lt;endl
00956             &lt;&lt; <span class="stringliteral">"YCameraOffset = 0.0     # y parameterization offset"</span>&lt;&lt;endl
00957             &lt;&lt;endl&lt;&lt;endl
00958             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00959             &lt;&lt; <span class="stringliteral">"## Radial analysis: disables the 'alpha-cut' and instead"</span>&lt;&lt;endl
00960             &lt;&lt; <span class="stringliteral">"## cuts events with points of origin which  don't fall "</span>&lt;&lt;endl
00961             &lt;&lt; <span class="stringliteral">"## within the SmoothinRadius of the XOffset,YOffset "</span>&lt;&lt;endl
00962             &lt;&lt; <span class="stringliteral">"## position.  Useful for analysis"</span>&lt;&lt;endl
00963             &lt;&lt; <span class="stringliteral">"## of runs where you aren't interested in the center."</span>&lt;&lt;endl
00964             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00965             &lt;&lt; <span class="stringliteral">"RadialAnalysis =false # use offset (radial cut) analysis"</span>&lt;&lt;endl
00966             &lt;&lt; <span class="stringliteral">"XRadialOffset=0.0     # X offset for 'OffsetAnalysis' in deg"</span>
00967             &lt;&lt;endl
00968             &lt;&lt; <span class="stringliteral">"YRadialOffset=0.0     # X offset for 'OffsetAnalysis' in deg"</span>
00969             &lt;&lt;endl&lt;&lt;endl
00970             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00971             &lt;&lt; <span class="stringliteral">"## Alignment allows you to combine multiple runs that "</span>&lt;&lt;endl
00972             &lt;&lt; <span class="stringliteral">"## have differing pointing errors.  You can redefine "</span>&lt;&lt;endl
00973             &lt;&lt; <span class="stringliteral">"## XAlign and YAlign on a per-run basis. Positive "</span>&lt;&lt;endl
00974             &lt;&lt; <span class="stringliteral">"## offsets move the run upward or to the right."</span>&lt;&lt;endl
00975             &lt;&lt; <span class="stringliteral">"## If you cut a set of runs without  the -P option, "</span>&lt;&lt;endl
00976             &lt;&lt; <span class="stringliteral">"## a set of automatically generated pointing offsets are"</span>&lt;&lt;endl
00977             &lt;&lt; <span class="stringliteral">"## generated for each run which can be loaded using"</span>&lt;&lt;endl
00978             &lt;&lt; <span class="stringliteral">"## the 'AlignmentFile' keyword."</span>&lt;&lt;endl
00979             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00980             &lt;&lt;endl
00981             &lt;&lt; <span class="stringliteral">"Alignment = false     # enable 2-D alignment of runs"</span>&lt;&lt;endl
00982             &lt;&lt; <span class="stringliteral">"XAlign = 0.0          # xalignment offset "</span>&lt;&lt;endl
00983             &lt;&lt; <span class="stringliteral">"YAlign = 0.0 "</span> &lt;&lt; endl  
00984             &lt;&lt; <span class="stringliteral">"#AlignmentFile=Totals/alignment_to_gt0123456.align"</span>&lt;&lt;endl
00985             &lt;&lt; endl;
00986 
00987     outfile &lt;&lt; <span class="stringliteral">"## -----------------------------------------------------"</span>&lt;&lt;endl
00988             &lt;&lt; <span class="stringliteral">"## Include external configuration.  Setting in include files"</span>
00989             &lt;&lt;endl
00990             &lt;&lt; <span class="stringliteral">"## will OVERRIDE any previously set settings!"</span>&lt;&lt;endl
00991             &lt;&lt; <span class="stringliteral">"## WUParam looks for include files in the current"</span>&lt;&lt;endl
00992             &lt;&lt; <span class="stringliteral">"## directory and $WUPARAMDIR (usually /usr/share/wuparam)"</span>
00993             &lt;&lt;endl
00994             &lt;&lt; <span class="stringliteral">"## -----------------------------------------------------"</span>&lt;&lt;endl
00995             &lt;&lt; <span class="stringliteral">"Include = SuperCuts2000.conf"</span> &lt;&lt; endl
00996             &lt;&lt; endl;
00997 
00998     outfile &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
00999             &lt;&lt; <span class="stringliteral">"## CUTS: override any cuts specified in the standard "</span>&lt;&lt;endl
01000             &lt;&lt; <span class="stringliteral">"## include files if you need to. "</span>&lt;&lt;endl
01001             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
01002             &lt;&lt;endl
01003             &lt;&lt; <span class="stringliteral">"# UseCutType = supercuts  #supercuts,zcuts,ezcuts,spectralcuts"</span>
01004             &lt;&lt;endl
01005             &lt;&lt; <span class="stringliteral">"# TrackingRatio = 3.1"</span>&lt;&lt;endl
01006             &lt;&lt; <span class="stringliteral">"# SmoothingRadius = 0.25 # in deg (0.25 default)"</span>&lt;&lt; endl
01007             &lt;&lt; <span class="stringliteral">"# CutAlpha = 0, 15.0"</span>&lt;&lt;endl
01008             &lt;&lt; <span class="stringliteral">"# CutWidth = 0.05, 0.12"</span>&lt;&lt;endl
01009             &lt;&lt; <span class="stringliteral">"# CutLength = 0.13, 0.25"</span>&lt;&lt;endl
01010             &lt;&lt; <span class="stringliteral">"# CutDistance = 0.4, 1.0"</span>&lt;&lt;endl
01011             &lt;&lt; <span class="stringliteral">"# CutSize = 0, 1e10"</span>&lt;&lt;endl
01012             &lt;&lt; <span class="stringliteral">"# CutLenSize = 0, 0.0004"</span>&lt;&lt;endl
01013             &lt;&lt; <span class="stringliteral">"# CutMax1 = 50, 1e10"</span>&lt;&lt;endl
01014             &lt;&lt; <span class="stringliteral">"# CutMax2 = 40, 1e10"</span>&lt;&lt;endl
01015             &lt;&lt; <span class="stringliteral">"# CutMax3 = 0, 1e10"</span>&lt;&lt;endl
01016             &lt;&lt; <span class="stringliteral">"# CutFrac3 = 0,1e10"</span>&lt;&lt;endl
01017             &lt;&lt; <span class="stringliteral">"# CutAsymmDist = 0,1e10"</span>&lt;&lt;endl
01018             &lt;&lt; <span class="stringliteral">"# SpectralCutDeltaLength = 0.1 "</span>&lt;&lt;endl
01019             &lt;&lt; <span class="stringliteral">"# SpectralCutDeltaWidth  = 0.1 "</span>&lt;&lt;endl
01020             &lt;&lt; endl
01021             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
01022             &lt;&lt; <span class="stringliteral">"## SET OVERRIDE VALUES FOR PARAMETERS IN THE RAW DATA FILES:"</span> 
01023             &lt;&lt;endl
01024             &lt;&lt; <span class="stringliteral">"## (optional - if blank, the values will come from the data)"</span>
01025             &lt;&lt;endl
01026             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
01027             &lt;&lt; <span class="stringliteral">"#OverrideRa=1.2345 #in radians"</span> &lt;&lt;endl
01028             &lt;&lt; <span class="stringliteral">"#OverrideDec=1.2345 #in radians"</span> &lt;&lt;endl
01029             &lt;&lt; <span class="stringliteral">"#OverrideSource=mrk421"</span> &lt;&lt;endl
01030             &lt;&lt; <span class="stringliteral">"#MaskTubes = 1 42 16  # set tubes to manually disable "</span>
01031             &lt;&lt; <span class="stringliteral">"(can re-enable with UnMaskTubes)"</span> &lt;&lt; endl
01032             &lt;&lt; endl
01033             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
01034             &lt;&lt; <span class="stringliteral">"## LIST RUN(S) TO PROCESS:  YOU CAN REDEFINE ANY OF THE ABOVE"</span>
01035             &lt;&lt;endl
01036             &lt;&lt; <span class="stringliteral">"## PARAMETERS BETWEEN RUNS, IF NEED BE"</span> &lt;&lt;endl
01037             &lt;&lt; <span class="stringliteral">"##     pr=on off n2 utdate   (on/off source pair) "</span> &lt;&lt;endl
01038             &lt;&lt; <span class="stringliteral">"##     tr=run n2 utdate      (tracking run) "</span> &lt;&lt;endl
01039             &lt;&lt; <span class="stringliteral">"##     tr=run pad n2 utdate  (tracking run padded with "</span>
01040             &lt;&lt;  <span class="stringliteral">"real run)"</span> &lt;&lt;endl
01041             &lt;&lt; <span class="stringliteral">"## ----------------------------------------------------"</span>&lt;&lt;endl
01042             &lt;&lt; <span class="stringliteral">"#pr=gt015233\tgt015234\tgt015230\t020509"</span> &lt;&lt;endl
01043             &lt;&lt; <span class="stringliteral">"#tr=gt015233\t\t\tgt015230\t020509"</span> &lt;&lt;endl
01044             &lt;&lt; <span class="stringliteral">"#tr=gt015233\tgt015234\tgt015230\t020509 "</span>&lt;&lt;endl
01045             &lt;&lt; endl;
01046                    
01047     
01048     outfile.close();
01049 
01050 
01051 }
01052 
01053 
01054 
01055 
01056 
01060 <span class="keywordtype">void</span>
01061 removeWhiteSpace( string &amp;str ) {
01062 
01063     <span class="comment">// first convert tabs to spaces:</span>
01064     
01065     string::iterator i;
01066 
01067     <span class="keywordflow">for</span>( i=str.begin(); i != str.end(); i++) {
01068         <span class="keywordflow">if</span> (*i == <span class="charliteral">'\t'</span>) *i = <span class="charliteral">' '</span>;
01069     }
01070 
01071     <span class="comment">// now chop off white space at beginning and end </span>
01072 
01073     string::size_type where = str.find_first_not_of(<span class="charliteral">' '</span>);
01074     
01075     <span class="keywordflow">if</span> (where != string::npos &amp;&amp; where != 0)            
01076         str = str.substr(where);
01077     
01078     where = str.find_last_not_of(<span class="charliteral">' '</span>);
01079   
01080     <span class="keywordflow">if</span> (where != string::npos &amp;&amp; where != (str.length() - 1))
01081         str = str.substr(0, where + 1);
01082 
01083     <span class="keywordflow">if</span> (str==<span class="stringliteral">" "</span>) str = <span class="stringliteral">""</span>;
01084 
01085     
01086 }
01087 
01088 
01089 string 
01090 getSupportDir() {
01091     
01092     string wuparamdir;
01093     <span class="keywordflow">if</span> (getenv(<span class="stringliteral">"WUPARAMDIR"</span>) != NULL) {
01094         wuparamdir = getenv(<span class="stringliteral">"WUPARAMDIR"</span>);
01095     }
01096     <span class="keywordflow">else</span> {
01097         wuparamdir = <span class="stringliteral">"/usr/share/wuparam/"</span>;
01098     }
01099 
01100     <span class="keywordflow">if</span> (wuparamdir[wuparamdir.size()-1] != <span class="charliteral">'/'</span>)
01101         wuparamdir += <span class="stringliteral">"/"</span>;
01102   
01103     <span class="keywordflow">return</span> wuparamdir;
01104 }
01105 
01106 
01107 
01108 
01112 <span class="keywordtype">void</span> tokenize(<span class="keyword">const</span> string&amp; str, vector&lt;string&gt;&amp; tokens,
01113               <span class="keyword">const</span> string&amp; delimiters)
01114 {
01115 
01116     tokens.clear();  <span class="comment">//reset token list</span>
01117 
01118     <span class="comment">// Skip delimiters at beginning.</span>
01119     string::size_type lastPos = str.find_first_not_of(delimiters, 0);
01120     <span class="comment">// Find first "non-delimiter".</span>
01121     string::size_type pos     = str.find_first_of(delimiters, lastPos);
01122 
01123     <span class="keywordflow">while</span> (string::npos != pos || string::npos != lastPos)
01124     {
01125         <span class="comment">// Found a token, add it to the vector.</span>
01126         tokens.push_back(str.substr(lastPos, pos - lastPos));
01127         <span class="comment">// Skip delimiters.  Note the "not_of"</span>
01128         lastPos = str.find_first_not_of(delimiters, pos);
01129         <span class="comment">// Find next "non-delimiter"</span>
01130         pos = str.find_first_of(delimiters, lastPos);
01131     }
01132 }
01133 
01134 
01135 ostream&amp; 
01136 operator&lt;&lt;(ostream &amp;stream,<span class="keyword">const</span> <a class="code" href="structCutInfo.html">CutInfo</a> &amp;c){
01137 
01138     stream 
01139         &lt;&lt; <span class="stringliteral">" ALPHA:  "</span> 
01140         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o2">alpha</a>.<a class="code" href="structCut.html#o0">lower</a> 
01141         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o2">alpha</a>.<a class="code" href="structCut.html#o1">upper</a> 
01142         &lt;&lt; endl
01143 
01144         &lt;&lt; <span class="stringliteral">"  DIST:  "</span> 
01145         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o3">distance</a>.<a class="code" href="structCut.html#o0">lower</a> 
01146         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o3">distance</a>.<a class="code" href="structCut.html#o1">upper</a> 
01147         &lt;&lt; endl
01148 
01149         &lt;&lt; <span class="stringliteral">"LENGTH:  "</span> 
01150         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o4">length</a>.<a class="code" href="structCut.html#o0">lower</a> 
01151         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o4">length</a>.<a class="code" href="structCut.html#o1">upper</a> 
01152         &lt;&lt; endl
01153 
01154         &lt;&lt; <span class="stringliteral">" WIDTH:  "</span> 
01155         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o5">width</a>.<a class="code" href="structCut.html#o0">lower</a> 
01156         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o5">width</a>.<a class="code" href="structCut.html#o1">upper</a> 
01157         &lt;&lt; endl
01158 
01159         &lt;&lt; <span class="stringliteral">"  SIZE:  "</span> 
01160         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o6">size</a>.<a class="code" href="structCut.html#o0">lower</a> 
01161         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o6">size</a>.<a class="code" href="structCut.html#o1">upper</a> 
01162         &lt;&lt; endl
01163 
01164         &lt;&lt; <span class="stringliteral">"L/SIZE:  "</span> 
01165         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o7">lensize</a>.<a class="code" href="structCut.html#o0">lower</a> 
01166         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o7">lensize</a>.<a class="code" href="structCut.html#o1">upper</a> 
01167         &lt;&lt; endl
01168 
01169         &lt;&lt; <span class="stringliteral">"  MAX1:  "</span> 
01170         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o8">max1</a>.<a class="code" href="structCut.html#o0">lower</a> 
01171         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o8">max1</a>.<a class="code" href="structCut.html#o1">upper</a> 
01172         &lt;&lt; endl
01173 
01174         &lt;&lt; <span class="stringliteral">"  MAX2:  "</span> 
01175         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o9">max2</a>.<a class="code" href="structCut.html#o0">lower</a> 
01176         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o9">max2</a>.<a class="code" href="structCut.html#o1">upper</a> 
01177         &lt;&lt; endl
01178 
01179         &lt;&lt; <span class="stringliteral">"  MAX3:  "</span> 
01180         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o10">max3</a>.<a class="code" href="structCut.html#o0">lower</a> 
01181         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o10">max3</a>.<a class="code" href="structCut.html#o1">upper</a> 
01182         &lt;&lt; endl
01183 
01184         &lt;&lt; <span class="stringliteral">" FRAC3:  "</span> 
01185         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o11">frac3</a>.<a class="code" href="structCut.html#o0">lower</a> 
01186         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o11">frac3</a>.<a class="code" href="structCut.html#o1">upper</a> 
01187         &lt;&lt; endl
01188 
01189         &lt;&lt; <span class="stringliteral">"ASYMDST: "</span> 
01190         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o12">asymmdist</a>.<a class="code" href="structCut.html#o0">lower</a> 
01191         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o12">asymmdist</a>.<a class="code" href="structCut.html#o1">upper</a> 
01192         &lt;&lt; endl
01193 
01194         &lt;&lt; <span class="stringliteral">"SPECTRALCUTS:  "</span> 
01195         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o13">dlength</a>
01196         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o14">dwidth</a>
01197         &lt;&lt; endl
01198         
01199         &lt;&lt; <span class="stringliteral">"SMOOTHING RADIUS:  "</span> 
01200         &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o15">smoothing_radius</a>
01201         &lt;&lt; endl
01202 
01203         &lt;&lt; <span class="stringliteral">"RADIAL ANALYSIS:  "</span> ;
01204     <span class="keywordflow">if</span> (c.<a class="code" href="structCutInfo.html#o16">radial_analysis</a>) {
01205         stream 
01206             &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o17">radial_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a> &lt;&lt; <span class="stringliteral">" "</span>
01207             &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o17">radial_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>
01208             &lt;&lt; endl;
01209     }
01210     <span class="keywordflow">else</span> stream &lt;&lt; <span class="stringliteral">"DISABLED"</span>&lt;&lt;endl;
01211 
01212     stream &lt;&lt; <span class="stringliteral">"ALIGNMENT:  "</span> ;
01213     <span class="keywordflow">if</span> (c.<a class="code" href="structCutInfo.html#o18">alignment</a>) {
01214         stream 
01215             &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o19">align_offset</a>.<a class="code" href="structCoordinate__t.html#o0">x</a> &lt;&lt; <span class="stringliteral">" "</span>
01216             &lt;&lt; setw(10) &lt;&lt; c.<a class="code" href="structCutInfo.html#o19">align_offset</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>
01217             &lt;&lt; endl;
01218     }
01219     <span class="keywordflow">else</span> stream &lt;&lt; <span class="stringliteral">"DISABLED"</span>&lt;&lt;endl;
01220     
01221 
01222     <span class="keywordflow">return</span> stream;
01223 
01224 }
01225 
01226 <span class="keywordtype">void</span> 
01227 Config::
01228 loadAlignmentMap( std::string file ) {
01229 
01230     ifstream infile( file.c_str() );
01231     string id;
01232     <span class="keywordtype">double</span> x,y;
01233 
01234     <span class="keywordflow">if</span> (infile.fail()) 
01235         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html">MildAnalysisException</a>(<span class="stringliteral">"Couldn't read alignment file: "</span>+file);
01236     
01237     <span class="keywordflow">while</span>(infile) {
01238         infile &gt;&gt; id &gt;&gt; x &gt;&gt; y;
01239         _alignmap[id].x = x;
01240         _alignmap[id].y = y;
01241 <span class="comment">//      cout &lt;&lt; "DEBUG: map["&lt;&lt;id&lt;&lt;"] = "</span>
01242 <span class="comment">//           &lt;&lt;_alignmap[id].x &lt;&lt;"," </span>
01243 <span class="comment">//           &lt;&lt;_alignmap[id].y &lt;&lt; endl;</span>
01244     }
01245 
01246 
01247 
01248 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:45 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
