<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: SpectralCutter.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>SpectralCutter.cpp</h1><div class="fragment"><pre>00001 
00002 
00003 <span class="preprocessor">#include &lt;iostream&gt;</span>
00004 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00005 <span class="preprocessor">#include "SpectralCutter.h"</span>
00006 
00007 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00008 
00009 
00010 <span class="preprocessor">#define DEBUG_SPECTRALCUTS 0</span>
00011 <span class="preprocessor"></span>
00012 <span class="keywordtype">bool</span> 
00013 SpectralCutter::
00014 passLength( <a class="code" href="structHillasParameterization.html">HillasParameterization</a> &amp;param ) {
00015 
00016    <span class="keywordtype">double</span> len = <a class="code" href="classSpectralCutter.html#a3">expectedLength</a>( param.<a class="code" href="structHillasParameterization.html#o5">size</a>, param.<a class="code" href="structHillasParameterization.html#o19">zenith</a> );
00017    <span class="keywordtype">double</span> lower = len - _cuts.<a class="code" href="structCutInfo.html#o13">dlength</a>;
00018    <span class="keywordtype">double</span> upper = len + _cuts.<a class="code" href="structCutInfo.html#o13">dlength</a>;
00019 
00020    <span class="keywordflow">if</span> (DEBUG_SPECTRALCUTS) {
00021        cout &lt;&lt; <span class="stringliteral">"DEBUG: SpectralCuts: length = "</span>&lt;&lt;param.<a class="code" href="structHillasParameterization.html#o3">length</a>
00022             &lt;&lt; <span class="stringliteral">" model="</span>&lt;&lt;len
00023             &lt;&lt; <span class="stringliteral">" low="</span>&lt;&lt;lower
00024             &lt;&lt; <span class="stringliteral">" up="</span>&lt;&lt;upper
00025             &lt;&lt; endl;
00026    }
00027 
00028    <span class="keywordflow">if</span> (lower &lt;= param.<a class="code" href="structHillasParameterization.html#o3">length</a> &amp;&amp; param.<a class="code" href="structHillasParameterization.html#o3">length</a> &lt;= upper ) {
00029        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00030    }
00031    <span class="keywordflow">else</span>{
00032        <span class="keywordflow">return</span> <span class="keyword">false</span>;
00033    }
00034 
00035 }
00036 
00037 
00038 <span class="keywordtype">bool</span>
00039 SpectralCutter:: 
00040 passWidth( <a class="code" href="structHillasParameterization.html">HillasParameterization</a> &amp;param ) {
00041 
00042    <span class="keywordtype">double</span> wid = <a class="code" href="classSpectralCutter.html#a5">expectedWidth</a>( param.<a class="code" href="structHillasParameterization.html#o5">size</a>, param.<a class="code" href="structHillasParameterization.html#o19">zenith</a> );
00043    <span class="keywordtype">double</span> lower = wid - _cuts.<a class="code" href="structCutInfo.html#o14">dwidth</a>;
00044    <span class="keywordtype">double</span> upper = wid + _cuts.<a class="code" href="structCutInfo.html#o14">dwidth</a>;
00045 
00046    <span class="keywordflow">if</span> (lower &lt;= param.<a class="code" href="structHillasParameterization.html#o4">width</a> &amp;&amp; param.<a class="code" href="structHillasParameterization.html#o4">width</a> &lt;= upper )
00047        <span class="keywordflow">return</span> <span class="keyword">true</span>;
00048    <span class="keywordflow">else</span>
00049        <span class="keywordflow">return</span> <span class="keyword">false</span>;
00050 
00051     
00052 }
00053 
00054 
00059 <span class="keywordtype">double</span>
00060 <a class="code" href="classSpectralCutter.html#a3">SpectralCutter::</a>
<a name="l00061"></a><a class="code" href="classSpectralCutter.html#a3">00061</a> <a class="code" href="classSpectralCutter.html#a3">expectedLength</a>( <span class="keywordtype">double</span> size, <span class="keywordtype">double</span> zenith ) {
00062     
00063     <span class="keyword">const</span> <span class="keywordtype">int</span> NZBINS = 7;
00064     <span class="keyword">const</span> <span class="keywordtype">int</span> NPARAMS = 4;
00065     
00066     <span class="comment">// ==================================================================</span>
00067     <span class="comment">// Set up the data from fits:</span>
00068     
00069     <span class="comment">// here are the simulated zenith angles: (note: these must be</span>
00070     <span class="comment">// consecutive integer bins, or you need to change the bracketing</span>
00071     <span class="comment">// calculation below!)</span>
00072     
00073     <span class="keyword">const</span> <span class="keywordtype">double</span> zbin[NZBINS] = {0.0, 10.0, 20.0, 30.0, 40.0, 50.0, 60.0};
00074     
00075     <span class="comment">// here are the fit parameters that should be passed to modelLength</span>
00076     
00077     <span class="keyword">const</span> <span class="keywordtype">double</span> fitparam[NZBINS][NPARAMS] = {
00078         <span class="comment">//  A         B          C           D</span>
00079         {-1.90459,0.784166,-0.0979834,0.00413616},     <span class="comment">//  0</span>
00080         {-1.49174,0.626015,-0.078051,0.00330978},      <span class="comment">// 10</span>
00081         {-1.36292,0.571065,-0.0703576,0.00294821},     <span class="comment">// 20</span>
00082         {-1.64037,0.638111,-0.0733976,0.00283247},     <span class="comment">// 30</span>
00083         {-1.4705,0.612931,-0.0767032,0.00328061},      <span class="comment">// 40</span>
00084         {-1.15645,0.47459,-0.0573313,0.00238501},      <span class="comment">// 50</span>
00085         {-0.809668,0.404381,-0.0598228,0.00309438 }    <span class="comment">// 60</span>
00086     };
00087     
00088     
00089     <span class="comment">// ==================================================================</span>
00090     <span class="comment">// First, check bounds and figure out which two zenith angle bins</span>
00091     <span class="comment">// bracket the given zenith angle:</span>
00092     
00093     <span class="comment">//     if (zenith &gt;  80*M_PI/180.0) {</span>
00094     <span class="comment">//      throw out_of_range("given zenith angle out of interpolation range");</span>
00095     <span class="comment">//     }</span>
00096     
00097     <span class="keywordflow">if</span> (size &lt;= 1e-50) {
00098         <span class="keywordflow">throw</span> out_of_range(<span class="stringliteral">"given size is &lt; 0"</span>);
00099     }
00100     
00101     
00102     <span class="comment">// HACK: the zenith angle bins are integers right now, so the</span>
00103     <span class="comment">// fastest way to get the bracketing is to truncate (won't work</span>
00104     <span class="comment">// for non-integer bins though!)</span>
00105     
00106     <span class="keywordtype">int</span> lowbin = static_cast&lt;int&gt;(floor(zenith/10.0*180/M_PI));
00107     <span class="keywordtype">int</span> highbin = lowbin+1;
00108     
00109     <span class="keywordflow">if</span> (highbin &gt;= NZBINS ) {
00110         <span class="comment">// just do linear extrapolation if out of range...</span>
00111         highbin = NZBINS-1;
00112         lowbin = NZBINS-2;
00113     }
00114     
00115     <span class="comment">// ==================================================================</span>
00116     <span class="comment">// now, evaluate modelLength(SIZE) using the bracketing zenith</span>
00117     <span class="comment">// angles and do a linear interpolation between them to get the</span>
00118     <span class="comment">// actual value for the given zenith angle:</span>
00119     
00120     <span class="keywordtype">double</span> lnsize = log(size);
00121     <span class="keywordtype">double</span> l0 = <a class="code" href="classSpectralCutter.html#a4">modelLength</a>( lnsize, fitparam[lowbin] );
00122     <span class="keywordtype">double</span> l1 = <a class="code" href="classSpectralCutter.html#a4">modelLength</a>( lnsize, fitparam[highbin] );
00123     <span class="keywordtype">double</span> z0 = zbin[lowbin] *M_PI/180.0;
00124     <span class="keywordtype">double</span> z1 = zbin[highbin]*M_PI/180.0;
00125     
00126     <span class="keywordtype">double</span> slope = (l1-l0)/(z1-z0);
00127     <span class="keywordtype">double</span> l = slope*(zenith-z0) + l0;
00128     
00129     <span class="keywordflow">return</span> l;
00130 
00131 }
00132 
00133 
00134 
00139 <span class="keywordtype">double</span>
00140 <a class="code" href="classSpectralCutter.html#a5">SpectralCutter::</a>
<a name="l00141"></a><a class="code" href="classSpectralCutter.html#a5">00141</a> <a class="code" href="classSpectralCutter.html#a5">expectedWidth</a>( <span class="keywordtype">double</span> size, <span class="keywordtype">double</span> zenith ) {
00142     
00143     <span class="keyword">const</span> <span class="keywordtype">int</span> NZBINS = 7;
00144     <span class="keyword">const</span> <span class="keywordtype">int</span> NPARAMS = 4;
00145     
00146     <span class="comment">// ==================================================================</span>
00147     <span class="comment">// Set up the data from fits:</span>
00148     
00149     <span class="comment">// here are the simulated zenith angles: (note: these must be</span>
00150     <span class="comment">// consecutive integer bins, or you need to change the bracketing</span>
00151     <span class="comment">// calculation below!)</span>
00152     
00153     <span class="keyword">const</span> <span class="keywordtype">double</span> zbin[NZBINS] = {0.0, 10.0, 20.0, 30.0, 40.0, 50.0, 60.0};
00154     
00155     <span class="comment">// here are the fit parameters that should be passed to modelWidth</span>
00156     
00157     <span class="keyword">const</span> <span class="keywordtype">double</span> fitparam[NZBINS][NPARAMS] = {
00158         <span class="comment">//  A         B          C           D</span>
00159         {-0.407304,0.178678,-0.0231434,0.00113588},    <span class="comment">//  0</span>
00160         {-0.0869331,0.0363275,-0.0023061,0.000130217}, <span class="comment">// 10</span>
00161         {-0.485086,0.20325,-0.025185,0.00114646} ,     <span class="comment">// 20</span>
00162         {-0.274123,0.115825,-0.0133312,0.000616812},   <span class="comment">// 30</span>
00163         {-0.570203,0.243562,-0.0311984,0.0014157},     <span class="comment">// 40</span>
00164         {-0.189972,0.0792605,-0.00755413,0.000276128}, <span class="comment">// 50</span>
00165         {-0.408642,0.193252,-0.0265448,0.00128923 }    <span class="comment">// 60</span>
00166     };
00167     
00168     
00169     <span class="comment">// ==================================================================</span>
00170     <span class="comment">// First, check bounds and figure out which two zenith angle bins</span>
00171     <span class="comment">// bracket the given zenith angle:</span>
00172     
00173     <span class="comment">//     if (zenith &gt;  80*M_PI/180.0) {</span>
00174     <span class="comment">//      throw out_of_range("given zenith angle out of interpolation range");</span>
00175     <span class="comment">//     }</span>
00176     
00177     <span class="keywordflow">if</span> (size &lt;= 1e-50) {
00178         <span class="keywordflow">throw</span> out_of_range(<span class="stringliteral">"given size is &lt; 0"</span>);
00179     }
00180     
00181     
00182     <span class="comment">// HACK: the zenith angle bins are integers right now, so the</span>
00183     <span class="comment">// fastest way to get the bracketing is to truncate (won't work</span>
00184     <span class="comment">// for non-integer bins though!)</span>
00185     
00186     <span class="keywordtype">int</span> lowbin = static_cast&lt;int&gt;(floor(zenith/10.0*180/M_PI));
00187     <span class="keywordtype">int</span> highbin = lowbin+1;
00188     
00189     <span class="keywordflow">if</span> (highbin &gt;= NZBINS ) {
00190         <span class="comment">// just do linear extrapolation if out of range...</span>
00191         highbin = NZBINS-1;
00192         lowbin = NZBINS-2;
00193     }
00194     
00195     <span class="comment">// ==================================================================</span>
00196     <span class="comment">// now, evaluate modelLength(SIZE) using the bracketing zenith</span>
00197     <span class="comment">// angles and do a linear interpolation between them to get the</span>
00198     <span class="comment">// actual value for the given zenith angle:</span>
00199     
00200     <span class="keywordtype">double</span> lnsize = log(size);
00201     <span class="keywordtype">double</span> l0 = <a class="code" href="classSpectralCutter.html#a6">modelWidth</a>( lnsize, fitparam[lowbin] );
00202     <span class="keywordtype">double</span> l1 = <a class="code" href="classSpectralCutter.html#a6">modelWidth</a>( lnsize, fitparam[highbin] );
00203     <span class="keywordtype">double</span> z0 = zbin[lowbin] *M_PI/180.0;
00204     <span class="keywordtype">double</span> z1 = zbin[highbin]*M_PI/180.0;
00205     
00206     <span class="keywordtype">double</span> slope = (l1-l0)/(z1-z0);
00207     <span class="keywordtype">double</span> l = slope*(zenith-z0) + l0;
00208     
00209     <span class="keywordflow">return</span> l;
00210 
00211 }
00212 
00213 
00218 <span class="keywordtype">double</span>
00219 <a class="code" href="classSpectralCutter.html#a4">SpectralCutter::</a>
<a name="l00220"></a><a class="code" href="classSpectralCutter.html#a4">00220</a> <a class="code" href="classSpectralCutter.html#a4">modelLength</a>( <span class="keywordtype">double</span> lnsize, <span class="keyword">const</span> <span class="keywordtype">double</span> *fitparam ) {
00221     
00222     <span class="keywordflow">return</span> (fitparam[A] + fitparam[B]*lnsize +
00223             fitparam[C]*pow(lnsize,2) + fitparam[D]*pow(lnsize,3));
00224     
00225 }
00226 
00231 <span class="keywordtype">double</span>
00232 <a class="code" href="classSpectralCutter.html#a6">SpectralCutter::</a>
<a name="l00233"></a><a class="code" href="classSpectralCutter.html#a6">00233</a> <a class="code" href="classSpectralCutter.html#a6">modelWidth</a>( <span class="keywordtype">double</span> lnsize, <span class="keyword">const</span> <span class="keywordtype">double</span> *fitparam ) {
00234     
00235     <span class="keywordflow">return</span> (fitparam[A] + fitparam[B]*lnsize +
00236             fitparam[C]*pow(lnsize,2) + fitparam[D]*pow(lnsize,3));
00237     
00238 }
00239 
00240 
00241 
00242 
00243 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:46 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
