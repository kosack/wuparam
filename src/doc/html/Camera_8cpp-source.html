<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: Camera.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Camera.cpp</h1><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">// Camera.cpp</span>
00003 <span class="comment">// Karl Kosack &lt;kosack@hbar.wustl.edu&gt;</span>
00004 <span class="comment">//</span>
00005 
00006 <span class="preprocessor">#include &lt;iostream&gt;</span>
00007 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00008 <span class="preprocessor">#include &lt;cmath&gt;</span>
00009 <span class="preprocessor">#include &lt;fstream&gt;</span>
00010 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00011 <span class="preprocessor">#include &lt;plot.h&gt;</span>
00012 <span class="preprocessor">#include &lt;string&gt;</span>
00013 
00014 <span class="preprocessor">#include "Exceptions.h"</span>
00015 <span class="preprocessor">#include "ImageAnalyzer.h"</span>
00016 <span class="preprocessor">#include "MuonImageAnalyzer.h"</span>
00017 <span class="preprocessor">#include "Camera.h"</span>
00018 <span class="preprocessor">#include "PedestalFinder.h"</span>
00019 <span class="preprocessor">#include "Log.h"</span>
00020 <span class="preprocessor">#include "Config.h"</span>
00021 
00022 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00023 
<a name="l00028"></a><a class="code" href="classCamera.html#a1">00028</a> <a class="code" href="classCamera.html#a0">Camera::Camera</a>(<span class="keywordtype">char</span> *filename) 
00029 {
00030     
00031     init(filename);
00032     
00033 }
00034 
00035 
<a name="l00036"></a><a class="code" href="classCamera.html#a2">00036</a> <a class="code" href="classCamera.html#a0">Camera::Camera</a>( <span class="keywordtype">int</span> npixels, <span class="keywordtype">int</span> utdate ) {
00037 
00038 
00039     <span class="comment">// VERITAS CAMERA:</span>
00040     <span class="keywordflow">if</span> ( 499 &lt;= npixels &amp;&amp; npixels &lt;= 501 ) {
00041         
00042         init( <span class="stringliteral">"veritas_499.camera"</span> );
00043         _camera_id = ID_V500;
00044         _lastpix = 499;
00045         _firstpix = 0;
00046         _pe2dc = 1.0;  <span class="comment">// This need to be updated</span>
00047 
00048         cout &lt;&lt; <span class="stringliteral">"DEBUG: Camera: this is a VERITAS camera"</span>&lt;&lt;endl;
00049         
00050     }
00051     
00052     <span class="comment">// Whipple cameras:</span>
00053     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( 450 &lt; npixels &amp;&amp; npixels &lt; 498 ) {
00054         init( <span class="stringliteral">"490.camera"</span> );
00055         _camera_id = ID_490;
00056         _lastpix = 379;  <span class="comment">// turn off outer tubes!</span>
00057 
00058 
00067         <span class="keywordtype">int</span> year_month = (<span class="keywordtype">int</span>)(utdate/100);
00068         
00069         <span class="keywordflow">if</span>(year_month &gt;= 109 &amp;&amp; year_month &lt;=206){
00070           _pe2dc = 0.4467;
00071         }
00072         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(year_month &gt;= 209 &amp;&amp; year_month &lt;=306){
00073             <span class="comment">//_pe2dc = 0.5095*0.6251;</span>
00074             _pe2dc = 0.5095;
00075         }
00076         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(year_month &gt;= 309 &amp;&amp; year_month &lt;=406){
00077           _pe2dc = 0.5352;
00078         }
00079         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(year_month &gt;= 409 &amp;&amp; year_month &lt;=506){
00080           _pe2dc = 0.4776;
00081         }
00082         <span class="keywordflow">else</span>{
00083           _pe2dc = 0.4489;
00084         }
00085 
00086         <span class="comment">/*</span>
00087 <span class="comment">        int year = (int)(utdate/10000);</span>
00088 <span class="comment"></span>
00089 <span class="comment">        switch (year) {</span>
00090 <span class="comment">        case 01:</span>
00091 <span class="comment">            _pe2dc = 0.4467;</span>
00092 <span class="comment">            break;</span>
00093 <span class="comment">        case 02:</span>
00094 <span class="comment">            _pe2dc = 0.5095;</span>
00095 <span class="comment">            break;</span>
00096 <span class="comment">        case 03:</span>
00097 <span class="comment">            _pe2dc = 0.5352;</span>
00098 <span class="comment">            break;</span>
00099 <span class="comment">        case 04:</span>
00100 <span class="comment">            _pe2dc = 0.4776;</span>
00101 <span class="comment">            break;</span>
00102 <span class="comment">        default:</span>
00103 <span class="comment">            _pe2dc = 0.4489;</span>
00104 <span class="comment">            break;</span>
00105 <span class="comment">        }</span>
00106 <span class="comment">        */</span>
00107 
00108     }
00109     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( 300 &lt; npixels &amp;&amp; npixels &lt; 340 ) {
00110         init( <span class="stringliteral">"331.camera"</span> );
00111         _camera_id = ID_331;
00112         _pe2dc = 1.0;
00113         _lastpix = 330; 
00114     }
00115     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( 140 &lt; npixels &amp;&amp; npixels &lt; 160 ) {
00116         init(<span class="stringliteral">"151.camera"</span>);
00117         _camera_id = ID_151;
00118         _pe2dc = 1.0;
00119         _lastpix = 150; 
00120     }
00121     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( 100 &lt; npixels &amp;&amp; npixels &lt; 139 ) {
00122         init(<span class="stringliteral">"109.camera"</span>);
00123         _camera_id = ID_109;
00124         _pe2dc = 1.0;
00125 <span class="comment">//      _pe2dc = 0.75; // KPK: hand optimized using max2 distribution</span>
00126         _lastpix = 108; 
00127     }
00128     <span class="keywordflow">else</span> {
00129         _camera_id = ID_UNKNOWN;
00130         _pe2dc = 1.0;
00131         cout &lt;&lt; <span class="stringliteral">"DEBUG: Camera: npixels = "</span>&lt;&lt;npixels&lt;&lt;endl;
00132         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"No camera definition exists with specified number of pixels!"</span>);
00133     }
00134 
00135 }
00136 
00137 
<a name="l00141"></a><a class="code" href="classCamera.html#a0">00141</a> <a class="code" href="classCamera.html#a0">Camera::Camera</a>( <span class="keywordtype">int</span> npixels, Array_t &amp;xcoords, Array_t &amp;ycoords ) {
00142     _camera_id = ID_UNKNOWN;
00143     _npix = npixels;
00144     _firstpix = 0;
00145     _lastpix = npixels-1;
00146     _x.resize(npixels);
00147     _y.resize(npixels);
00148     _rad.resize(npixels);
00149     <span class="keywordflow">if</span> (xcoords.size() &lt; npixels || ycoords.size()&lt;npixels) {
00150         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Camera: npixels larger than array size"</span>);
00151     }
00152 
00153     _maxx=-10000.0;
00154     _minx=10000.0;
00155     _maxy=-100000.0;
00156     _miny=10000.0;
00157 
00158     <span class="keywordtype">double</span> drad = sqrt(pow(xcoords[2]-xcoords[1],2)
00159                        + pow(ycoords[2]-ycoords[1],2))/2.0;
00160 
00161     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;npixels; i++) {
00162         _x[i] = xcoords[i];
00163         _y[i] = ycoords[i];
00164         _rad[i] = drad;
00165         <span class="keywordflow">if</span> (_x[i]&gt;_maxx) _maxx= _x[i];
00166         <span class="keywordflow">if</span> (_y[i]&gt;_maxy) _maxy= _y[i];
00167         <span class="keywordflow">if</span> (_x[i]&lt;_minx) _minx= _x[i];
00168         <span class="keywordflow">if</span> (_y[i]&lt;_miny) _miny= _y[i];
00169     }
00170 
00171     cout &lt;&lt; <span class="stringliteral">"DEBUG: rad.size = "</span>&lt;&lt;_rad.size()&lt;&lt;<span class="stringliteral">", npix="</span>&lt;&lt;npixels&lt;&lt;endl;
00172     cout &lt;&lt; <span class="stringliteral">"DEBUG: camera extent=("</span>&lt;&lt;_minx&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;_miny
00173          &lt;&lt;<span class="stringliteral">")-("</span>&lt;&lt;_maxx&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;_maxy&lt;&lt;<span class="stringliteral">")"</span>&lt;&lt;endl;
00174 
00175     _sigpix =  sqrt(pow(_x[1]-_x[0],2) + pow(_y[1]-_y[0],2))/8.0;
00176 }
00177 
00178 
00179 <span class="keywordtype">void</span>
00180 Camera::init( <span class="keywordtype">char</span> *filename ) {
00181 
00182     _camera_id = ID_UNKNOWN;
00183     _npix = 0;
00184     _firstpix = 0;
00185     _sigpix = 0;
00186     _pe2dc = 0;
00187     _maxx = 0;
00188     _maxy = 0; 
00189     _minx = 0; 
00190     _miny = 0;
00191         
00192     <span class="keywordtype">double</span> dia2;
00193         
00194     loadCamera(filename);
00195     dia2 = pow(_x[1]-_x[0],2) + pow(_y[1]-_y[0],2);
00196     _sigpix = sqrt(dia2/8.0);
00197     _lastpix = _npix;
00198 
00199 
00200 } 
00201 
00202 
00203 Camera::~Camera() {
00204    
00205 
00206 }
00207 
00208 
00215 <span class="keywordtype">void</span>
00216 Camera::loadCamera(<span class="keywordtype">char</span> *filename) {
00217 
00218     <span class="keywordtype">char</span> id[256];
00219     string header;
00220     <span class="keywordtype">float</span>  version;
00221     <span class="keywordtype">int</span> i;
00222     <span class="keywordtype">double</span> xx,yy,rr;
00223     <span class="keywordtype">int</span> nneigh,neighid;
00224 
00225     string sfile(filename);
00226     string sdir;
00227 
00228     sdir = getSupportDir();
00229 
00230     string sfilename(sdir+sfile);
00231     ifstream camerafile( sfilename.c_str(), ios::in );
00232 
00233 
00234     <span class="comment">// Check if opened correctly...</span>
00235     <span class="keywordflow">if</span> (camerafile.fail()) {
00236         cerr &lt;&lt; <span class="stringliteral">"** Couldn't open camera datafile '"</span> &lt;&lt;filename&lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt; endl;
00237         cerr &lt;&lt; <span class="stringliteral">"** Set the environment variable WUPARAMDIR to the directory"</span>
00238              &lt;&lt; endl
00239              &lt;&lt; <span class="stringliteral">"** where it is found (the default is /usr/share/wuparam/)"</span>
00240              &lt;&lt;endl;
00241         exit(1);
00242     }
00243 
00244     <span class="comment">// Read header and version number and see if they're OK</span>
00245     
00246     camerafile &gt;&gt; header &gt;&gt; version;
00247 
00248     <span class="keywordflow">if</span> (header != <span class="stringliteral">"WHIPPLE-CAMERA-DEFINITION"</span>) {
00249         cout &lt;&lt; <span class="stringliteral">"The camera file you specified, '"</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">"' "</span>
00250              &lt;&lt; <span class="stringliteral">"doesn't appear to be in the correct format!"</span>
00251              &lt;&lt; endl;
00252         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Bad Camera Definition File Format!"</span>);
00253     }
00254 
00255     <span class="keywordflow">if</span> (version &lt; 1.0) {
00256         cout &lt;&lt; <span class="stringliteral">"The version of the camera file '"</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">"' "</span>
00257              &lt;&lt; <span class="stringliteral">"is "</span> &lt;&lt; version &lt;&lt; <span class="stringliteral">".  Make sure it is in the right format!"</span>
00258              &lt;&lt; endl;
00259         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>( <span class="stringliteral">"Wrong Camera Definition version"</span> );
00260   
00261     }
00262     
00263 
00264     <span class="comment">// Read number of data points (should be 1st line)</span>
00265     <span class="comment">// and allocate memory:</span>
00266     
00267     camerafile &gt;&gt; _npix;
00268 
00269     <span class="comment">// resize arrays and neighborlist</span>
00270 
00271     _x.resize( _npix );
00272     _y.resize( _npix );
00273     _rad.resize( _npix );
00274     _neighborlist.resize( _npix );
00275 
00276     <span class="comment">// Read in the datafiles... </span>
00277 
00278     rr = 1.0; 
00279     i = 0;
00280     <span class="keywordflow">while</span> ( !camerafile.eof() &amp;&amp; i&lt;_npix ){
00281         
00282         camerafile &gt;&gt; id;
00283         
00284         
00285         <span class="keywordflow">if</span> (id[0] == <span class="charliteral">'R'</span>) {
00286             <span class="comment">// set radius</span>
00287             camerafile &gt;&gt; rr;
00288         }
00289         <span class="keywordflow">else</span> {
00290 
00291             <span class="keywordflow">if</span> (i&lt;_npix) {
00292 
00293                 camerafile &gt;&gt; xx &gt;&gt; yy &gt;&gt; nneigh;
00294 
00295                 <span class="comment">// store the values</span>
00296                 _x[i] = xx;
00297                 _y[i] = yy;
00298                 _rad[i] = rr;
00299 
00300                 <span class="comment">// add the indices to the neighborlist</span>
00301 
00302                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;nneigh; j++) {
00303                     camerafile &gt;&gt; neighid;
00304                     _neighborlist[i].push_back( neighid );
00305                 }
00306 
00307                 <span class="comment">// calculate camera viewport size</span>
00308                 <span class="keywordflow">if</span>(_maxx &lt; xx) _maxx = xx;
00309                 <span class="keywordflow">if</span>(_maxy &lt; yy) _maxy = yy;
00310                 <span class="keywordflow">if</span>(_minx &gt; xx) _minx = xx;
00311                 <span class="keywordflow">if</span>(_miny &gt; yy) _miny = yy;
00312     
00313                 i++;
00314 
00315             }
00316             <span class="keywordflow">else</span> {
00317                 cout &lt;&lt; <span class="stringliteral">"** Camera: Pixel # "</span>&lt;&lt; i&lt;&lt; <span class="stringliteral">" out of range: "</span> 
00318                      &lt;&lt; <span class="stringliteral">" ID = '"</span> &lt;&lt; id &lt;&lt; <span class="stringliteral">"'   (SKIPPED)"</span> &lt;&lt; endl;
00319                 <span class="keywordflow">continue</span>;
00320             }
00321         }
00322     }
00323 
00324     _minx = _minx - 2*rr;
00325     _miny = _miny - 2*rr; 
00326     _maxx = _maxx + 2*rr;
00327     _maxy = _maxy + 2*rr; 
00328 
00329     camerafile.close();
00330     
00331     cout &lt;&lt; <span class="stringliteral">"Camera: loaded configuration from '"</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt;endl;
00332 
00333 }
00334 
00335 
00340 list&lt;int&gt;* 
<a name="l00341"></a><a class="code" href="classCamera.html#a20">00341</a> <a class="code" href="classCamera.html#a20">Camera::getNeighborListOfPixel</a>(<span class="keywordtype">int</span> n) {
00342 
00343     <span class="keywordflow">return</span> &amp;(_neighborlist[n]);
00344 
00345 }
00346 
00347 
00352 <span class="keywordtype">double</span>
<a name="l00353"></a><a class="code" href="classCamera.html#a6">00353</a> <a class="code" href="classCamera.html#a6">Camera::getSigmaPSF</a>( <span class="keywordtype">double</span> zen ) {
00354 
00355     <span class="comment">//return ((((0.12 - 0.18)/(TWOPI/4.0 - 0.401425728))</span>
00356     <span class="comment">//       *(zen - 0.401425728) + 0.18)/2.354);</span>
00357 
00358     <span class="comment">// KPK: changed 0.12 -&gt; 0.1</span>
00359 <span class="comment">//     return ((((0.13 - 0.13)/(M_PI_2 - 0.401425728))</span>
00360 <span class="comment">//               *(zen - 0.401425728) + 0.13)/2.354);</span>
00361 
00362     <span class="keywordflow">return</span> 0.13/2.354;
00363 
00364 
00365 }
00366 
00367 
00368 
00374 <span class="keywordtype">void</span>
00375 <a class="code" href="classCamera.html#a5">Camera::</a>
<a name="l00376"></a><a class="code" href="classCamera.html#a5">00376</a> <a class="code" href="classCamera.html#a5">shiftCameraCoordinates</a>( <span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy ) {
00377     
00378     _x += dx;    <span class="comment">// note: this is a valarray operation</span>
00379     _y += dy;
00380 
00381     cout &lt;&lt; <span class="stringliteral">"DEBUG: Camera: camera coordinates shifted by "</span>
00382          &lt;&lt;dx&lt;&lt;<span class="stringliteral">","</span>&lt;&lt;dy&lt;&lt;endl;
00383 
00384 }
00385 
00386 
<a name="l00406"></a><a class="code" href="classTelescopeArray.html#a0">00406</a> <a class="code" href="classTelescopeArray.html#a0">TelescopeArray::TelescopeArray</a>(string filename, vector&lt;int&gt; nadc, <span class="keywordtype">int</span> utdate) {
00407     
00408     string fname = getSupportDir()+filename+<span class="stringliteral">".array"</span>;
00409     ifstream infile( fname.c_str() );
00410     <span class="keywordflow">if</span> (infile.fail() ) 
00411         <span class="keywordflow">if</span> (infile.fail()) {
00412             cerr &lt;&lt; <span class="stringliteral">"** Couldn't open array datafile '"</span> &lt;&lt;filename&lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt; endl;
00413             cerr &lt;&lt; <span class="stringliteral">"** Set the environment variable WUPARAMDIR to the "</span>
00414                  &lt;&lt; <span class="stringliteral">"directory"</span>  &lt;&lt; endl &lt;&lt; <span class="stringliteral">"** where it is found"</span>
00415                  &lt;&lt;endl;
00416             <span class="keywordflow">throw</span> <a class="code" href="classAnalysisException.html">AnalysisException</a>(<span class="stringliteral">"Couldn't open array definition: "</span>
00417                                     +filename);
00418     }
00419     
00420     string header;
00421     <span class="keywordtype">double</span> version;
00422 
00423     infile &gt;&gt; header &gt;&gt; version;
00424 
00425     <span class="comment">// could check if version is wrong here - should do that if you</span>
00426     <span class="comment">// add any colums later which break the format.</span>
00427 
00428     <span class="keywordflow">if</span> (header != <span class="stringliteral">"WUPARAM-ARRAY-DEFINITION"</span>) {
00429         cerr &lt;&lt; <span class="stringliteral">"** The array definition '"</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">"' appears to be"</span>&lt;&lt;endl
00430              &lt;&lt; <span class="stringliteral">"** in the wrong format. Please check it"</span>&lt;&lt;endl;
00431         <span class="keywordflow">throw</span> <a class="code" href="classAnalysisException.html">AnalysisException</a>(<span class="stringliteral">"Bad format for: "</span>+filename);
00432     }
00433 
00434     TelInfo tel;
00435     vector&lt;string&gt; tokens;
00436     string line, camfile;
00437     <span class="keywordtype">int</span> i,linenum=1;
00438 
00439     <span class="keywordflow">while</span> (infile &amp;&amp;  !infile.eof() ){
00440         
00441         getline( infile, line, <span class="charliteral">'\n'</span> );
00442 
00443         <span class="comment">// remove comments</span>
00444         i=line.find(<span class="stringliteral">"#"</span>);
00445         line = line.substr(0,i);
00446 
00447         <span class="comment">// tokenize</span>
00448         
00449         tokenize( line, tokens, <span class="stringliteral">" \t,"</span> );
00450         
00451         <span class="comment">// check </span>
00452 
00453         <span class="keywordflow">if</span> (tokens.size() == 0) <span class="keywordflow">continue</span>;
00454         <span class="keywordflow">if</span> (tokens.size() != 5) {
00455             cerr &lt;&lt;<span class="stringliteral">"Line "</span>&lt;&lt;linenum&lt;&lt;<span class="stringliteral">": expected 5 columns, got "</span>
00456                  &lt;&lt;tokens.size()&lt;&lt;endl;
00457             <span class="keywordflow">throw</span> <a class="code" href="classAnalysisException.html">AnalysisException</a>(<span class="stringliteral">"Syntax error in "</span>+filename );
00458         }
00459 
00460         <span class="comment">// read data:</span>
00461         
00462         tel.x = atof(tokens[0].c_str());
00463         tel.y = atof(tokens[1].c_str());
00464         tel.z = atof(tokens[2].c_str());
00465         tel.r = atof(tokens[3].c_str())/2.0;
00466         camfile = tokens[4];
00467         
00468         <span class="keywordtype">int</span> k = _telescope.size();
00469 
00470         <span class="keywordflow">if</span> (camfile == <span class="stringliteral">"AUTO"</span>) {
00471             <span class="keywordflow">if</span> (nadc.size() &lt; k+1) {
00472                 <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00473                 logger-&gt;<a class="code" href="classLogger.html#a0">printf</a>(<span class="stringliteral">"Data reports %d telescopes, while array"</span>
00474                                <span class="stringliteral">" specifies %d. Using default 499 pix camera"</span>
00475                                <span class="stringliteral">" for telescope %d"</span>, 
00476                                nadc.size(), _telescope.size(), k);
00477                 tel.cam = <span class="keyword">new</span> <a class="code" href="classCamera.html">Camera</a>( 499, utdate );
00478             }
00479             <span class="keywordflow">else</span> {
00480                 <span class="keywordflow">try</span>{
00481                     tel.cam = <span class="keyword">new</span> <a class="code" href="classCamera.html">Camera</a>( nadc.at(k), utdate );
00482                 }
00483                 <span class="keywordflow">catch</span> (out_of_range &amp;e) {
00484                     cout &lt;&lt; <span class="stringliteral">"DEBUG: nadc wrong dimension: "</span> &lt;&lt; e.what() &lt;&lt; endl;
00485                     cout &lt;&lt; <span class="stringliteral">"DEBUG: k="</span>&lt;&lt;k&lt;&lt;<span class="stringliteral">", nadc.size()="</span>&lt;&lt;nadc.size()&lt;&lt;endl;
00486                     <span class="keywordflow">throw</span> e;
00487                 }
00488 
00489             }
00490         }
00491         <span class="keywordflow">else</span> {
00492             tel.cam = <span class="keyword">new</span> <a class="code" href="classCamera.html">Camera</a>( (<span class="keywordtype">char</span>*) camfile.c_str() );
00493         }
00494 
00495         <span class="comment">// add the camera to the array:</span>
00496         
00497         _telescope.push_back( tel );
00498         
00499         linenum++;
00500 
00501     }
00502 
00503 
00504     <span class="comment">// compute array bounding box:</span>
00505 
00506     _minx =10000;
00507     _miny =10000;
00508     _maxx =-10000;
00509     _maxy =-10000;
00510 
00511     <span class="keywordtype">double</span> x0,y0,x1,y1;
00512 
00513     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;getNumTelescopes(); i++) {
00514 
00515         cout &lt;&lt; <span class="stringliteral">"TEL "</span>&lt;&lt;i&lt;&lt;<span class="stringliteral">": "</span>
00516              &lt;&lt;getLocationX(i) &lt;&lt; <span class="stringliteral">","</span>
00517              &lt;&lt;getLocationY(i) &lt;&lt;endl;
00518 
00519         x0 = _telescope[i].x - _telescope[i].r;
00520         x1 = _telescope[i].x + _telescope[i].r;
00521         y0 = _telescope[i].y - _telescope[i].r;
00522         y1 = _telescope[i].y + _telescope[i].r;
00523 
00524         _minx = fmin( _minx, x0 );
00525         _miny = fmin( _miny, y0 );
00526         _maxx = fmax( _maxx, x1 );
00527         _maxy = fmax( _maxy, y1 );
00528     }
00529 
00530     <span class="comment">// make it square!</span>
00531 <span class="comment">//     _minx = fmin( _minx, _miny );</span>
00532 <span class="comment">//     _miny = fmin( _minx, _miny );</span>
00533 <span class="comment">//     _maxx = fmax( _maxx, _maxy );</span>
00534 <span class="comment">//     _maxy = fmax( _maxx, _maxy );</span>
00535 
00536     cout &lt;&lt; <span class="stringliteral">"TelescopeArray: loaded "</span>&lt;&lt;getNumTelescopes()&lt;&lt;<span class="stringliteral">" telescopes"</span>&lt;&lt;endl;
00537 
00538 }
00539 
00540 
00541 TelescopeArray::~TelescopeArray() {
00542 
00543     <span class="comment">// clean up all the cameras!</span>
00544     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;_telescope.size(); i++) {
00545         <span class="keywordflow">if</span> (_telescope[i].cam) <span class="keyword">delete</span> _telescope[i].cam;
00546     }
00547 
00548 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:45 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
