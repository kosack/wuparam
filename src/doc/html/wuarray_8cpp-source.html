<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: wuarray.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>wuarray.cpp</h1><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">// Program to do array analysis for multi-telescope data.  </span>
00003 <span class="comment">// </span>
00004 <span class="comment">// 050910, KPK - right now it's just a stub of a program which does</span>
00005 <span class="comment">// nothing in particular other than read the data.  Vicky will be</span>
00006 <span class="comment">// doing the implementation.</span>
00007 
00008 <span class="preprocessor">#include &lt;iostream&gt;</span>
00009 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00010 <span class="preprocessor">#include &lt;getopt.h&gt;</span>
00011 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00012 <span class="preprocessor">#include &lt;fstream&gt;</span>
00013 <span class="preprocessor">#include &lt;string&gt;</span>
00014 <span class="preprocessor">#include &lt;exception&gt;</span>
00015 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00016 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00017 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00018 
00019 <span class="preprocessor">#include "Types.h"</span>
00020 <span class="preprocessor">#include "Exceptions.h"</span>
00021 <span class="preprocessor">#include "Config.h"</span>
00022 <span class="preprocessor">#include "Parameterizer.h"</span>
00023 <span class="preprocessor">#include "ProgressBar.h"</span>
00024 <span class="preprocessor">#include "ImageAnalyzer.h"</span>
00025 <span class="preprocessor">#include "Cutter.h"</span>
00026 <span class="preprocessor">#include "Camera.h"</span>
00027 <span class="preprocessor">#include "Log.h"</span>
00028 <span class="preprocessor">#include "ParamDataReader.h"</span>
00029 <span class="preprocessor">#include "PlotMaker.h"</span>
00030 
00031 <span class="keyword">const</span> <span class="keywordtype">char</span> ESC = 0x1b;
00032 
00033 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00034 
<a name="l00040"></a><a class="code" href="namespaceWUArray.html">00040</a> <span class="keyword">namespace </span>WUArray {
00041 
<a name="l00045"></a><a class="code" href="namespaceWUArray.html#a10">00045</a>     <span class="keyword">enum</span> <a class="code" href="namespaceWUArray.html#a10">RunType</a> {
00046         TRACK,
00047         ON,
00048         OFF
00049     };
00050 
00051     <span class="keywordtype">void</span> <a class="code" href="namespaceWUArray.html#a4">showUsage</a>();
00052     <span class="keywordtype">void</span> <a class="code" href="namespaceWUArray.html#a5">getCommandLineOptions</a>(<span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv);
00053     <span class="keywordtype">void</span> shutdown();
00054     <span class="keywordtype">void</span> trap_ctrl_c(<span class="keywordtype">int</span>);
00055     <span class="keywordtype">void</span> <a class="code" href="namespaceWUArray.html#a8">process</a>( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri );
00056     <span class="keywordtype">void</span> <a class="code" href="namespaceWUArray.html#a9">analyzeRun</a>( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri, RunType runtype );
00057 
00058     <a class="code" href="classPlotMaker.html">PlotMaker</a> *pm=NULL;    
00059 
00060 };
00061 
00062 <span class="keyword">using</span> <span class="keyword">namespace </span>WUArray;
00063 
00064 
00068 <span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[] ) {
00069 
00070 
00071     <span class="comment">// ===================================================================</span>
00072     <span class="comment">// Set up some things for handling ctrl-c and proper shutdown:</span>
00073     <span class="comment">// ===================================================================</span>
00074 
00075     <span class="comment">// set up ctrl-c handler  </span>
00076     <span class="keyword">struct </span>sigaction sa;
00077     
00078     sigfillset( &amp;sa.sa_mask );
00079     sa.sa_flags = 0;
00080     sa.sa_handler = trap_ctrl_c;
00081     <span class="keywordflow">if</span> (sigaction(SIGINT, &amp;sa, NULL) &lt; 0) {
00082         perror( <span class="stringliteral">"sigaction SIGINT"</span> );
00083         exit(1);
00084     }
00085     
00086     <span class="comment">// turn off cursor because it looks nicer! Uses the VT100 escape</span>
00087     <span class="comment">// sequence for "cursor off"    </span>
00088     cerr &lt;&lt; ESC &lt;&lt; <span class="stringliteral">"[25l"</span>;
00089 
00090     <span class="comment">// call the shutdown function whenever an exit() is encountered</span>
00091     atexit(shutdown);
00092 
00093     <span class="comment">// set up the logger (which is used to write out important error messages)</span>
00094     <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00095     logger-&gt;<a class="code" href="classLogger.html#a1">info</a>(<span class="stringliteral">"&lt;&lt;&lt; This is WUArray &gt;&gt;&gt;"</span>);
00096 
00097     <span class="comment">// ===================================================================</span>
00098     <span class="comment">// Process the command-line options:</span>
00099     <span class="comment">// ===================================================================</span>
00100 
00101     getCommandLineOptions( argc, argv );
00102 
00103     <span class="keywordflow">if</span> (argc-optind &lt; 1) {
00104         showUsage();
00105         exit(1);
00106     }
00107 
00108     <span class="comment">// ===================================================================</span>
00109     <span class="comment">// Read the configuration and process the data! This is all</span>
00110     <span class="comment">// wrapped in a "try/catch block to handle any errors that get</span>
00111     <span class="comment">// thrown. Most wuparam functions throw an AnalysisException (or a</span>
00112     <span class="comment">// subtype like CriticalAnalysisException or</span>
00113     <span class="comment">// MildAnalysisException) when they encounter an error.  These are</span>
00114     <span class="comment">// caught and processing stops. I also catch standard template</span>
00115     <span class="comment">// library runtime_error exceptions, just in case something throws</span>
00116     <span class="comment">// one.</span>
00117     <span class="comment">// ===================================================================</span>
00118     
00119     <span class="keywordflow">try</span> {
00120         
00121         <span class="comment">// ---------------------------------------------------------------</span>
00122         <span class="comment">// Open and read the config file...</span>
00123         <span class="comment">// ---------------------------------------------------------------</span>
00124 
00125 
00126         <a class="code" href="classConfig.html">Config</a> conf( argv[optind] );
00127 
00128         <span class="keywordflow">if</span> (conf.<a class="code" href="classConfig.html#a6">getRunCount</a>() == 0) {
00129             <span class="keywordflow">throw</span> <a class="code" href="classAnalysisException.html">AnalysisException</a>(<span class="stringliteral">"No runs were specified in "</span>
00130                                     <span class="stringliteral">"the config file!"</span>);
00131         }
00132         
00133         <span class="comment">// ---------------------------------------------------------------</span>
00134         <span class="comment">// Loop through all the runs in the config file:</span>
00135         <span class="comment">// ---------------------------------------------------------------</span>
00136 
00137         <a class="code" href="classRunInfo.html">RunInfo</a> ri;
00138 
00139         <span class="keywordflow">while</span> (conf.<a class="code" href="classConfig.html#a5">isDone</a>() == <span class="keyword">false</span>) {
00140 
00141             ri = conf.<a class="code" href="classConfig.html#a3">getNextRun</a>();
00142 
00143             <span class="comment">// process the run:</span>
00144 
00145             <a class="code" href="namespaceWUArray.html#a8">process</a>( ri ); 
00146 
00147         }
00148 
00149         
00150 
00151 
00152 
00153     }
00154     <span class="keywordflow">catch</span> (<a class="code" href="classAnalysisException.html">AnalysisException</a> &amp;e) {
00155         cout &lt;&lt; <span class="stringliteral">"*** Couldn't process configuration '"</span> &lt;&lt; argv[optind] 
00156              &lt;&lt; <span class="stringliteral">"' because:  "</span> &lt;&lt; e.what() 
00157              &lt;&lt; endl;
00158             
00159         exit(1);            
00160     }
00161     <span class="keywordflow">catch</span> (runtime_error &amp;e) {
00162         cout &lt;&lt; <span class="stringliteral">"*** RUNTIME ERROR: "</span>&lt;&lt; e.what() &lt;&lt; endl;
00163         exit(1);
00164     }
00165     <span class="keywordflow">catch</span> (...) {
00166         cout &lt;&lt; <span class="stringliteral">"*** Caught unknown or unhandled exception!"</span>&lt;&lt;endl;
00167         exit(1);
00168     }
00169 
00170     
00171     exit(0);  <span class="comment">// note this automatically calls shutdown() </span>
00172     
00173 
00174 }
00175 
00176 
00177 
00178 
<a name="l00182"></a><a class="code" href="namespaceWUArray.html#a8">00182</a> <span class="keywordtype">void</span> <a class="code" href="namespaceWUArray.html#a8">WUArray::process</a>( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri ) {
00183 
00184     cout &lt;&lt; <span class="stringliteral">"WUArray: processing  "</span>;
00185     <span class="keywordflow">switch</span>( ri.<a class="code" href="classRunInfo.html#o0">type</a> ){
00186         
00187     <span class="keywordflow">case</span> Config::TRACK:
00188         cout &lt;&lt; <span class="stringliteral">"tracking run: "</span> &lt;&lt; ri.<a class="code" href="classRunInfo.html#o4">onid</a> &lt;&lt; endl; 
00189         <a class="code" href="namespaceWUArray.html#a9">analyzeRun</a>( ri, TRACK );
00190         <span class="keywordflow">break</span>;
00191     <span class="keywordflow">case</span> Config::ONOFF:
00192         cout &lt;&lt; <span class="stringliteral">"ON/OFF pair: "</span> &lt;&lt; ri.<a class="code" href="classRunInfo.html#o4">onid</a>&lt;&lt;<span class="stringliteral">" / "</span>&lt;&lt;ri.<a class="code" href="classRunInfo.html#o5">offid</a>&lt;&lt;endl; 
00193         <a class="code" href="namespaceWUArray.html#a9">analyzeRun</a>( ri, ON );
00194         <a class="code" href="namespaceWUArray.html#a9">analyzeRun</a>( ri, OFF );
00195         <span class="keywordflow">break</span>;
00196     <span class="keywordflow">default</span>:
00197         cout &lt;&lt; <span class="stringliteral">"UNKNOWN RUN TYPE "</span>&lt;&lt;ri.<a class="code" href="classRunInfo.html#o0">type</a>&lt;&lt;endl;
00198 
00199     }
00200     
00201     
00202     
00203 
00204 
00205 
00206 }
00207 
00208 
00217 <span class="keywordtype">void</span>
<a name="l00218"></a><a class="code" href="namespaceWUArray.html#a9">00218</a> <a class="code" href="namespaceWUArray.html#a9">WUArray::analyzeRun</a>( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri, WUArray::RunType runtype ) {
00219 
00220     string id;
00221 
00222     <span class="keywordflow">if</span> (runtype == TRACK || runtype == ON)
00223         id = ri.<a class="code" href="classRunInfo.html#o4">onid</a>;
00224     <span class="keywordflow">if</span> (runtype == OFF)
00225         id = ri.<a class="code" href="classRunInfo.html#o5">offid</a>;
00226                 
00227 
00228     <span class="comment">//===============================================================</span>
00229     <span class="comment">// Open the data file for reading:</span>
00230     <span class="comment">//===============================================================</span>
00231 
00232     <a class="code" href="classParamDataReader.html">ParamDataReader</a> reader(id+<span class="stringliteral">"/"</span>+id+<span class="stringliteral">"-param.ntuple"</span>);
00233     <a class="code" href="structHeaderRecord.html">HeaderRecord</a> header;
00234 
00235     reader.<a class="code" href="classParamDataReader.html#a2">getHeaderRecord</a>( header );
00236     
00237     <span class="comment">// the header contains some info about the parameterized data (see</span>
00238     <span class="comment">// DataRecords.h) For example:</span>
00239     cout &lt;&lt; <span class="stringliteral">"DATA HEADER: "</span>&lt;&lt;endl
00240          &lt;&lt; <span class="stringliteral">"-------------------------"</span>&lt;&lt;endl;
00241     cout &lt;&lt; <span class="stringliteral">"SOURCENAME: "</span> &lt;&lt; header.<a class="code" href="structHeaderRecord.html#o8">sourcename</a> &lt;&lt; endl;
00242     cout &lt;&lt; <span class="stringliteral">"NUM TELESCOPES: "</span> &lt;&lt; header.<a class="code" href="structHeaderRecord.html#o0">num_telescopes</a> &lt;&lt; endl;
00243     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;header.<a class="code" href="structHeaderRecord.html#o0">num_telescopes</a>;i++) {
00244         cout &lt;&lt; <span class="stringliteral">"TELESCOPE "</span>&lt;&lt; i&lt;&lt;<span class="stringliteral">" has "</span>&lt;&lt; header.<a class="code" href="structHeaderRecord.html#o1">nadc</a>[i] &lt;&lt; <span class="stringliteral">" pixels"</span>&lt;&lt;endl;
00245     }
00246     cout &lt;&lt; endl;
00247 
00248     <span class="comment">//===============================================================</span>
00249     <span class="comment">// Set up the array (which automatically loads the cameras)</span>
00250     <span class="comment">//===============================================================</span>
00251     
00252     <a class="code" href="classTelescopeArray.html">TelescopeArray</a> array( ri.<a class="code" href="classRunInfo.html#o8">arrayconfig</a>, header.<a class="code" href="structHeaderRecord.html#o1">nadc</a>, atoi(ri.<a class="code" href="classRunInfo.html#o7">utdate</a>.c_str()));
00253 
00254     cout &lt;&lt; <span class="stringliteral">"There are "</span>&lt;&lt;array.<a class="code" href="classTelescopeArray.html#a2">getNumTelescopes</a>()&lt;&lt;<span class="stringliteral">" telescopes in the array"</span>
00255          &lt;&lt; endl;
00256     cout &lt;&lt; <span class="stringliteral">"The locations are: "</span>&lt;&lt;endl;
00257 
00258     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; array.<a class="code" href="classTelescopeArray.html#a2">getNumTelescopes</a>(); i++) {
00259         
00260         cout &lt;&lt; <span class="stringliteral">"\t("</span> &lt;&lt; setw(6) &lt;&lt; array.<a class="code" href="classTelescopeArray.html#a4">getLocationX</a>(i) 
00261              &lt;&lt; <span class="stringliteral">", "</span>  &lt;&lt; setw(6) &lt;&lt; array.<a class="code" href="classTelescopeArray.html#a5">getLocationY</a>(i) 
00262              &lt;&lt; <span class="stringliteral">", "</span>  &lt;&lt; setw(6) &lt;&lt; array.<a class="code" href="classTelescopeArray.html#a6">getLocationZ</a>(i)  &lt;&lt; <span class="stringliteral">")"</span>&lt;&lt;endl;
00263 
00264     }
00265     
00266 
00267     <span class="comment">//===============================================================</span>
00268     <span class="comment">// for debugging purposes, you could plot the array, for</span>
00269     <span class="comment">// example. When constructing a plotmaker, the first argument is</span>
00270     <span class="comment">// the output type "X" for x-windows display, "ps" for</span>
00271     <span class="comment">// postscript. The second arg is the output file (ignored for</span>
00272     <span class="comment">// X-windows).  Note that I didn't really design plotmaker to work</span>
00273     <span class="comment">// nicely with array plots, so you may need to modify it to work</span>
00274     <span class="comment">// better.</span>
00275     <span class="comment">// ===============================================================</span>
00276 
00277     <span class="keywordflow">if</span>(pm==NULL) {
00278         pm = <span class="keyword">new</span> <a class="code" href="classPlotMaker.html">PlotMaker</a>( <span class="stringliteral">"X"</span>, <span class="stringliteral">"x.out"</span> ,
00279                             array.<a class="code" href="classTelescopeArray.html#a7">getMinX</a>()-10, array.<a class="code" href="classTelescopeArray.html#a9">getMinY</a>()-10,
00280                             array.<a class="code" href="classTelescopeArray.html#a8">getMaxX</a>()+10, array.<a class="code" href="classTelescopeArray.html#a10">getMaxY</a>()+10 );
00281         cout &lt;&lt; <span class="stringliteral">"DEBUG: Created new PlotMaker"</span>&lt;&lt;endl;
00282     }
00283 
00284     cout &lt;&lt; <span class="stringliteral">"DEBUG: plotting the array for example..."</span>&lt;&lt;endl;
00285     pm-&gt;<a class="code" href="classPlotMaker.html#a34">setScaleFactor</a>( 20.0 );
00286     pm-&gt;<a class="code" href="classPlotMaker.html#a35">setTicLevel</a>( 2 );
00287     pm-&gt;<a class="code" href="classPlotMaker.html#a2">setAxisBox</a>( array.<a class="code" href="classTelescopeArray.html#a7">getMinX</a>(), array.<a class="code" href="classTelescopeArray.html#a9">getMinY</a>(),
00288                          array.<a class="code" href="classTelescopeArray.html#a8">getMaxX</a>(), array.<a class="code" href="classTelescopeArray.html#a10">getMaxY</a>() );
00289     pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>(array);
00290     pm-&gt;<a class="code" href="classPlotMaker.html#a11">plotAxes</a>();
00291     pm-&gt;<a class="code" href="classPlotMaker.html#a12">plotTitle</a>(<span class="stringliteral">"The Array: "</span>);
00292     pm-&gt;<a class="code" href="classPlotMaker.html#a13">plotSubtitle</a>(<span class="stringliteral">"configuration: "</span>+ri.<a class="code" href="classRunInfo.html#o8">arrayconfig</a>);
00293     pm-&gt;<a class="code" href="classPlotMaker.html#a7">newPage</a>(); <span class="comment">// newpage creates a new page for eps file, or</span>
00294                    <span class="comment">// swaps the display buffers for X plots</span>
00295     sleep(2);
00296 
00297     <span class="comment">// example of plotting a single camera:</span>
00298     cout &lt;&lt; <span class="stringliteral">"DEBUG: plotting camera 0 for example..."</span>&lt;&lt;endl;
00299     Array_t testimage(array.<a class="code" href="classTelescopeArray.html#a3">getCamera</a>(0)-&gt;<a class="code" href="classCamera.html#a9">getNumPixels</a>());
00300     vector&lt;Pedestal&gt; testpeds(array.<a class="code" href="classTelescopeArray.html#a3">getCamera</a>(0)-&gt;<a class="code" href="classCamera.html#a9">getNumPixels</a>());
00301     vector&lt;int&gt; testcleanpix;
00302     <a class="code" href="classCamera.html">Camera</a> *cam = array.<a class="code" href="classTelescopeArray.html#a3">getCamera</a>(0);
00303 
00304     pm-&gt;<a class="code" href="classPlotMaker.html#a8">pushState</a>(); <span class="comment">// save the old space and settings</span>
00305     pm-&gt;<a class="code" href="classPlotMaker.html#a35">setTicLevel</a>(1);
00306     pm-&gt;<a class="code" href="classPlotMaker.html#a34">setScaleFactor</a>(1);
00307     pm-&gt;<a class="code" href="classPlotMaker.html#a5">setSpace</a>(cam-&gt;<a class="code" href="classCamera.html#a16">getMinX</a>()-0.4, cam-&gt;<a class="code" href="classCamera.html#a17">getMinY</a>()-0.4,
00308                  cam-&gt;<a class="code" href="classCamera.html#a18">getMaxX</a>()+0.4, cam-&gt;<a class="code" href="classCamera.html#a19">getMaxY</a>()+0.4);
00309     pm-&gt;<a class="code" href="classPlotMaker.html#a2">setAxisBox</a>( *cam );
00310     pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>( *cam, testimage, testpeds,testcleanpix );
00311     pm-&gt;<a class="code" href="classPlotMaker.html#a11">plotAxes</a>();
00312     pm-&gt;<a class="code" href="classPlotMaker.html#a12">plotTitle</a>(<span class="stringliteral">"Camera View"</span>);
00313     pm-&gt;<a class="code" href="classPlotMaker.html#a13">plotSubtitle</a>(<span class="stringliteral">"Camera 0"</span>);
00314     pm-&gt;<a class="code" href="classPlotMaker.html#a9">popState</a>(); <span class="comment">// restore old space and settings</span>
00315     pm-&gt;<a class="code" href="classPlotMaker.html#a7">newPage</a>();
00316     sleep(2);
00317 
00318     <span class="comment">// ===============================================================</span>
00319     <span class="comment">// Now, process the data in the data file: Here is where you'll</span>
00320     <span class="comment">// have to combine each sequence of events into an "array event",</span>
00321     <span class="comment">// which stores array info and an array of telescope-events</span>
00322     <span class="comment">// (HillasParameterizations).  You'll probably want to define a</span>
00323     <span class="comment">// structure like:</span>
00324     <span class="comment">//</span>
00325     <span class="comment">//     struct ArrayEvent {</span>
00326     <span class="comment">//    </span>
00327     <span class="comment">//       // Telescope Parameters:</span>
00328     <span class="comment">//       HillasParameterization televent[MAXTELS];</span>
00329     <span class="comment">//    </span>
00330     <span class="comment">//       //Array Parameters:</span>
00331     <span class="comment">//       ...</span>
00332     <span class="comment">//     }</span>
00333     <span class="comment">//    </span>
00334     <span class="comment">// to store the events in, and write a routine to write them to a</span>
00335     <span class="comment">// data file (e.g. using GSL's n-tuple writer)</span>
00336     <span class="comment">// ===============================================================</span>
00337 
00338     <a class="code" href="structHillasParameterization.html">HillasParameterization</a> param;
00339 
00340     <span class="comment">// here's an example of a 1D histogram from 0 to 90 with 18 bins:</span>
00341     <span class="comment">// you'll probably want to do an array or vector of these, one for</span>
00342     <span class="comment">// each telescope or something.</span>
00343     <a class="code" href="classHistogram.html">Histogram</a> examplehistogram(18, 0,90, <span class="stringliteral">"Alpha"</span> );
00344 
00345     <span class="comment">// An example of a 2D histogram: 30x30 bins, with coordinates</span>
00346     <span class="comment">// spanning (-2,-2)-(2,2)</span>
00347     <a class="code" href="classImage2D.html">Image2D</a> exampleimage( 30,30 );
00348     exampleimage.<a class="code" href="classImage2D.html#a1">setCoordinateBox</a>( -2,-2,2,2 );
00349 
00350     <span class="comment">// a progress bar, just for fun:</span>
00351     <a class="code" href="classProgressBar.html">ProgressBar</a> progress( reader.<a class="code" href="classParamDataReader.html#a4">size</a>() );
00352 
00353     cout &lt;&lt; <span class="stringliteral">"There are "</span>&lt;&lt; reader.<a class="code" href="classParamDataReader.html#a4">size</a>()
00354          &lt;&lt; <span class="stringliteral">" single-telescope events in the data"</span>&lt;&lt;endl;
00355 
00356     <span class="comment">// --------------------------------------------------</span>
00357     <span class="comment">// The main loop over events:</span>
00358     <span class="comment">// --------------------------------------------------</span>
00359 
00360     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;reader.<a class="code" href="classParamDataReader.html#a4">size</a>(); i++) {
00361         
00362         reader.<a class="code" href="classParamDataReader.html#a3">getNextEventRecord</a>( param );
00363         
00364         <span class="comment">// note HillasParameterization contains a field called</span>
00365         <span class="comment">// "telescope_id" which is the integer telescope number</span>
00366         <span class="comment">// (starting at 0), which should be used to construct array</span>
00367         <span class="comment">// events.  The data should have events in the following order: </span>
00368         <span class="comment">//       event 0 for telescope 0</span>
00369         <span class="comment">//       event 0 for telescope 1</span>
00370         <span class="comment">//       event 0 for telescope 2</span>
00371         <span class="comment">//       ..</span>
00372         <span class="comment">//       event 0 for telescope N</span>
00373         <span class="comment">//       event 1 for telescope 0</span>
00374         <span class="comment">//       event 1 for telescope 1</span>
00375         <span class="comment">//       event 1 for telescope 2</span>
00376         <span class="comment">//       .. </span>
00377         <span class="comment">//       event 1 for telescope N</span>
00378         <span class="comment">//    ...</span>
00379         
00380         examplehistogram.<a class="code" href="classHistogram.html#a3">increment</a>( param.<a class="code" href="structHillasParameterization.html#o9">alpha</a> * 180.0/M_PI );
00381         exampleimage.<a class="code" href="classImage2D.html#a17">addHistRadially</a>( param.<a class="code" href="structHillasParameterization.html#o1">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>,
00382                                       param.<a class="code" href="structHillasParameterization.html#o1">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>,
00383                                       1.0, 0.2 );
00384 
00385         <span class="comment">// print progress bar every 1024 events (don't do to often, as</span>
00386         <span class="comment">// it takes CPU cycles!)</span>
00387         <span class="keywordflow">if</span> (i%1024==0) progress.<a class="code" href="classProgressBar.html#a2">print</a>( i ); 
00388 
00389     } <span class="comment">// end loop over events</span>
00390 
00391     <span class="comment">// Done reading data.</span>
00392     progress.<a class="code" href="classProgressBar.html#a3">printClear</a>();
00393 
00394     <span class="comment">// save the histogram to a file</span>
00395     examplehistogram.<a class="code" href="classHistogram.html#a13">save</a>( id+<span class="stringliteral">"/"</span>+id+<span class="stringliteral">"-example-alpha"</span> );
00396     
00397     <span class="comment">// save the image to a file. The extension will be .im2d, these</span>
00398     <span class="comment">// can be plotted later with wuplot or the image object itself</span>
00399     <span class="comment">// directly with the PlotMaker class.</span>
00400     exampleimage.<a class="code" href="classImage2D.html#a9">save</a>( id+<span class="stringliteral">"/"</span>+id+<span class="stringliteral">"-example-image"</span> );
00401     
00402 }
00403 
00407 <span class="keywordtype">void</span>
<a name="l00408"></a><a class="code" href="namespaceWUArray.html#a4">00408</a> <a class="code" href="namespaceWUArray.html#a4">WUArray::showUsage</a>() {
00409 
00410     cout &lt;&lt; <span class="stringliteral">"USAGE: wuarray &lt;config file&gt;"</span> &lt;&lt; endl;
00411         
00412 }
00413 
00414 
00420 <span class="keywordtype">void</span> 
<a name="l00421"></a><a class="code" href="namespaceWUArray.html#a5">00421</a> <a class="code" href="namespaceWUArray.html#a5">WUArray::getCommandLineOptions</a>(<span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv) {
00422 
00423     <span class="keywordtype">int</span> ret=0;
00424     <span class="keywordtype">int</span> c;
00425 
00426     <span class="keywordflow">while</span> ( ret != -1 ) {
00427 
00428         ret=getopt( argc, argv, <span class="stringliteral">"ab:"</span>);
00429         c = ret;
00430 
00431         <span class="keywordflow">switch</span> (c) {
00432         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>:
00433             <span class="comment">// recognises -a</span>
00434             cout &lt;&lt; <span class="stringliteral">"Example of a switch option"</span> &lt;&lt;endl;
00435             <span class="keywordflow">break</span>;
00436         <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
00437             <span class="comment">// recognises -b &lt;argument&gt;</span>
00438             cout &lt;&lt; <span class="stringliteral">"Example of a  option with argument: "</span> 
00439                  &lt;&lt; optarg &lt;&lt;endl;
00440             <span class="keywordflow">break</span>;
00441         <span class="keywordflow">default</span>:
00442             <span class="keywordflow">break</span>;
00443         }
00444         
00445     }
00446     
00447 }
00448 
00449 
00450 
00451 <span class="keywordtype">void</span> WUArray::trap_ctrl_c( <span class="keywordtype">int</span> n) {
00452 
00453     <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00454 
00455     <span class="keywordflow">if</span> ( n == SIGINT ){
00456         cout &lt;&lt; endl&lt;&lt;endl&lt;&lt;<span class="stringliteral">"WUArray was interrupted by CTRL-C. "</span> &lt;&lt; endl
00457              &lt;&lt; <span class="stringliteral">"Array analysis was not completed."</span>&lt;&lt;endl;
00458         logger-&gt;<a class="code" href="classLogger.html#a1">info</a>(<span class="stringliteral">"WUArray was interrupted by CTRL-C"</span>);
00459     }
00460 
00461     exit(1);
00462 
00463 }
00464 
00465 <span class="keywordtype">void</span> WUArray::shutdown() {
00466 
00467     <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00468 
00469     <span class="comment">// turn on cursor</span>
00470     cerr &lt;&lt; ESC &lt;&lt; <span class="stringliteral">"[25h"</span>;
00471 
00472     <span class="comment">// ---------------------------------------------------------------</span>
00473     <span class="comment">// clean up any global variables...</span>
00474     <span class="comment">// ---------------------------------------------------------------</span>
00475     <span class="keywordflow">if</span> (pm != NULL) {
00476         cout &lt;&lt; <span class="stringliteral">"DEBUG: deleting plotmaker..."</span>&lt;&lt;endl;
00477         <span class="keyword">delete</span> pm;
00478     }
00479     
00480     logger-&gt;<a class="code" href="classLogger.html#a0">printf</a>(<span class="stringliteral">"WUArray exited"</span>);
00481 
00482 }
00483 
00484 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:46 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
