<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>wuparam: PlotMaker.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">wuparam&#160;<span id="projectnumber">0.1</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">PlotMaker.cpp</div>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- c-basic-offset: 4 -*- */</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;cstdio&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;gsl/gsl_math.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;plot.h&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include  &quot;PlotMaker.h&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;ImageAnalyzer.h&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;Camera.h&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;PedestalFinder.h&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;MuonImageAnalyzer.h&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;StarCatalog.h&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;Types.h&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;AngleConverters.h&quot;</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">using namespace </span>std;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 PlotMaker::PlotMaker( <span class="keywordtype">string</span> type, <span class="keywordtype">string</span> filename,
<a name="l00025"></a>00025                       <span class="keywordtype">double</span> minx,<span class="keywordtype">double</span> miny, <span class="keywordtype">double</span> maxx, <span class="keywordtype">double</span> maxy ) {
<a name="l00026"></a>00026     
<a name="l00027"></a>00027     PlotState s;
<a name="l00028"></a>00028     
<a name="l00029"></a>00029     _minx=_maxx=_miny=_maxy=0;
<a name="l00030"></a>00030     _pageminx = minx;
<a name="l00031"></a>00031     _pagemaxx = maxx;
<a name="l00032"></a>00032     _pageminy = miny; 
<a name="l00033"></a>00033     _pagemaxy = maxy;
<a name="l00034"></a>00034     _keyoffset = 0.2;
<a name="l00035"></a>00035     _keywidth = 0.1;
<a name="l00036"></a>00036     _numkeycolors = 20;
<a name="l00037"></a>00037     _pixelscale = -1;
<a name="l00038"></a>00038     _maxmagnitude = 10.0;
<a name="l00039"></a>00039     _ticlevel = 0;
<a name="l00040"></a>00040     _labeloffset=0.1;
<a name="l00041"></a>00041     _titleoffset=0.12;
<a name="l00042"></a>00042     _subtitleoffset=0.03;
<a name="l00043"></a>00043     _ticmarksize=0.06;
<a name="l00044"></a>00044     _scalefactor = 1.0; 
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     s.use_inward_tics = <span class="keyword">true</span>;
<a name="l00047"></a>00047     s.contourcolor = <span class="stringliteral">&quot;LightGray&quot;</span>;
<a name="l00048"></a>00048     s.contourlinestyle = LINE_SOLID;
<a name="l00049"></a>00049     s.ticcolor = <span class="stringliteral">&quot;black&quot;</span>;
<a name="l00050"></a>00050     s.labelcolor=<span class="stringliteral">&quot;white&quot;</span>;
<a name="l00051"></a>00051     s.contourwidth = 0.009;
<a name="l00052"></a>00052     s.markertype = 1;
<a name="l00053"></a>00053     s.markersize = 0.2;
<a name="l00054"></a>00054     s.markercolor = <span class="stringliteral">&quot;white&quot;</span>;
<a name="l00055"></a>00055     s.labelangle = 0.0;
<a name="l00056"></a>00056     s.labelsize = 0.1;
<a name="l00057"></a>00057     s.autoscale = <span class="keyword">true</span>;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     _state.push(s);
<a name="l00060"></a>00060     
<a name="l00061"></a>00061     setColorMap( COLORMAP_BLUES );
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     plotter_params = pl_newplparams();
<a name="l00064"></a>00064     pl_setplparam( plotter_params, <span class="stringliteral">&quot;PAGESIZE&quot;</span>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;letter&quot;</span>);
<a name="l00065"></a>00065     pl_setplparam( plotter_params, <span class="stringliteral">&quot;BITMAPSIZE&quot;</span>, (<span class="keywordtype">char</span>*)<span class="stringliteral">&quot;640x640&quot;</span>);
<a name="l00066"></a>00066     pl_setplparam( plotter_params, <span class="stringliteral">&quot;USE_DOUBLE_BUFFERING&quot;</span>, (<span class="keywordtype">void</span>*)<span class="stringliteral">&quot;yes&quot;</span>);    
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <span class="keywordflow">if</span> (type==<span class="stringliteral">&quot;X&quot;</span>) 
<a name="l00069"></a>00069         _fp = stdout;
<a name="l00070"></a>00070     <span class="keywordflow">else</span>
<a name="l00071"></a>00071         _fp = fopen( filename.c_str(), <span class="stringliteral">&quot;w&quot;</span> );
<a name="l00072"></a>00072     
<a name="l00073"></a>00073     <span class="keywordflow">if</span> ((plotter = pl_newpl_r( type.c_str(), stdin, _fp, stderr,
<a name="l00074"></a>00074                                plotter_params)) == NULL) {
<a name="l00075"></a>00075         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html" title="Thrown on errors in the analysis where the program cannot recover.">CriticalAnalysisException</a>(<span class="stringliteral">&quot;Couldn&#39;t create plotter&quot;</span>);
<a name="l00076"></a>00076     }
<a name="l00077"></a>00077     
<a name="l00078"></a>00078     pl_openpl_r( plotter );
<a name="l00079"></a>00079     pl_fspace_r( plotter, _pageminx, _pageminy, _pagemaxx, _pagemaxy); 
<a name="l00080"></a>00080     pl_flinewidth_r( plotter, 0.25); <span class="comment">// line thickness in user coordinates</span>
<a name="l00081"></a>00081     pl_pencolorname_r(plotter, <span class="stringliteral">&quot;black&quot;</span>); <span class="comment">// line color defaults</span>
<a name="l00082"></a>00082     pl_erase_r( plotter );      <span class="comment">// erase Plotter&#39;s graphics display</span>
<a name="l00083"></a>00083     pl_fmove_r(plotter ,0.0, 0.0); <span class="comment">// position the graphics cursor</span>
<a name="l00084"></a>00084     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00085"></a>00085     pl_ffontsize_r( plotter, _scalefactor*0.15);
<a name="l00086"></a>00086     
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00096"></a>00096 <span class="keywordtype">void</span> 
<a name="l00097"></a>00097 <a class="code" href="classPlotMaker.html#a7a63b2f17f113ee6b880aebf1cba1d91" title="Plot a set of axes around the AxisBox region.">PlotMaker::</a>
<a name="l00098"></a><a class="code" href="classPlotMaker.html#a7a63b2f17f113ee6b880aebf1cba1d91">00098</a> <a class="code" href="classPlotMaker.html#a7a63b2f17f113ee6b880aebf1cba1d91" title="Plot a set of axes around the AxisBox region.">plotAxes</a>() {
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="keywordtype">double</span> niceminx, niceminy, nicemaxx, nicemaxy;
<a name="l00101"></a>00101     <span class="keywordtype">int</span> niceticlevel;
<a name="l00102"></a>00102     <span class="keywordtype">double</span> p;
<a name="l00103"></a>00103     <span class="keywordtype">double</span> x,y;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     pl_savestate_r( plotter );
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     pl_pentype_r( plotter, 1);
<a name="l00108"></a>00108     pl_filltype_r( plotter, 0);
<a name="l00109"></a>00109     pl_flinewidth_r( plotter, 0.02*_scalefactor );
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00112"></a>00112     pl_ffontsize_r( plotter, _scalefactor*0.12);
<a name="l00113"></a>00113     
<a name="l00114"></a>00114     <span class="comment">// plot some nice major tic marks</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">//    niceticlevel = (int) log10(_maxx-_minx);</span>
<a name="l00117"></a>00117     <span class="comment">//    _ticlevel = </span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     p = pow( 10.0, -_ticlevel );
<a name="l00120"></a>00120     niceminx =  ceil(_minx * p)/p;
<a name="l00121"></a>00121     niceminy =  ceil(_miny * p)/p;
<a name="l00122"></a>00122     nicemaxy = floor(_maxy * p)/p;
<a name="l00123"></a>00123     nicemaxx = floor(_maxx * p)/p; 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="keywordflow">for</span> ( x = niceminx; x&lt;=nicemaxx; x+=1.0/p ) {
<a name="l00126"></a>00126         plotXTicAt( x );
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordflow">for</span> ( y = niceminy; y&lt;=nicemaxy; y+=1.0/p ) {
<a name="l00130"></a>00130         plotYTicAt( y );
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment">// plot the minor tic marks (at one higher ticlevel magnitude)</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     p = pow( 10.0, -(_ticlevel-1) );
<a name="l00136"></a>00136     niceminx =  ceil(_minx * p)/p;
<a name="l00137"></a>00137     niceminy =  ceil(_miny * p)/p;
<a name="l00138"></a>00138     nicemaxy = floor(_maxy * p)/p;
<a name="l00139"></a>00139     nicemaxx = floor(_maxx * p)/p; 
<a name="l00140"></a>00140    
<a name="l00141"></a>00141     <span class="keywordflow">for</span> ( x = niceminx; x&lt;=nicemaxx; x+=1.0/p ) {
<a name="l00142"></a>00142         plotXMinorTicAt( x );
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     <span class="keywordflow">for</span> ( y = niceminy; y&lt;=nicemaxy; y+=1.0/p ) {
<a name="l00146"></a>00146         plotYMinorTicAt( y );
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">// plot the bounding box</span>
<a name="l00151"></a>00151     pl_pentype_r( plotter, 1);
<a name="l00152"></a>00152     pl_filltype_r( plotter, 0);
<a name="l00153"></a>00153     pl_flinewidth_r( plotter, 0.02 );
<a name="l00154"></a>00154     pl_fbox_r( plotter, _minx, _miny, _maxx, _maxy );
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     pl_restorestate_r( plotter );
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="keywordtype">void</span> 
<a name="l00164"></a>00164 PlotMaker::
<a name="l00165"></a>00165 plotXTicAt( <span class="keywordtype">double</span> x ) {
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="keywordtype">char</span> text[64];
<a name="l00168"></a>00168     <span class="keywordtype">double</span> ticoffs;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     pl_flinewidth_r( plotter, 0.02*_scalefactor );
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">if</span> ( _state.top().use_inward_tics == true )
<a name="l00173"></a>00173         ticoffs = -_ticmarksize*_scalefactor;
<a name="l00174"></a>00174     <span class="keywordflow">else</span> 
<a name="l00175"></a>00175         ticoffs =  _ticmarksize*_scalefactor;
<a name="l00176"></a>00176         
<a name="l00177"></a>00177     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
<a name="l00178"></a>00178     pl_fline_r( plotter, x ,_maxy,  x,_maxy + ticoffs ) ;
<a name="l00179"></a>00179     pl_fline_r( plotter, x ,_miny,  x,_miny - ticoffs ) ;
<a name="l00180"></a>00180     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;black&quot;</span> );
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     pl_fmove_r( plotter, x, _miny - _labeloffset );
<a name="l00183"></a>00183     sprintf( text, <span class="stringliteral">&quot;%.1f&quot;</span>, x );
<a name="l00184"></a>00184     pl_alabel_r( plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;t&#39;</span>,  text );
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="keywordtype">void</span> 
<a name="l00189"></a>00189 PlotMaker::
<a name="l00190"></a>00190 plotYTicAt( <span class="keywordtype">double</span> y ){
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     <span class="keywordtype">char</span> text[64];
<a name="l00193"></a>00193     <span class="keywordtype">double</span> ticoffs;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     pl_flinewidth_r( plotter, 0.02*_scalefactor );
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="keywordflow">if</span> (_state.top().use_inward_tics == true )
<a name="l00198"></a>00198         ticoffs = -_ticmarksize*_scalefactor;
<a name="l00199"></a>00199     <span class="keywordflow">else</span> 
<a name="l00200"></a>00200         ticoffs =  _ticmarksize*_scalefactor;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
<a name="l00203"></a>00203     pl_fline_r( plotter, _maxx , y,  _maxx + ticoffs, y ) ;
<a name="l00204"></a>00204     pl_fline_r( plotter, _minx , y,  _minx - ticoffs, y ) ;
<a name="l00205"></a>00205     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;black&quot;</span> );
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     pl_fmove_r( plotter, _minx - _labeloffset, y );
<a name="l00208"></a>00208     sprintf( text, <span class="stringliteral">&quot;%.1f&quot;</span>, y );
<a name="l00209"></a>00209     pl_alabel_r( plotter,<span class="charliteral">&#39;r&#39;</span>,<span class="charliteral">&#39;c&#39;</span>,  text );
<a name="l00210"></a>00210    
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="keywordtype">void</span> 
<a name="l00215"></a>00215 PlotMaker::
<a name="l00216"></a>00216 plotXMinorTicAt( <span class="keywordtype">double</span> x ) {
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="keywordtype">double</span> ticoffs;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     pl_flinewidth_r( plotter, 0.01 );
<a name="l00221"></a>00221 
<a name="l00222"></a>00222     <span class="keywordflow">if</span> ( _state.top().use_inward_tics == true )
<a name="l00223"></a>00223         ticoffs = - _ticmarksize/1.5 *_scalefactor;
<a name="l00224"></a>00224     <span class="keywordflow">else</span> 
<a name="l00225"></a>00225         ticoffs = _ticmarksize/1.5 *_scalefactor;
<a name="l00226"></a>00226         
<a name="l00227"></a>00227     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
<a name="l00228"></a>00228     pl_fline_r( plotter, x ,_maxy,  x,_maxy + ticoffs ) ;
<a name="l00229"></a>00229     pl_fline_r( plotter, x ,_miny,  x,_miny - ticoffs ) ;
<a name="l00230"></a>00230     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;black&quot;</span> );
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="keywordtype">void</span> 
<a name="l00234"></a>00234 PlotMaker::
<a name="l00235"></a>00235 plotYMinorTicAt( <span class="keywordtype">double</span> y ){
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="keywordtype">double</span> ticoffs;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     pl_flinewidth_r( plotter, 0.01 );
<a name="l00240"></a>00240 
<a name="l00241"></a>00241     <span class="keywordflow">if</span> (_state.top().use_inward_tics == true )
<a name="l00242"></a>00242         ticoffs = - _ticmarksize/1.5 *_scalefactor;
<a name="l00243"></a>00243     <span class="keywordflow">else</span> 
<a name="l00244"></a>00244         ticoffs = _ticmarksize/1.5 *_scalefactor;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     pl_pencolorname_r( plotter,_state.top().ticcolor.c_str() );
<a name="l00247"></a>00247     pl_fline_r( plotter, _maxx , y,  _maxx + ticoffs, y ) ;
<a name="l00248"></a>00248     pl_fline_r( plotter, _minx , y,  _minx - ticoffs, y ) ;
<a name="l00249"></a>00249     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;black&quot;</span> );
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="keywordtype">void</span>
<a name="l00255"></a>00255 PlotMaker:: 
<a name="l00256"></a>00256 plotTitle( std::string title ) {
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     pl_savestate_r( plotter );
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00261"></a>00261     pl_ffontsize_r( plotter, _scalefactor*0.15);    
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     pl_fmove_r( plotter, (_minx+_maxx)/2.0, _maxy+_titleoffset );
<a name="l00264"></a>00264     pl_alabel_r( plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;b&#39;</span>, title.c_str() );
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     pl_restorestate_r(  plotter );
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 
<a name="l00270"></a>00270 <span class="keywordtype">void</span>
<a name="l00271"></a>00271 PlotMaker:: 
<a name="l00272"></a>00272 plotSubtitle( std::string title ) {
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     pl_savestate_r( plotter );
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00277"></a>00277     pl_ffontsize_r( plotter, _scalefactor*0.09);    
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     pl_fmove_r( plotter, (_minx+_maxx)/2.0, _maxy+_subtitleoffset );
<a name="l00280"></a>00280     pl_alabel_r( plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;b&#39;</span>, title.c_str() );
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     pl_restorestate_r(  plotter );
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="keywordtype">void</span> 
<a name="l00287"></a>00287 PlotMaker::
<a name="l00288"></a>00288 plot( <a class="code" href="classImage2D.html" title="Representation of a 2-D raster image (for 2D analysis)">Image2D</a> &amp;im2d ) {
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="keywordtype">double</span> minx = im2d.getMinX();
<a name="l00291"></a>00291     <span class="keywordtype">double</span> miny = im2d.getMinY();
<a name="l00292"></a>00292     <span class="keywordtype">double</span> maxx = im2d.getMaxX();
<a name="l00293"></a>00293     <span class="keywordtype">double</span> maxy = im2d.getMaxY();
<a name="l00294"></a>00294     <span class="keywordtype">double</span> x1, y1, x2, y2;
<a name="l00295"></a>00295     <span class="comment">//     double boxsizex = (maxx-minx)/(double)im2d.getXDim();</span>
<a name="l00296"></a>00296     <span class="comment">//     double boxsizey = (maxy-miny)/(double)im2d.getYDim();</span>
<a name="l00297"></a>00297     <span class="keywordtype">double</span> boxsizex = im2d.getXCoord(1)- im2d.getXCoord(0);
<a name="l00298"></a>00298     <span class="keywordtype">double</span> boxsizey = im2d.getYCoord(1)- im2d.getYCoord(0);
<a name="l00299"></a>00299     <span class="keywordtype">double</span> min; 
<a name="l00300"></a>00300     <span class="keywordtype">double</span> max; 
<a name="l00301"></a>00301     <span class="keywordtype">double</span> colorlevel;
<a name="l00302"></a>00302     <span class="keywordtype">int</span>  red, green, blue;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (_state.top().autoscale == <span class="keyword">true</span>) {
<a name="l00305"></a>00305         min = im2d.minValue();
<a name="l00306"></a>00306         max = im2d.maxValue();
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     <span class="keywordflow">else</span> {
<a name="l00309"></a>00309         min = _state.top().colorscale_lower;
<a name="l00310"></a>00310         max = _state.top().colorscale_upper;
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     pl_savestate_r( plotter );
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     pl_filltype_r( plotter, 1 );
<a name="l00316"></a>00316     pl_pentype_r(  plotter, 0 );
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="comment">// plot the image as a grid of boxes:</span>
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; im2d.getXDim(); i++) {
<a name="l00321"></a>00321         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt; im2d.getYDim(); j++) {
<a name="l00322"></a>00322 
<a name="l00323"></a>00323             x1 = im2d.getXCoord(i) - boxsizex/2.0;
<a name="l00324"></a>00324             y1 = im2d.getYCoord(j) - boxsizey/2.0;
<a name="l00325"></a>00325             x2 = im2d.getXCoord(i) + boxsizex/2.0;
<a name="l00326"></a>00326             y2 = im2d.getYCoord(j) + boxsizey/2.0;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328             colorlevel = ((im2d.getPixel(i,j)-min) / fabs(max-min));
<a name="l00329"></a>00329 
<a name="l00330"></a>00330             getMappedColor( colorlevel, red, green, blue );
<a name="l00331"></a>00331   
<a name="l00332"></a>00332             pl_fillcolor_r(  plotter, red, green, blue );
<a name="l00333"></a>00333             pl_fbox_r(  plotter, x1,y1,x2,y2 );
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         }
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <span class="comment">// now plot a colormap key</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordtype">double</span> h = (maxy-miny)/(<span class="keywordtype">double</span>)_numkeycolors;
<a name="l00341"></a>00341     x1 = maxx + _keyoffset;
<a name="l00342"></a>00342     x2 = x1 + _keywidth;
<a name="l00343"></a>00343     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;_numkeycolors; i++) {
<a name="l00344"></a>00344 
<a name="l00345"></a>00345         colorlevel = (double)i/(<span class="keywordtype">double</span>)_numkeycolors;
<a name="l00346"></a>00346         
<a name="l00347"></a>00347         getMappedColor( colorlevel, red, green, blue );
<a name="l00348"></a>00348         pl_fillcolor_r( plotter, red, green, blue );
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         y1 = miny + i*h;
<a name="l00351"></a>00351         y2 = miny + (i+1)*h;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         pl_fbox_r( plotter, x1,y1 ,x2,y2 );
<a name="l00354"></a>00354 
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">// plot the labels for the colormap</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     <span class="keywordtype">char</span> text[64];
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     pl_filltype_r( plotter, 0 );
<a name="l00362"></a>00362     pl_pentype_r(  plotter, 1 );
<a name="l00363"></a>00363     pl_flinewidth_r( plotter,0.02 ); 
<a name="l00364"></a>00364  
<a name="l00365"></a>00365     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00366"></a>00366     pl_ffontsize_r( plotter, _scalefactor*0.1 );        
<a name="l00367"></a>00367 
<a name="l00368"></a>00368     sprintf(text, <span class="stringliteral">&quot;%.1f&quot;</span>, min);
<a name="l00369"></a>00369     pl_fmove_r( plotter, x2+_ticmarksize, miny );
<a name="l00370"></a>00370     pl_alabel_r( plotter, <span class="charliteral">&#39;l&#39;</span>,<span class="charliteral">&#39;b&#39;</span>, text );
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     sprintf(text, <span class="stringliteral">&quot;%.1f&quot;</span>, max);
<a name="l00373"></a>00373     pl_fmove_r( plotter, x2+_ticmarksize, maxy );
<a name="l00374"></a>00374     pl_alabel_r( plotter, <span class="charliteral">&#39;l&#39;</span>,<span class="charliteral">&#39;t&#39;</span>, text );
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="keywordflow">if</span> (max&gt;0 &amp;&amp; min&lt;0) {
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         y1 = miny +  fabs(min/(max-min)) * (maxy-miny);
<a name="l00381"></a>00381         pl_pencolorname_r( plotter, <span class="stringliteral">&quot;black&quot;</span> );
<a name="l00382"></a>00382         pl_fline_r( plotter, x1 -_ticmarksize, y1, x2+_ticmarksize, y1 );
<a name="l00383"></a>00383         pl_fmove_r( plotter, x2+_ticmarksize, y1 );
<a name="l00384"></a>00384         pl_alabel_r( plotter, <span class="charliteral">&#39;l&#39;</span>,<span class="charliteral">&#39;c&#39;</span>, <span class="stringliteral">&quot; 0&quot;</span> );
<a name="l00385"></a>00385             
<a name="l00386"></a>00386     }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     pl_fbox_r( plotter, x1, miny ,x2, maxy );
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     pl_restorestate_r(  plotter );
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="keywordtype">void</span> 
<a name="l00396"></a>00396 PlotMaker::
<a name="l00397"></a>00397 plot( <a class="code" href="classCamera.html" title="Contains all operations pertaining to camera data.">Camera</a> &amp;cam, <span class="keyword">const</span> Array_t &amp;image, <span class="keyword">const</span> vector&lt;Pedestal&gt; &amp;peds,
<a name="l00398"></a>00398       vector&lt;int&gt; &amp;cleanpixels, CameraPlotType plottype ) {
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="keywordtype">double</span> qr;
<a name="l00401"></a>00401     <span class="keywordtype">char</span> text[128];
<a name="l00402"></a>00402     Array_t &amp;xc = cam.<a class="code" href="classCamera.html#a8a4b74941bc6cfcd97ec1b135f6fec09" title="Array of x coordinates.">xCoords</a>();
<a name="l00403"></a>00403     Array_t &amp;yc = cam.<a class="code" href="classCamera.html#af2892e20c0a16ae802fcd8cc454bf59d" title="Array of y coordinates.">yCoords</a>();
<a name="l00404"></a>00404     Array_t &amp;rad  = cam.<a class="code" href="classCamera.html#a6757b477302e1147fbcc5a5a6bb58122" title="Array of tube radii.">radii</a>();
<a name="l00405"></a>00405     <span class="keywordtype">double</span> max;
<a name="l00406"></a>00406     <span class="keywordtype">double</span> value;
<a name="l00407"></a>00407     <span class="keyword">register</span> <span class="keywordtype">int</span> i;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keywordflow">switch</span> (plottype) {
<a name="l00410"></a>00410     <span class="keywordflow">case</span> CAMERA_IMAGE:
<a name="l00411"></a>00411         max = image.max();
<a name="l00412"></a>00412         <span class="keywordflow">break</span>;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">case</span> CAMERA_PEDS:
<a name="l00415"></a>00415         max = -1e10;
<a name="l00416"></a>00416         <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++) {
<a name="l00417"></a>00417             <span class="keywordflow">if</span> (peds[i].pedestal &gt; max)
<a name="l00418"></a>00418                 max = peds[i].pedestal;
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420         <span class="keywordflow">break</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="keywordflow">case</span> CAMERA_PEDDISPS:
<a name="l00423"></a>00423         max = -1e10;
<a name="l00424"></a>00424         <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++) {
<a name="l00425"></a>00425             <span class="keywordflow">if</span> (peds[i].dispersion &gt; max)
<a name="l00426"></a>00426                 max = peds[i].dispersion;
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428         <span class="keywordflow">break</span>;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">default</span>:
<a name="l00431"></a>00431         max = image.max();
<a name="l00432"></a>00432         <span class="keywordflow">break</span>;
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     pl_savestate_r( plotter );
<a name="l00436"></a>00436     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00437"></a>00437     pl_ffontsize_r(plotter, _scalefactor*0.07);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     <span class="comment">// ===============================================================</span>
<a name="l00440"></a>00440     <span class="comment">// Set View parameters</span>
<a name="l00441"></a>00441 
<a name="l00442"></a>00442     pl_flinewidth_r( plotter, 0.005);  <span class="comment">// line thickness in user coords </span>
<a name="l00443"></a>00443     pl_bgcolorname_r(plotter, <span class="stringliteral">&quot;white&quot;</span>); <span class="comment">// background color for the window</span>
<a name="l00444"></a>00444     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;grey60&quot;</span>); 
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="comment">// ===============================================================</span>
<a name="l00447"></a>00447     <span class="comment">// draw camera</span>
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     pl_filltype_r(plotter, 0);                      <span class="comment">// don&#39;t fill</span>
<a name="l00450"></a>00450     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a4f2750f42d18cc49f5aa703466a64268" title="Number of pixels in camera.">getNumPixels</a>(); i++) {
<a name="l00451"></a>00451         pl_fellipse_r(plotter, xc[i], yc[i], rad[i], rad[i],0);
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <span class="comment">// ===============================================================</span>
<a name="l00455"></a>00455     <span class="comment">// draw signal</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     pl_filltype_r( plotter, 1 );
<a name="l00458"></a>00458     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a4f2750f42d18cc49f5aa703466a64268" title="Number of pixels in camera.">getNumPixels</a>(); i++) {
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         pl_fmove_r( plotter, 0.0, _maxy - 0.05);
<a name="l00461"></a>00461         
<a name="l00462"></a>00462         <span class="comment">// --------------------------------------------------</span>
<a name="l00463"></a>00463         <span class="comment">// choose value based on type:</span>
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <span class="keywordflow">switch</span> (plottype) {
<a name="l00466"></a>00466         <span class="keywordflow">case</span> CAMERA_IMAGE:
<a name="l00467"></a>00467             value = image[i];
<a name="l00468"></a>00468             <span class="keywordflow">break</span>;
<a name="l00469"></a>00469         <span class="keywordflow">case</span> CAMERA_PEDS:
<a name="l00470"></a>00470             value = peds[i].pedestal;
<a name="l00471"></a>00471             <span class="keywordflow">break</span>;
<a name="l00472"></a>00472         <span class="keywordflow">case</span> CAMERA_PEDDISPS:
<a name="l00473"></a>00473             value = peds[i].dispersion;
<a name="l00474"></a>00474             <span class="keywordflow">break</span>;
<a name="l00475"></a>00475         <span class="keywordflow">case</span> CAMERA_TUBENUMS:
<a name="l00476"></a>00476             value = 0;
<a name="l00477"></a>00477         <span class="keywordflow">default</span>:
<a name="l00478"></a>00478             value = image[i];
<a name="l00479"></a>00479             <span class="keywordflow">break</span>;
<a name="l00480"></a>00480             
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         <span class="comment">// --------------------------------------------------</span>
<a name="l00484"></a>00484         <span class="comment">// choose a color for the plot</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486         <span class="keywordflow">if</span> (value &gt;= 0) {
<a name="l00487"></a>00487             pl_pencolorname_r(plotter, <span class="stringliteral">&quot;LightSkyBlue&quot;</span>); 
<a name="l00488"></a>00488             pl_fillcolorname_r(plotter, <span class="stringliteral">&quot;LightSkyBlue&quot;</span>);
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490         <span class="keywordflow">else</span> { 
<a name="l00491"></a>00491             pl_pencolorname_r( plotter, <span class="stringliteral">&quot;goldenrod&quot;</span>); 
<a name="l00492"></a>00492             pl_fillcolorname_r( plotter, <span class="stringliteral">&quot;goldenrod&quot;</span>);
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494         
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="comment">// --------------------------------------------------</span>
<a name="l00497"></a>00497         <span class="comment">// apply scaling: </span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="keywordflow">if</span> (_pixelscale ==-1) {
<a name="l00500"></a>00500             <span class="comment">// Autoscale to max</span>
<a name="l00501"></a>00501             qr =  rad[i]*fabs(value)/max;
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503         <span class="keywordflow">else</span> {
<a name="l00504"></a>00504             <span class="comment">// Fixed scale to _pixelscale</span>
<a name="l00505"></a>00505             qr = rad[i]*fabs(value)/_pixelscale;
<a name="l00506"></a>00506             <span class="keywordflow">if</span> (qr &gt; rad[i]) qr = rad[i]; <span class="comment">// saturated</span>
<a name="l00507"></a>00507         }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="comment">// --------------------------------------------------</span>
<a name="l00511"></a>00511         <span class="comment">// deal with tubes which are off</span>
<a name="l00512"></a>00512 
<a name="l00513"></a>00513         <span class="keywordflow">if</span> (peds[i].type != Pedestal::GOOD) {
<a name="l00514"></a>00514             <span class="keywordflow">if</span> (peds[i].type == Pedestal::TUBEOFF) <span class="comment">// off</span>
<a name="l00515"></a>00515                 pl_fillcolorname_r( plotter, <span class="stringliteral">&quot;gray60&quot;</span>);
<a name="l00516"></a>00516             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (peds[i].type == Pedestal::STAR)
<a name="l00517"></a>00517                 pl_fillcolorname_r( plotter, <span class="stringliteral">&quot;gray90&quot;</span>);
<a name="l00518"></a>00518             <span class="keywordflow">else</span>
<a name="l00519"></a>00519                 pl_fillcolorname_r(plotter, <span class="stringliteral">&quot;white&quot;</span>);
<a name="l00520"></a>00520             pl_pencolorname_r(plotter, <span class="stringliteral">&quot;gray88&quot;</span>); 
<a name="l00521"></a>00521             qr = rad[i];
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523         
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         <span class="comment">// plot the value</span>
<a name="l00526"></a>00526         <span class="keywordflow">if</span> (value&gt;0)
<a name="l00527"></a>00527             pl_fellipse_r( plotter, xc[i],yc[i],qr,qr,0); 
<a name="l00528"></a>00528             
<a name="l00529"></a>00529         
<a name="l00530"></a>00530     }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="comment">// ===============================================================</span>
<a name="l00533"></a>00533     <span class="comment">// mark picture tubes</span>
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="keywordflow">if</span> (plottype == CAMERA_IMAGE ) {
<a name="l00536"></a>00536         <span class="keywordflow">for</span> (vector&lt;int&gt;::iterator iter=cleanpixels.begin();
<a name="l00537"></a>00537              iter!=cleanpixels.end(); iter++){
<a name="l00538"></a>00538             pl_pencolorname_r( plotter, <span class="stringliteral">&quot;darkblue&quot;</span>);
<a name="l00539"></a>00539             pl_fillcolorname_r( plotter, <span class="stringliteral">&quot;darkblue&quot;</span>);
<a name="l00540"></a>00540             <span class="keywordflow">if</span> (_pixelscale==-1) qr = fabs(rad[*iter]*image[*iter]/max);
<a name="l00541"></a>00541             <span class="keywordflow">else</span> qr = rad[*iter]*image[*iter]/_pixelscale; 
<a name="l00542"></a>00542             <span class="keywordflow">if</span> (qr &gt; rad[*iter]) qr = rad[*iter];
<a name="l00543"></a>00543             pl_fellipse_r( plotter, xc[*iter],yc[*iter],qr,qr,0);  
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         <span class="comment">// display the signal value if over a threshold</span>
<a name="l00547"></a>00547         
<a name="l00548"></a>00548         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a4f2750f42d18cc49f5aa703466a64268" title="Number of pixels in camera.">getNumPixels</a>(); i++) {
<a name="l00549"></a>00549             <span class="keywordflow">if</span>(image[i]&gt;max*0.75 &amp;&amp; rad[i]) {
<a name="l00550"></a>00550                 sprintf(text,<span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>) image[i]);
<a name="l00551"></a>00551                 <span class="keywordflow">if</span> (pl_flabelwidth_r( plotter,text ) &lt; rad[i]*1.2){
<a name="l00552"></a>00552                     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;white&quot;</span>); 
<a name="l00553"></a>00553                     pl_fmove_r( plotter,  xc[i],yc[i] );            
<a name="l00554"></a>00554                     pl_alabel_r(plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;c&#39;</span>, text );
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556             }
<a name="l00557"></a>00557         }
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="comment">// ===============================================================</span>
<a name="l00561"></a>00561     <span class="comment">// Display the tube numbers if requested</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySans&quot;</span>);
<a name="l00564"></a>00564     pl_ffontsize_r( plotter, _scalefactor*0.05 );
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (plottype == CAMERA_TUBENUMS) {
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         pl_pencolorname_r( plotter, <span class="stringliteral">&quot;black&quot;</span>); 
<a name="l00569"></a>00569         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;cam.<a class="code" href="classCamera.html#a4f2750f42d18cc49f5aa703466a64268" title="Number of pixels in camera.">getNumPixels</a>(); i++) {
<a name="l00570"></a>00570             sprintf(text,<span class="stringliteral">&quot;%d&quot;</span>, i);
<a name="l00571"></a>00571             pl_fmove_r( plotter,  xc[i],yc[i] );            
<a name="l00572"></a>00572             pl_alabel_r(plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;c&#39;</span>, text );
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574     }
<a name="l00575"></a>00575     
<a name="l00576"></a>00576     pl_restorestate_r( plotter );
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00583"></a>00583 <span class="keywordtype">void</span> 
<a name="l00584"></a>00584 PlotMaker::
<a name="l00585"></a><a class="code" href="classPlotMaker.html#acb86e21bc5d6326aac2d32d074c6dc8d">00585</a> plot( vector&lt;double&gt; &amp;xpoints, vector&lt;double&gt; &amp;ypoints ) {
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (xpoints.size() != ypoints.size()){
<a name="l00588"></a>00588         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html" title="Thrown for warnings and recoverable errors.">MildAnalysisException</a>( <span class="stringliteral">&quot;Couldn&#39;t plot x and y &quot;</span>
<a name="l00589"></a>00589                                      <span class="stringliteral">&quot;vectors with different sizes&quot;</span>);
<a name="l00590"></a>00590     }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (xpoints.size() ==0 || ypoints.size()==0){
<a name="l00593"></a>00593         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html" title="Thrown for warnings and recoverable errors.">MildAnalysisException</a>( <span class="stringliteral">&quot;Couldn&#39;t plot curve with no points &quot;</span>);
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     pl_savestate_r( plotter );
<a name="l00597"></a>00597     pl_flinewidth_r( plotter, 0.009 );
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     setLineMod();
<a name="l00600"></a>00600     
<a name="l00601"></a>00601     pl_fmove_r( plotter, xpoints[0], ypoints[0] );
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt; (int)xpoints.size(); i++) {
<a name="l00604"></a>00604         
<a name="l00605"></a>00605         pl_fcont_r( plotter, xpoints[i], ypoints[i] );
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     pl_endpath_r( plotter );
<a name="l00610"></a>00610     pl_restorestate_r( plotter );
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 
<a name="l00618"></a>00618 <span class="keywordtype">void</span> 
<a name="l00619"></a>00619 PlotMaker::
<a name="l00620"></a><a class="code" href="classPlotMaker.html#a0439c4f4f8961a93286f6daa6a9d29f3">00620</a> plot( <span class="keywordtype">string</span> text, <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y ){
<a name="l00621"></a>00621     
<a name="l00622"></a>00622     pl_savestate_r( plotter );
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00625"></a>00625     pl_ffontsize_r( plotter, _state.top().labelsize );
<a name="l00626"></a>00626     pl_ftextangle_r( plotter, _state.top().labelangle );
<a name="l00627"></a>00627     pl_pencolorname_r( plotter,_state.top().labelcolor.c_str() );
<a name="l00628"></a>00628     pl_fmove_r( plotter, x,y );
<a name="l00629"></a>00629     pl_alabel_r( plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;c&#39;</span>, text.c_str() );
<a name="l00630"></a>00630     pl_restorestate_r( plotter );
<a name="l00631"></a>00631 
<a name="l00632"></a>00632 }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 
<a name="l00638"></a>00638 <span class="keywordtype">void</span>
<a name="l00639"></a>00639 PlotMaker::
<a name="l00640"></a><a class="code" href="classPlotMaker.html#a43c25aca0a946c325994df24e38700ae">00640</a> plot( <a class="code" href="classTelescopeArray.html" title="Stores information for an array of telescopes, including Camera objects.">TelescopeArray</a> &amp;array ) {
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     <span class="keywordtype">double</span> x,y,r;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     pl_savestate_r( plotter );
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     pl_pencolorname_r( plotter,<span class="stringliteral">&quot;black&quot;</span> );
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;array.getNumTelescopes(); i++){
<a name="l00649"></a>00649         r = 0.5*(array.getCamera(i)-&gt;getMaxX() 
<a name="l00650"></a>00650                  - array.getCamera(i)-&gt;getMinX());
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         x = array.getLocationX(i);
<a name="l00653"></a>00653         y = array.getLocationY(i);
<a name="l00654"></a>00654         
<a name="l00655"></a>00655         pl_fellipse_r( plotter, x,y, r,r, 0 );
<a name="l00656"></a>00656         
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     pl_restorestate_r( plotter );
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 <span class="keywordtype">void</span>
<a name="l00665"></a>00665 PlotMaker::
<a name="l00666"></a>00666 pushState() {
<a name="l00667"></a>00667     pl_savestate_r( plotter );
<a name="l00668"></a>00668     _state.push( _state.top() );
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 <span class="keywordtype">void</span>
<a name="l00672"></a>00672 PlotMaker::
<a name="l00673"></a>00673 popState() {
<a name="l00674"></a>00674     pl_restorestate_r( plotter );
<a name="l00675"></a>00675     _state.pop();
<a name="l00676"></a>00676 };
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 <span class="keywordtype">void</span> 
<a name="l00679"></a>00679 PlotMaker::
<a name="l00680"></a>00680 rotate( <span class="keywordtype">double</span> theta ) {
<a name="l00681"></a>00681 
<a name="l00682"></a>00682     pl_frotate_r( plotter, theta );
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 <span class="keywordtype">void</span> 
<a name="l00688"></a>00688 PlotMaker::
<a name="l00689"></a>00689 plot( <a class="code" href="structHillasParameterization.html" title="Parameterization of an image, produced by the ImageAnalyzer object.">HillasParameterization</a> &amp;p ) {
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="keyword">const</span> <span class="keywordtype">double</span> step = 0.11;
<a name="l00692"></a>00692     <span class="keywordtype">char</span> text[128];
<a name="l00693"></a>00693 
<a name="l00694"></a>00694     pl_savestate_r( plotter );
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00697"></a>00697     pl_ffontsize_r(plotter, 0.07);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699     <span class="comment">// draw the centeroid</span>
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;red&quot;</span>);
<a name="l00702"></a>00702     pl_fillcolorname_r( plotter,<span class="stringliteral">&quot;red&quot;</span>); 
<a name="l00703"></a>00703     pl_fmarker_r(  plotter,p.<a class="code" href="structHillasParameterization.html#ae9b74033dd0e0671e59656a100358d5a" title="Center position of shower.">centroid</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structHillasParameterization.html#ae9b74033dd0e0671e59656a100358d5a" title="Center position of shower.">centroid</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, 9,0.1);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="comment">// draw the points or origin</span>
<a name="l00706"></a>00706 
<a name="l00707"></a>00707     pl_pencolorname_r(  plotter,<span class="stringliteral">&quot;DarkGreen&quot;</span>);
<a name="l00708"></a>00708     pl_fmarker_r(plotter,p.<a class="code" href="structHillasParameterization.html#a32d9137a17d9b447695f50320697e9be" title="First point of origin (x,y)">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structHillasParameterization.html#a32d9137a17d9b447695f50320697e9be" title="First point of origin (x,y)">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, 10,0.4);
<a name="l00709"></a>00709     pl_fmarker_r(plotter,p.<a class="code" href="structHillasParameterization.html#a75b3e07788abe724e458ed14aa1339c9" title="second point of origin (x,y)">point_of_origin_b</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structHillasParameterization.html#a75b3e07788abe724e458ed14aa1339c9" title="second point of origin (x,y)">point_of_origin_b</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, 10,0.3);
<a name="l00710"></a>00710     
<a name="l00711"></a>00711     <span class="comment">// draw the hillas ellipse</span>
<a name="l00712"></a>00712     pl_pencolorname_r( plotter,<span class="stringliteral">&quot;red&quot;</span>);
<a name="l00713"></a>00713     pl_flinewidth_r( plotter,0.02); <span class="comment">// line thickness in user coordinates </span>
<a name="l00714"></a>00714     pl_filltype_r( plotter,0);  
<a name="l00715"></a>00715     pl_pencolorname_r( plotter,<span class="stringliteral">&quot;red&quot;</span>); 
<a name="l00716"></a>00716     pl_fellipse_r( plotter,p.<a class="code" href="structHillasParameterization.html#ae9b74033dd0e0671e59656a100358d5a" title="Center position of shower.">centroid</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structHillasParameterization.html#ae9b74033dd0e0671e59656a100358d5a" title="Center position of shower.">centroid</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, 
<a name="l00717"></a>00717                    p.<a class="code" href="structHillasParameterization.html#ad2aa423ddc75ba1e108fa31878ed756a" title="Length of ellipse.">length</a>, 
<a name="l00718"></a>00718                    p.<a class="code" href="structHillasParameterization.html#aadb8f3295cbf2b2e0a60c44ede3de8b2" title="width of ellipse">width</a>, (p.<a class="code" href="structHillasParameterization.html#ad01c2f44c100dbc06ca180f93bcfae80" title="Angle betw major axis and x-axis (-PI..PI)">psi</a> * 180.0/M_PI) );
<a name="l00719"></a>00719     
<a name="l00720"></a>00720     <span class="comment">// draw the labels</span>
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     pl_fmove_r(  plotter,_minx+0.1,_maxy-step*1 );
<a name="l00723"></a>00723     sprintf(text, <span class="stringliteral">&quot;max1,2,3: %5.2f %5.2f %5.2f&quot;</span>, p.<a class="code" href="structHillasParameterization.html#a7d8e7d294ee5e6dc185257c9e1adb994" title="The three largest adc values.">max</a>[0], p.<a class="code" href="structHillasParameterization.html#a7d8e7d294ee5e6dc185257c9e1adb994" title="The three largest adc values.">max</a>[1], p.<a class="code" href="structHillasParameterization.html#a7d8e7d294ee5e6dc185257c9e1adb994" title="The three largest adc values.">max</a>[2]);
<a name="l00724"></a>00724     pl_label_r( plotter, text );
<a name="l00725"></a>00725 
<a name="l00726"></a>00726     pl_fmove_r( plotter, _minx+0.1,_maxy-step*2 );
<a name="l00727"></a>00727     sprintf(text, <span class="stringliteral">&quot;alpha: %3.3g&quot;</span>, p.<a class="code" href="structHillasParameterization.html#a1e908584f4dc7d52c573608b996c86cc" title="Alpha angle (-Pi/2..Pi/2)">alpha</a> *180.0/M_PI);
<a name="l00728"></a>00728     pl_label_r( plotter, text );
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     pl_fmove_r( plotter, _minx+0.1,_maxy-step*3 );
<a name="l00731"></a>00731     sprintf(text, <span class="stringliteral">&quot;miss: %3.3g&quot;</span>, p.<a class="code" href="structHillasParameterization.html#abe4f9cf30a5aaad841297471501889a9" title="miss parameter">miss</a>);
<a name="l00732"></a>00732     pl_label_r( plotter, text );
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     pl_fmove_r( plotter, _minx+0.1,_maxy-step*4 );
<a name="l00735"></a>00735     sprintf(text, <span class="stringliteral">&quot;dist: %3.3g&quot;</span>, p.<a class="code" href="structHillasParameterization.html#a3b247cc3ffeeea0972a94f2f6575a5a2" title="distance to centroid">distance</a>);
<a name="l00736"></a>00736     pl_label_r( plotter, text );
<a name="l00737"></a>00737 
<a name="l00738"></a>00738     pl_fmove_r( plotter, _minx+0.1,_maxy-step*5 );
<a name="l00739"></a>00739     sprintf(text, <span class="stringliteral">&quot;length: %3.3g&quot;</span>, p.<a class="code" href="structHillasParameterization.html#ad2aa423ddc75ba1e108fa31878ed756a" title="Length of ellipse.">length</a>);
<a name="l00740"></a>00740     pl_label_r( plotter, text );
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     pl_fmove_r( plotter, _minx+0.1,_maxy-step*6 );
<a name="l00743"></a>00743     sprintf(text, <span class="stringliteral">&quot;width: %3.3g&quot;</span>, p.<a class="code" href="structHillasParameterization.html#aadb8f3295cbf2b2e0a60c44ede3de8b2" title="width of ellipse">width</a>);
<a name="l00744"></a>00744     pl_label_r( plotter, text );
<a name="l00745"></a>00745 
<a name="l00746"></a>00746     pl_fmove_r( plotter, _minx+0.1,_maxy-step*7 );
<a name="l00747"></a>00747     sprintf(text, <span class="stringliteral">&quot;size: %.2f&quot;</span>, p.<a class="code" href="structHillasParameterization.html#abec8385793292018263164ea18601219" title="total signal">size</a>);
<a name="l00748"></a>00748     pl_label_r( plotter, text );
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     pl_fmove_r( plotter, _minx+0.1,_maxy-step*8 );
<a name="l00751"></a>00751     sprintf(text, <span class="stringliteral">&quot;psi: %3.3g deg&quot;</span>, p.<a class="code" href="structHillasParameterization.html#ad01c2f44c100dbc06ca180f93bcfae80" title="Angle betw major axis and x-axis (-PI..PI)">psi</a>*180.0/M_PI);
<a name="l00752"></a>00752     pl_label_r( plotter, text );
<a name="l00753"></a>00753 
<a name="l00754"></a>00754     pl_fmove_r( plotter, _minx+0.1,_maxy-step*9 );
<a name="l00755"></a>00755     sprintf(text, <span class="stringliteral">&quot;asym: %3.3g&quot;</span>, p.<a class="code" href="structHillasParameterization.html#aefb1906b72858ad355eac40bfc0f313b" title="measure of shower skew">asymmetry</a>);
<a name="l00756"></a>00756     pl_label_r( plotter, text );
<a name="l00757"></a>00757 
<a name="l00758"></a>00758     <span class="keywordflow">if</span> (p.<a class="code" href="structImageParameterization.html#a413610cc7481fd731c8b6a0e30d741a0" title="was this event properly parameterized?">invalid</a> != 0){
<a name="l00759"></a>00759         pl_fmove_r( plotter, _minx+0.1,_maxy-step*10 );
<a name="l00760"></a>00760         sprintf(text, <span class="stringliteral">&quot;INVALID: %d &quot;</span>,(<span class="keywordtype">int</span>) p.<a class="code" href="structImageParameterization.html#a413610cc7481fd731c8b6a0e30d741a0" title="was this event properly parameterized?">invalid</a>);
<a name="l00761"></a>00761         pl_label_r( plotter, text );
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     pl_ffontsize_r( plotter,0.09);
<a name="l00765"></a>00765     pl_pencolorname_r(  plotter,<span class="stringliteral">&quot;darkgreen&quot;</span> );
<a name="l00766"></a>00766     pl_fmove_r( plotter, _maxx-0.1, _maxy-step );
<a name="l00767"></a>00767     sprintf(text,<span class="stringliteral">&quot;%d&quot;</span>, p.<a class="code" href="structImageParameterization.html#a3524379a51b511ce132fb97d66e6028b" title="Event number for debugging.">event_number</a>);
<a name="l00768"></a>00768     pl_alabel_r(  plotter,<span class="charliteral">&#39;r&#39;</span>,<span class="charliteral">&#39;c&#39;</span>,text);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     pl_pencolorname_r(  plotter,<span class="stringliteral">&quot;DarkKhaki&quot;</span> );
<a name="l00771"></a>00771     pl_fmove_r( plotter, _maxx-0.1, _maxy-2*step );
<a name="l00772"></a>00772     sprintf(text,<span class="stringliteral">&quot;T%2d&quot;</span>, p.<a class="code" href="structImageParameterization.html#a7190a3fc893a52c1f544d34b09c0368f" title="telescope id number">telescope_id</a>);
<a name="l00773"></a>00773     pl_alabel_r(  plotter,<span class="charliteral">&#39;r&#39;</span>,<span class="charliteral">&#39;c&#39;</span>,text);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775     <span class="comment">// plot center marker</span>
<a name="l00776"></a>00776     pl_flinewidth_r( plotter,0.01); <span class="comment">// line thickness in user coordinates </span>
<a name="l00777"></a>00777     pl_fmarker_r(  plotter,0.0, 0.0,9,0.2);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     pl_restorestate_r( plotter );    
<a name="l00780"></a>00780 
<a name="l00781"></a>00781 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="keywordtype">void</span> 
<a name="l00784"></a>00784 PlotMaker::
<a name="l00785"></a>00785 plot( <a class="code" href="structMuonParameterization.html" title="Describes the muon-like characteristics of an image.">MuonParameterization</a> &amp;p ) {
<a name="l00786"></a>00786 
<a name="l00787"></a>00787     <span class="keyword">const</span> <span class="keywordtype">double</span> step = 0.11;
<a name="l00788"></a>00788     <span class="keywordtype">char</span> text[128];
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     pl_savestate_r( plotter );
<a name="l00791"></a>00791 
<a name="l00792"></a>00792     <span class="comment">// draw the other ring centers</span>
<a name="l00793"></a>00793     
<a name="l00794"></a>00794     pl_pencolorname_r( plotter,<span class="stringliteral">&quot;goldenrod1&quot;</span>);
<a name="l00795"></a>00795     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;p.<a class="code" href="structMuonParameterization.html#a7101e63412d2ef8fd2ef81891f8433b2" title="number of ring positions">nplotpoints</a>; i++) {
<a name="l00796"></a>00796         pl_fmarker_r(  plotter,p.<a class="code" href="structMuonParameterization.html#a90ef1e6a695a8470b7192acd0ea43674" title="Array of ring center positions.">plot</a>[i].<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structMuonParameterization.html#a90ef1e6a695a8470b7192acd0ea43674" title="Array of ring center positions.">plot</a>[i].<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, 10, 0.08 );
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799     <span class="comment">// set color</span>
<a name="l00800"></a>00800 
<a name="l00801"></a>00801     pl_pencolorname_r(  plotter,<span class="stringliteral">&quot;orange&quot;</span>);
<a name="l00802"></a>00802     pl_fillcolorname_r(  plotter,<span class="stringliteral">&quot;orange&quot;</span>);     
<a name="l00803"></a>00803 
<a name="l00804"></a>00804     <span class="comment">// draw the muon center position</span>
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     pl_fmarker_r(  plotter,p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, 2, 0.4 );
<a name="l00807"></a>00807     
<a name="l00808"></a>00808     <span class="comment">// draw the ring itself</span>
<a name="l00809"></a>00809    
<a name="l00810"></a>00810     pl_linemod_r( plotter, <span class="stringliteral">&quot;shortdashed&quot;</span> );
<a name="l00811"></a>00811     pl_filltype_r( plotter,0);          <span class="comment">// don&#39;t fill</span>
<a name="l00812"></a>00812     pl_flinewidth_r( plotter,0.02);     <span class="comment">// line thickness in user coordinates </span>
<a name="l00813"></a>00813     pl_fcircle_r(  plotter,p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a> );
<a name="l00814"></a>00814 
<a name="l00815"></a>00815     <span class="comment">// draw the arc (philo to phihi) region:</span>
<a name="l00816"></a>00816 
<a name="l00817"></a>00817     <span class="keywordtype">double</span> x0 = p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a>*cos(p.<a class="code" href="structMuonParameterization.html#a4cb5fe9a4160ed1cc399fa650e04e8b4" title="starting angle of arc">philo</a>) + p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>;
<a name="l00818"></a>00818     <span class="keywordtype">double</span> y0 = p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a>*sin(p.<a class="code" href="structMuonParameterization.html#a4cb5fe9a4160ed1cc399fa650e04e8b4" title="starting angle of arc">philo</a>) + p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>;
<a name="l00819"></a>00819     <span class="keywordtype">double</span> x1 = p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a>*cos(p.<a class="code" href="structMuonParameterization.html#a58ab3dbbf899d2ecb0f5dff749e5e159" title="ending angle of arc">phihi</a>) + p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>;
<a name="l00820"></a>00820     <span class="keywordtype">double</span> y1 = p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a>*sin(p.<a class="code" href="structMuonParameterization.html#a58ab3dbbf899d2ecb0f5dff749e5e159" title="ending angle of arc">phihi</a>) + p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>;
<a name="l00821"></a>00821     <span class="keywordtype">double</span> xm = p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a>*cos(p.<a class="code" href="structMuonParameterization.html#a57d9f4eb8eec896b0bfd052900e6b64c" title="midpoint angle">phimid</a>) + p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>;
<a name="l00822"></a>00822     <span class="keywordtype">double</span> ym = p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a>*sin(p.<a class="code" href="structMuonParameterization.html#a57d9f4eb8eec896b0bfd052900e6b64c" title="midpoint angle">phimid</a>) + p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     pl_fline_r( plotter, p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, xm,ym );
<a name="l00825"></a>00825     pl_flinewidth_r( plotter,0.05 );    
<a name="l00826"></a>00826     pl_linemod_r( plotter, <span class="stringliteral">&quot;solid&quot;</span> );
<a name="l00827"></a>00827     pl_farc_r( plotter, p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>, p.<a class="code" href="structMuonParameterization.html#a777390dd328e115a3acfdccde4cec092" title="Average position.">ringcenter</a>.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>, x0,y0,x1,y1 ); 
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     pl_pencolorname_r( plotter,<span class="stringliteral">&quot;black&quot;</span>);
<a name="l00830"></a>00830     pl_fmarker_r( plotter, p.xcs, p.ycs, 6, 0.2 );
<a name="l00831"></a>00831     pl_pencolorname_r( plotter,<span class="stringliteral">&quot;orange&quot;</span>);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="comment">// display the relevant parameters</span>
<a name="l00834"></a>00834 
<a name="l00835"></a>00835     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00836"></a>00836     pl_ffontsize_r(plotter, 0.07);    
<a name="l00837"></a>00837     
<a name="l00838"></a>00838     pl_fmove_r( plotter, _minx+0.1, _miny+step*1 );
<a name="l00839"></a>00839     sprintf( text, <span class="stringliteral">&quot;S/Arclen: %.2f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a5755c497600535efe649802773ff2919" title="Signal over arclength.">soal</a> );
<a name="l00840"></a>00840     pl_label_r( plotter, text );
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     pl_fmove_r( plotter, _minx+0.1, _miny+step*2 );
<a name="l00843"></a>00843     sprintf( text, <span class="stringliteral">&quot;Radius: %f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a9288b7b7437754b412d98df17ea096f3" title="Average radius.">radius</a> );
<a name="l00844"></a>00844     pl_label_r( plotter, text );
<a name="l00845"></a>00845 
<a name="l00846"></a>00846     pl_fmove_r( plotter, _minx+0.1, _miny+step*3 );
<a name="l00847"></a>00847     sprintf( text, <span class="stringliteral">&quot;ArcStrength: %f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a44a8fe62958828b38511317f19aeeb8c" title="fract of centers in peak bin">arcstrength</a> );
<a name="l00848"></a>00848     pl_label_r( plotter, text );
<a name="l00849"></a>00849 
<a name="l00850"></a>00850     pl_fmove_r( plotter, _minx+0.1, _miny+step*4 );
<a name="l00851"></a>00851     sprintf( text, <span class="stringliteral">&quot;RingFrac: %.2f %%&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a23be272cf46718ffa72f9714986f37ae" title="fraction of ring falling on camera">ringfrac</a> * 100 );
<a name="l00852"></a>00852     pl_label_r( plotter, text );
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     pl_fmove_r( plotter, _minx+0.1, _miny+step*5 );
<a name="l00855"></a>00855     sprintf( text, <span class="stringliteral">&quot;MuSkew: %f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a0f5e861cb63b098fb9ceb5dcedbc3f1f" title="centroid-&gt;center length over ring radius">muskew</a> );
<a name="l00856"></a>00856     pl_label_r( plotter, text );
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     pl_fmove_r( plotter, _minx+0.1, _miny+step*6 );
<a name="l00859"></a>00859     sprintf( text, <span class="stringliteral">&quot;MuGain: %f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#aca865edfe191cfad91502c0cc71d9eb8" title="Light in annulus corrected for spillover.">mugain</a> );
<a name="l00860"></a>00860     pl_label_r( plotter, text );
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     pl_fmove_r( plotter, _minx+0.1, _miny+step*7 );
<a name="l00863"></a>00863     sprintf( text, <span class="stringliteral">&quot;gain: %f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#af18698c7eb37805625db4d32be9622e7" title="Total picture light per all pixels in arc.">gain</a> );
<a name="l00864"></a>00864     pl_label_r( plotter, text );
<a name="l00865"></a>00865 
<a name="l00866"></a>00866     pl_fmove_r( plotter, _minx+0.1, _miny+step*8 );
<a name="l00867"></a>00867     sprintf( text, <span class="stringliteral">&quot;muonness: %.2f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a2ebceb539977f87168c1f88efbb2dec6" title="measure of muon-like characteristics">muonness</a> );
<a name="l00868"></a>00868     pl_label_r( plotter, text );
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     pl_fmove_r( plotter, _minx+0.1, _miny+step*9 );
<a name="l00871"></a>00871     sprintf( text, <span class="stringliteral">&quot;arclength: %.2f&quot;</span>, p.<a class="code" href="structMuonParameterization.html#a6d7831ff9cb8f6195ffdd74aefd03c79" title="Length of the muon arc.">arclen</a> );
<a name="l00872"></a>00872     pl_label_r( plotter, text );
<a name="l00873"></a>00873 
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     pl_restorestate_r( plotter );
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 
<a name="l00890"></a>00890 <span class="keywordtype">void</span>
<a name="l00891"></a><a class="code" href="classPlotMaker.html#a26f4f8bfb6ed2483617ac8655ff0d05d">00891</a> <a class="code" href="classPlotMaker.html#a26f4f8bfb6ed2483617ac8655ff0d05d" title="Returns the rgb color for the specified grey value (in range 0..1)">PlotMaker::getMappedColor</a>( <span class="keywordtype">double</span> value, <span class="keywordtype">int</span> &amp;red, <span class="keywordtype">int</span> &amp;green, <span class="keywordtype">int</span> &amp;blue ) {
<a name="l00892"></a>00892 
<a name="l00893"></a>00893   
<a name="l00894"></a>00894     <span class="keywordflow">switch</span> ( _state.top().colormap) {
<a name="l00895"></a>00895         
<a name="l00896"></a>00896     <span class="keywordflow">case</span> COLORMAP_BLUES:
<a name="l00897"></a>00897         red = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( (value*value)*65535.0);
<a name="l00898"></a>00898         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(value*65535.0);
<a name="l00899"></a>00899         blue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(sin(M_PI_2*value)*65535.0);
<a name="l00900"></a>00900         <span class="keywordflow">break</span>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902     <span class="keywordflow">case</span> COLORMAP_YELLOWGREEN:
<a name="l00903"></a>00903         red = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( value*(pow(sin(M_PI_2*value),2) + 
<a name="l00904"></a>00904                                        pow(cos(3*M_PI_2*value),2) )*65535.0);
<a name="l00905"></a>00905         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(sin(M_PI_2*value)* 65535.0);
<a name="l00906"></a>00906         blue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( (pow(sin(3*M_PI_2*value),2)/2.0 + value/2.0)
<a name="l00907"></a>00907                                  *65535.0);     
<a name="l00908"></a>00908         <span class="keywordflow">break</span>;
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="keywordflow">case</span> COLORMAP_REDBLUE:
<a name="l00911"></a>00911         red   = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((sqrt(value))*65535.0);
<a name="l00912"></a>00912         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((pow(value,3))*65535.0);
<a name="l00913"></a>00913         blue  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((sin(2*M_PI*value))*65535.0);
<a name="l00914"></a>00914         <span class="keywordflow">break</span>;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916     <span class="keywordflow">case</span> COLORMAP_INVERSEGREY:
<a name="l00917"></a>00917         red   = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((1.0-value)*65535.0);
<a name="l00918"></a>00918         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((1.0-value)*65535.0);
<a name="l00919"></a>00919         blue  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((1.0-value)*65535.0);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <span class="keywordflow">break</span>;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordflow">case</span> COLORMAP_GREY:
<a name="l00924"></a>00924         red   = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((value)*65535.0);
<a name="l00925"></a>00925         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((value)*65535.0);
<a name="l00926"></a>00926         blue  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((value)*65535.0);
<a name="l00927"></a>00927         <span class="keywordflow">break</span>;
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <span class="keywordflow">case</span> COLORMAP_RAINBOW:
<a name="l00930"></a>00930         red   = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((abs(2*value-0.5))*65535.0);
<a name="l00931"></a>00931         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((sin(M_PI*value))*65535.0);
<a name="l00932"></a>00932         blue  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((cos(M_PI/2.0*value))*65535.0);
<a name="l00933"></a>00933         <span class="keywordflow">break</span>;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <span class="keywordflow">case</span> COLORMAP_HOT:
<a name="l00936"></a>00936         red   = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((3*value)*65535.0);
<a name="l00937"></a>00937         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((3*value-1)*65535.0);
<a name="l00938"></a>00938         blue  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((3*value-2)*65535.0);
<a name="l00939"></a>00939         <span class="keywordflow">break</span>;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="keywordflow">case</span> COLORMAP_PRINTABLE:
<a name="l00942"></a>00942         red   = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((value/0.32-0.78125)*65535.0);
<a name="l00943"></a>00943         green = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((2*value-0.84)*65535.0);
<a name="l00944"></a>00944         blue  = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>((4*value)*65535.0);
<a name="l00945"></a>00945         <span class="keywordflow">break</span>;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     <span class="keywordflow">default</span>:
<a name="l00948"></a>00948         <span class="keywordflow">throw</span> <a class="code" href="classMildAnalysisException.html" title="Thrown for warnings and recoverable errors.">MildAnalysisException</a>(<span class="stringliteral">&quot;unknown color map value&quot;</span>);
<a name="l00949"></a>00949 
<a name="l00950"></a>00950     };
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="keywordflow">if</span> (red &gt; 65535)   red   = 65535;
<a name="l00954"></a>00954     <span class="keywordflow">if</span> (green &gt; 65535) green = 65535;
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (blue &gt; 65535)  blue  = 65535;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <span class="keywordflow">if</span> (red &lt; 0)    red   = 0;
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (green &lt; 0 ) green = 0;
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (blue &lt; 0 )  blue  = 0;
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 }
<a name="l00964"></a>00964 
<a name="l00965"></a>00965 
<a name="l00966"></a>00966 <span class="keywordtype">void</span> 
<a name="l00967"></a>00967 PlotMaker::
<a name="l00968"></a>00968 plot( <a class="code" href="classStar.html" title="representation of a star">Star</a> &amp;star, <span class="keywordtype">int</span> symbol ) {
<a name="l00969"></a>00969     
<a name="l00970"></a>00970     <span class="keywordtype">double</span> size = (_maxmagnitude - star.<a class="code" href="classStar.html#a2496dd6541fffff40255753b5981427e" title="magnitude of the star">magnitude</a>)/40.0;
<a name="l00971"></a>00971     <span class="keywordflow">if</span> (size&lt;=0) <span class="keywordflow">return</span>;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     pl_savestate_r( plotter );
<a name="l00974"></a>00974     pl_fontname_r( plotter, <span class="stringliteral">&quot;HersheySerif&quot;</span>);
<a name="l00975"></a>00975     pl_ffontsize_r( plotter, 0.06 );    
<a name="l00976"></a>00976     pl_pencolorname_r( plotter, <span class="stringliteral">&quot;yellow&quot;</span> );
<a name="l00977"></a>00977     pl_fmarker_r(plotter,star.tx,star.<a class="code" href="classStar.html#a5e1dedf4e3dc836ef991ce1fb4989041" title="tangential cartesian coordinates">ty</a>, symbol ,size );
<a name="l00978"></a>00978     <span class="keywordflow">if</span> ( star.<a class="code" href="classStar.html#a2bbf34d3244a49d09bdca8ef13c475d8" title="Index of star catalog.">catalog_id</a> == 0 ) {
<a name="l00979"></a>00979         pl_fmove_r( plotter, star.tx, star.<a class="code" href="classStar.html#a5e1dedf4e3dc836ef991ce1fb4989041" title="tangential cartesian coordinates">ty</a>-size );
<a name="l00980"></a>00980         pl_alabel_r( plotter, <span class="charliteral">&#39;c&#39;</span>,<span class="charliteral">&#39;t&#39;</span>,star.<a class="code" href="classStar.html#ad9ae4846172086e057c241d6a0f21636" title="Name of star.">name</a>.c_str() );
<a name="l00981"></a>00981     }
<a name="l00982"></a>00982     pl_restorestate_r( plotter );
<a name="l00983"></a>00983     
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 
<a name="l00990"></a>00990 <span class="keywordtype">void</span> 
<a name="l00991"></a>00991 <a class="code" href="classPlotMaker.html#adb2a812fbb301328eb209d1896f7b8fb" title="Plot contours for the given Image2D.">PlotMaker::</a>
<a name="l00992"></a><a class="code" href="classPlotMaker.html#adb2a812fbb301328eb209d1896f7b8fb">00992</a> <a class="code" href="classPlotMaker.html#adb2a812fbb301328eb209d1896f7b8fb" title="Plot contours for the given Image2D.">contourPlot</a>( <a class="code" href="classImage2D.html" title="Representation of a 2-D raster image (for 2D analysis)">Image2D</a> &amp;im2d, <span class="keywordtype">double</span> zmin, <span class="keywordtype">double</span> zmax, <span class="keywordtype">double</span> dz ) {
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="keywordtype">int</span> nlevels = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( (zmax-zmin)/dz );
<a name="l00995"></a>00995     <span class="keywordtype">int</span> nx = im2d.getXDim();
<a name="l00996"></a>00996     <span class="keywordtype">int</span> ny = im2d.getYDim();
<a name="l00997"></a>00997     <span class="keywordtype">double</span> x00,x01,x10,x11;
<a name="l00998"></a>00998     <span class="keywordtype">double</span> y00,y01,y10,y11;
<a name="l00999"></a>00999     <span class="keywordtype">double</span> z00,z01,z10,z11;
<a name="l01000"></a>01000     <span class="keywordtype">double</span> zc;  
<a name="l01001"></a>01001     <span class="keywordtype">int</span> k, red,green,blue;
<a name="l01002"></a>01002     <span class="keywordtype">bool</span> iny, inx;
<a name="l01003"></a>01003     <span class="keywordtype">double</span> x[5], y[5];
<a name="l01004"></a>01004     <span class="keywordtype">double</span> xin, yin;            <span class="comment">// x, y intercepts</span>
<a name="l01005"></a>01005 
<a name="l01006"></a>01006     <a class="code" href="structContourSegment.html">ContourSegment</a> segment;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (fabs(zmin-zmax) &lt; 1e-10) {
<a name="l01009"></a>01009         cout &lt;&lt; <span class="stringliteral">&quot;contourPlot: too small a contour range! (&quot;</span> 
<a name="l01010"></a>01010              &lt;&lt; zmin &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>&lt;&lt;zmax&lt;&lt;<span class="stringliteral">&quot;)&quot;</span>&lt;&lt;endl;
<a name="l01011"></a>01011         <span class="keywordflow">return</span>;
<a name="l01012"></a>01012      }
<a name="l01013"></a>01013 
<a name="l01014"></a>01014     <span class="comment">// Set up the colors for plotting </span>
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     pl_savestate_r( plotter );
<a name="l01017"></a>01017     <span class="comment">//    pl_flinewidth_r( plotter, 0.009 );</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019     setLineMod();
<a name="l01020"></a>01020         
<a name="l01021"></a>01021     <span class="comment">// First we need to figure out where all the contours go, then</span>
<a name="l01022"></a>01022     <span class="comment">// we&#39;ll plot them</span>
<a name="l01023"></a>01023     
<a name="l01024"></a>01024     <span class="comment">// For each grid box</span>
<a name="l01025"></a>01025     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> yi=0; yi&lt;nx-1; yi++ ) {
<a name="l01026"></a>01026         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xi=0; xi&lt;ny-1; xi++ ) {
<a name="l01027"></a>01027             
<a name="l01028"></a>01028             <span class="comment">// get the coordinate centers of the current block of four</span>
<a name="l01029"></a>01029             <span class="comment">// pixels (just to make them easier to type)</span>
<a name="l01030"></a>01030 
<a name="l01031"></a>01031             x00 = im2d.getXCoord( xi   );
<a name="l01032"></a>01032             x10 = im2d.getXCoord( xi+1 );
<a name="l01033"></a>01033             x01 = im2d.getXCoord( xi   );
<a name="l01034"></a>01034             x11 = im2d.getXCoord( xi+1 );
<a name="l01035"></a>01035 
<a name="l01036"></a>01036             y00 = im2d.getYCoord( yi );
<a name="l01037"></a>01037             y10 = im2d.getYCoord( yi );
<a name="l01038"></a>01038             y01 = im2d.getYCoord( yi+1 );
<a name="l01039"></a>01039             y11 = im2d.getYCoord( yi+1 );
<a name="l01040"></a>01040 
<a name="l01041"></a>01041             z00 = im2d.getPixel( xi   , yi );
<a name="l01042"></a>01042             z10 = im2d.getPixel( xi+1 , yi );
<a name="l01043"></a>01043             z01 = im2d.getPixel( xi   , yi+1 );
<a name="l01044"></a>01044             z11 = im2d.getPixel( xi+1 , yi+1 );
<a name="l01045"></a>01045             
<a name="l01046"></a>01046 
<a name="l01047"></a>01047             <span class="comment">// For each contour j:</span>
<a name="l01048"></a>01048             
<a name="l01049"></a>01049             zc = zmin;
<a name="l01050"></a>01050             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;nlevels; j++) {
<a name="l01051"></a>01051                 
<a name="l01052"></a>01052                 k = 0;
<a name="l01053"></a>01053 
<a name="l01054"></a>01054                 <span class="comment">// Check if the contour passes through the 4 pixel block</span>
<a name="l01055"></a>01055 
<a name="l01056"></a>01056                 iny = ( ((z00&lt;=zc)&amp;&amp;(zc&lt;=z01))||((z00&gt;=zc)&amp;&amp;(zc&gt;=z01)) ) ;
<a name="l01057"></a>01057                 iny = iny ||( ((z10&lt;=zc)&amp;&amp;(zc&lt;=z11))||((z10&gt;=zc)&amp;&amp;(zc&gt;=z11)) );
<a name="l01058"></a>01058                 inx = ( ((z00&lt;=zc)&amp;&amp;(zc&lt;=z10))||((z00&gt;=zc)&amp;&amp;(zc&gt;=z10)) ) ;
<a name="l01059"></a>01059                 inx = inx ||( ((z01&lt;=zc)&amp;&amp;(zc&lt;=z11))||((z01&gt;=zc)&amp;&amp;(zc&gt;=z11)) );
<a name="l01060"></a>01060                 
<a name="l01061"></a>01061                 <span class="keywordflow">if</span> (inx || iny) {
<a name="l01062"></a>01062                     
<a name="l01063"></a>01063                     xin = xIntercept(z00,z01,z10,z11,zc,0.0);
<a name="l01064"></a>01064                     yin = yIntercept(z00,z01,z10,z11,zc,0.0);
<a name="l01065"></a>01065                     <span class="keywordflow">if</span> ( xin &gt; 0 ){
<a name="l01066"></a>01066                         x[k] = x00 + xin*(x10-x00);
<a name="l01067"></a>01067                         y[k] = y00 + xin*(y10-y00);
<a name="l01068"></a>01068                         k++;
<a name="l01069"></a>01069                     }
<a name="l01070"></a>01070                     <span class="keywordflow">if</span>( yin &gt; 0.00) {
<a name="l01071"></a>01071                         x[k] = x00+yin*(x01-x00) ;
<a name="l01072"></a>01072                         y[k] = y00+yin*(y01-y00) ;
<a name="l01073"></a>01073                         k++;
<a name="l01074"></a>01074                     }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076                     xin=xIntercept(z00,z01,z10,z11,zc,1.0);
<a name="l01077"></a>01077                     yin=yIntercept(z00,z01,z10,z11,zc,1.0);
<a name="l01078"></a>01078                     <span class="keywordflow">if</span> ( xin &gt; 0.00 ){
<a name="l01079"></a>01079                         x[k] = x01+xin*(x11-x01) ;
<a name="l01080"></a>01080                         y[k] = y01+xin*(y11-y01) ;
<a name="l01081"></a>01081                         k++;
<a name="l01082"></a>01082                     }
<a name="l01083"></a>01083                     <span class="keywordflow">if</span>( yin &gt; 0.00) {
<a name="l01084"></a>01084                         x[k] = x10+yin*(x11-x10) ;
<a name="l01085"></a>01085                         y[k] = y10+yin*(y11-y10) ;
<a name="l01086"></a>01086                         k++;
<a name="l01087"></a>01087                     }
<a name="l01088"></a>01088                     
<a name="l01089"></a>01089                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;k-1; i++ ) {
<a name="l01090"></a>01090                         
<a name="l01091"></a>01091                         <span class="comment">// contour segment is: x[i],y[i] - x[i+1],y[i+1]</span>
<a name="l01092"></a>01092 
<a name="l01093"></a>01093                         segment.start.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a> = x[i];
<a name="l01094"></a>01094                         segment.start.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a> = y[i];
<a name="l01095"></a>01095                         segment.end.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>   = x[i+1];
<a name="l01096"></a>01096                         segment.end.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>   = y[i+1];
<a name="l01097"></a>01097 
<a name="l01098"></a>01098                         <span class="comment">// plot it!</span>
<a name="l01099"></a>01099                         getMappedColor(((<span class="keywordtype">double</span>)j/(<span class="keywordtype">double</span>)nlevels), 
<a name="l01100"></a>01100                                        red,green,blue );
<a name="l01101"></a>01101                         <span class="keywordflow">if</span> ( _state.top().contourcolor == <span class="stringliteral">&quot;MAPPED&quot;</span>)
<a name="l01102"></a>01102                             pl_pencolor_r( plotter, red,green,blue  );
<a name="l01103"></a>01103 
<a name="l01104"></a>01104                         pl_fline_r( plotter, 
<a name="l01105"></a>01105                                     segment.start.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>,
<a name="l01106"></a>01106                                     segment.start.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a>,
<a name="l01107"></a>01107                                     segment.end.<a class="code" href="structCoordinate__t.html#a4e83334eabbe707ae5433ff65f60a475" title="X coordinate.">x</a>,
<a name="l01108"></a>01108                                     segment.end.<a class="code" href="structCoordinate__t.html#abbc494db10b22a87bede79c5b62be604" title="Y coordinate.">y</a> );    
<a name="l01109"></a>01109                     }
<a name="l01110"></a>01110                     
<a name="l01111"></a>01111                 }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113                 <span class="comment">// move to the next contour level</span>
<a name="l01114"></a>01114                 zc += dz; 
<a name="l01115"></a>01115 
<a name="l01116"></a>01116             }
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     <span class="comment">// Now, we know all the contours, so on to plotting...</span>
<a name="l01121"></a>01121     
<a name="l01122"></a>01122     pl_restorestate_r( plotter );
<a name="l01123"></a>01123     
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 
<a name="l01131"></a>01131 <span class="keywordtype">void</span> 
<a name="l01132"></a>01132 <a class="code" href="classPlotMaker.html#a874f1d3b611200fa9b4bccb66262587e" title="Plot an ellipse centered on x,y with radii r1 and r2 and angle theta.">PlotMaker::</a>
<a name="l01133"></a><a class="code" href="classPlotMaker.html#a874f1d3b611200fa9b4bccb66262587e">01133</a> <a class="code" href="classPlotMaker.html#a874f1d3b611200fa9b4bccb66262587e" title="Plot an ellipse centered on x,y with radii r1 and r2 and angle theta.">plotEllipse</a>( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> r1, <span class="keywordtype">double</span> r2,<span class="keywordtype">double</span> theta) {
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     pl_savestate_r( plotter );
<a name="l01136"></a>01136     pl_filltype_r( plotter, 0 );
<a name="l01137"></a>01137     pl_flinewidth_r( plotter, 0.009 );
<a name="l01138"></a>01138     setLineMod();
<a name="l01139"></a>01139     pl_fellipse_r( plotter, x,y, r1,r2, theta );
<a name="l01140"></a>01140     pl_restorestate_r( plotter );    
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 
<a name="l01148"></a>01148 <span class="keywordtype">void</span> 
<a name="l01149"></a>01149 <a class="code" href="classPlotMaker.html#ab0317d7d940dff6bee43356cbfebc627" title="Plot RA/DEC contours and labels.">PlotMaker::</a>
<a name="l01150"></a><a class="code" href="classPlotMaker.html#ab0317d7d940dff6bee43356cbfebc627">01150</a> <a class="code" href="classPlotMaker.html#ab0317d7d940dff6bee43356cbfebc627" title="Plot RA/DEC contours and labels.">plotRADecGrid</a>( <a class="code" href="classImage2D.html" title="Representation of a 2-D raster image (for 2D analysis)">Image2D</a> &amp;ragrid, <a class="code" href="classImage2D.html" title="Representation of a 2-D raster image (for 2D analysis)">Image2D</a> &amp;decgrid ) {
<a name="l01151"></a>01151     
<a name="l01152"></a>01152     <span class="comment">// get RA/DEC of center pixel:</span>
<a name="l01153"></a>01153     
<a name="l01154"></a>01154     <span class="keywordtype">int</span> xcenterpix = (ragrid.getXDim()/2);
<a name="l01155"></a>01155     <span class="keywordtype">int</span> ycenterpix = (ragrid.getYDim()/2);
<a name="l01156"></a>01156 
<a name="l01157"></a>01157     <span class="keywordtype">double</span> ra = ragrid.getPixel( xcenterpix, ycenterpix ) *M_PI/12.0;
<a name="l01158"></a>01158     <span class="keywordtype">double</span> dec = decgrid.getPixel( xcenterpix, ycenterpix )*M_PI/180.0;
<a name="l01159"></a>01159 
<a name="l01160"></a>01160 
<a name="l01161"></a>01161     <span class="comment">// get the nice contour values:</span>
<a name="l01162"></a>01162 
<a name="l01163"></a>01163     <span class="keywordtype">double</span> xcont[NCONTSTEPS];
<a name="l01164"></a>01164     <span class="keywordtype">double</span> ycont[NCONTSTEPS];
<a name="l01165"></a>01165     <span class="keywordtype">double</span> nice_dec[NCONTSTEPS];
<a name="l01166"></a>01166     <span class="keywordtype">double</span> nice_ra[NCONTSTEPS];
<a name="l01167"></a>01167     <span class="keywordtype">int</span>    drawx[NCONTSTEPS];
<a name="l01168"></a>01168     <span class="keywordtype">int</span>    drawy[NCONTSTEPS];
<a name="l01169"></a>01169     <span class="keywordtype">char</span>   ra_str[NCONTSTEPS][128];
<a name="l01170"></a>01170     <span class="keywordtype">char</span>   dec_str[NCONTSTEPS][128];
<a name="l01171"></a>01171 
<a name="l01172"></a>01172     niceRaDecContours( ra, dec, 
<a name="l01173"></a>01173                        xcont, ycont,
<a name="l01174"></a>01174                        nice_ra, nice_dec,
<a name="l01175"></a>01175                        drawx, drawy,
<a name="l01176"></a>01176                        ra_str, dec_str );
<a name="l01177"></a>01177 
<a name="l01178"></a>01178     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;NCONTSTEPS; i++) {
<a name="l01179"></a>01179 
<a name="l01180"></a>01180 
<a name="l01181"></a>01181         <span class="comment">// Plot the RA contours and labels</span>
<a name="l01182"></a>01182         
<a name="l01183"></a>01183         contourPlot( ragrid,    <span class="comment">// kind of a hack to plot just one contour</span>
<a name="l01184"></a>01184                      nice_ra[i]*12.0/M_PI, 
<a name="l01185"></a>01185                      nice_ra[i]*12.0/M_PI + 4.0, 3.9 );
<a name="l01186"></a>01186         
<a name="l01187"></a>01187         <span class="keywordflow">if</span> ( drawx[i] ){
<a name="l01188"></a>01188             plot( ra_str[i], xcont[i], _miny + _ticmarksize*2 );
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 
<a name="l01192"></a>01192         <span class="comment">// plot the dec contours and labels </span>
<a name="l01193"></a>01193 
<a name="l01194"></a>01194         contourPlot( decgrid, 
<a name="l01195"></a>01195                      nice_dec[i]*180.0/M_PI, 
<a name="l01196"></a>01196                      nice_dec[i]*180.0/M_PI + 4.0, 3.9 );
<a name="l01197"></a>01197 
<a name="l01198"></a>01198         <span class="keywordflow">if</span> ( drawy[i] ){
<a name="l01199"></a>01199             pushState();
<a name="l01200"></a>01200             _state.top().labelangle = 90.0;
<a name="l01201"></a>01201             plot( dec_str[i], _minx+_ticmarksize*2, ycont[i] );
<a name="l01202"></a>01202             popState();
<a name="l01203"></a>01203         }       
<a name="l01204"></a>01204         
<a name="l01205"></a>01205         
<a name="l01206"></a>01206     }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208 }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210 
<a name="l01214"></a>01214 <span class="keywordtype">void</span> 
<a name="l01215"></a>01215 PlotMaker::
<a name="l01216"></a>01216 setLineMod() {
<a name="l01217"></a>01217     
<a name="l01218"></a>01218     <span class="keywordflow">switch</span> (_state.top().contourlinestyle) {
<a name="l01219"></a>01219 
<a name="l01220"></a>01220     <span class="keywordflow">case</span> LINE_SOLID:
<a name="l01221"></a>01221         pl_linemod_r( plotter, <span class="stringliteral">&quot;solid&quot;</span> );
<a name="l01222"></a>01222         <span class="keywordflow">break</span>;
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     <span class="keywordflow">case</span> LINE_DOTTED:
<a name="l01225"></a>01225         pl_linemod_r( plotter, <span class="stringliteral">&quot;dotted&quot;</span> );
<a name="l01226"></a>01226         <span class="keywordflow">break</span>;  
<a name="l01227"></a>01227         
<a name="l01228"></a>01228     <span class="keywordflow">case</span>  LINE_DASHED:
<a name="l01229"></a>01229         pl_linemod_r( plotter, <span class="stringliteral">&quot;shortdashed&quot;</span> );
<a name="l01230"></a>01230         <span class="keywordflow">break</span>;
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     <span class="keywordflow">default</span>:
<a name="l01233"></a>01233         pl_linemod_r( plotter, <span class="stringliteral">&quot;solid&quot;</span> );
<a name="l01234"></a>01234         <span class="keywordflow">break</span>;
<a name="l01235"></a>01235     }
<a name="l01236"></a>01236 
<a name="l01237"></a>01237     <span class="keywordflow">if</span> ( _state.top().contourcolor != <span class="stringliteral">&quot;MAPPED&quot;</span> )
<a name="l01238"></a>01238         pl_pencolorname_r( plotter,_state.top().contourcolor.c_str() );
<a name="l01239"></a>01239     
<a name="l01240"></a>01240     pl_flinewidth_r( plotter,_state.top().contourwidth );
<a name="l01241"></a>01241 
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 <span class="keywordtype">void</span> 
<a name="l01245"></a>01245 PlotMaker::
<a name="l01246"></a>01246 plotMarker( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y ) {
<a name="l01247"></a>01247     
<a name="l01248"></a>01248     pl_savestate_r( plotter );    
<a name="l01249"></a>01249     pl_pencolorname_r( plotter,_state.top().markercolor.c_str() );
<a name="l01250"></a>01250     pl_fmarker_r( plotter, x,y,_state.top().markertype,_state.top().markersize );
<a name="l01251"></a>01251     pl_restorestate_r( plotter);
<a name="l01252"></a>01252 
<a name="l01253"></a>01253 }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255 
<a name="l01256"></a>01256 <span class="keywordtype">double</span>  
<a name="l01257"></a>01257 PlotMaker::
<a name="l01258"></a>01258 yIntercept(<span class="keywordtype">double</span> z00, <span class="keywordtype">double</span> z01, <span class="keywordtype">double</span> z10, <span class="keywordtype">double</span> z11, 
<a name="l01259"></a>01259            <span class="keywordtype">double</span> zc, <span class="keywordtype">double</span> xr) {
<a name="l01260"></a>01260     <span class="keywordtype">double</span>      yr ;
<a name="l01261"></a>01261     <span class="keywordtype">double</span>      t1,t2 ;
<a name="l01262"></a>01262     
<a name="l01263"></a>01263     t1 = zc-xr*(z10-z00)-z00 ;
<a name="l01264"></a>01264     t2 = xr*(z11-z01-z10+z00)+z01-z00 ;
<a name="l01265"></a>01265     
<a name="l01266"></a>01266     yr=(double)t1/(<span class="keywordtype">double</span>)t2 ;
<a name="l01267"></a>01267     <span class="keywordflow">if</span>((yr&gt;=0.00) &amp;&amp; (yr&lt;=1.00)) 
<a name="l01268"></a>01268         <span class="keywordflow">return</span>(yr) ;
<a name="l01269"></a>01269     <span class="keywordflow">else</span>
<a name="l01270"></a>01270         <span class="keywordflow">return</span>(-1.00) ;
<a name="l01271"></a>01271     
<a name="l01272"></a>01272 }
<a name="l01273"></a>01273 
<a name="l01274"></a>01274 <span class="keywordtype">double</span>
<a name="l01275"></a>01275 PlotMaker::     
<a name="l01276"></a>01276 xIntercept(<span class="keywordtype">double</span> z00, <span class="keywordtype">double</span> z01, <span class="keywordtype">double</span> z10, <span class="keywordtype">double</span> z11, 
<a name="l01277"></a>01277            <span class="keywordtype">double</span> zc, <span class="keywordtype">double</span> yr) {
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     <span class="keywordtype">double</span> xr ;
<a name="l01280"></a>01280     <span class="keywordtype">double</span> t1,t2 ;
<a name="l01281"></a>01281     
<a name="l01282"></a>01282     t1 = zc-yr*(z01-z00)-z00 ;
<a name="l01283"></a>01283     t2 = yr*(z11-z01-z10+z00)+z10-z00 ;
<a name="l01284"></a>01284     
<a name="l01285"></a>01285     xr = (double)t1/(<span class="keywordtype">double</span>)t2 ;
<a name="l01286"></a>01286     <span class="keywordflow">if</span>((xr&gt;=0.00) &amp;&amp; (xr&lt;=1.00))
<a name="l01287"></a>01287         <span class="keywordflow">return</span>(xr) ;
<a name="l01288"></a>01288     <span class="keywordflow">else</span>
<a name="l01289"></a>01289         <span class="keywordflow">return</span>(-1.00) ;
<a name="l01290"></a>01290     
<a name="l01291"></a>01291 }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293 
<a name="l01319"></a>01319 <span class="keywordtype">void</span> 
<a name="l01320"></a>01320 PlotMaker::
<a name="l01321"></a>01321 niceRaDecContours(<span class="keywordtype">double</span> ra,  <span class="keywordtype">double</span> dec, 
<a name="l01322"></a>01322                   <span class="keywordtype">double</span> xcont[],<span class="keywordtype">double</span> ycont[], 
<a name="l01323"></a>01323                   <span class="keywordtype">double</span> ra_nice[], <span class="keywordtype">double</span> dec_nice[], 
<a name="l01324"></a>01324                   <span class="keywordtype">int</span> drawx[], <span class="keywordtype">int</span> drawy[], 
<a name="l01325"></a>01325                   <span class="keywordtype">char</span> ra_str[17][128],
<a name="l01326"></a>01326                   <span class="keywordtype">char</span> dec_str[17][128]) {
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="keyword">register</span> <span class="keywordtype">int</span> i, j, k ;
<a name="l01329"></a>01329     <span class="keywordtype">double</span> hh, mm, ss ;
<a name="l01330"></a>01330     <span class="keywordtype">double</span> fraz ;       <span class="comment">/* RA in radians but truncated to the nearest min */</span>
<a name="l01331"></a>01331     <span class="keywordtype">double</span> radeg ;      <span class="comment">/* RA in decimal degrees */</span>
<a name="l01332"></a>01332     <span class="keywordtype">double</span> dd, arcmm, archm, arcss ;
<a name="l01333"></a>01333     <span class="keywordtype">double</span> fdecz ;  <span class="comment">/* DEC in radians but truncated to the nearest arcmin */</span>
<a name="l01334"></a>01334     <span class="keywordtype">double</span> decdeg ; <span class="comment">/* DEC in decimal degrees */</span>
<a name="l01335"></a>01335     <span class="keywordtype">double</span> ratmp, dectmp,dectmp2,denom;
<a name="l01336"></a>01336     <span class="keyword">static</span> <span class="keywordtype">int</span>  nbins = 6 ;
<a name="l01337"></a>01337     <span class="keyword">static</span> <span class="keywordtype">double</span> xoff_dec[] = {-32.0, -16.0, -8.0,-4.0, -8.0, -16.0, -32.0} ;
<a name="l01338"></a>01338     <span class="keyword">static</span> <span class="keywordtype">double</span> xstep_dec[] = {4.0, 2.0, 1.0, 0.5, 1.0, 2.0, 4.0} ;
<a name="l01339"></a>01339     <span class="keyword">static</span> <span class="keywordtype">double</span> dec_bins[] = {-90.1, -73.0, 
<a name="l01340"></a>01340                                 -67.0 ,-45, 
<a name="l01341"></a>01341                                 45.0, 67.0, 
<a name="l01342"></a>01342                                 73.0, 90.1};
<a name="l01343"></a>01343     <span class="keywordtype">double</span> xoff ;       <span class="comment">/* Starting RA offset in degrees */</span>
<a name="l01344"></a>01344     <span class="keywordtype">double</span> dx ; <span class="comment">/* RA step in degrees */</span>
<a name="l01345"></a>01345     <span class="keywordtype">char</span> tempstra[100] ;
<a name="l01346"></a>01346     <span class="keywordtype">double</span> frahh[NCONTSTEPS+1] ;
<a name="l01347"></a>01347     <span class="keywordtype">double</span> framm[NCONTSTEPS+1] ;
<a name="l01348"></a>01348     <span class="keywordtype">int</span> irahh[NCONTSTEPS+1] ;
<a name="l01349"></a>01349     <span class="keywordtype">int</span> iramm[NCONTSTEPS+1] ;
<a name="l01350"></a>01350     <span class="keywordtype">double</span> fdecdd[NCONTSTEPS+1] ;
<a name="l01351"></a>01351     <span class="keywordtype">double</span> fdecmm[NCONTSTEPS+1] ;
<a name="l01352"></a>01352     <span class="keywordtype">int</span> idecdd[NCONTSTEPS+1] ;
<a name="l01353"></a>01353     <span class="keywordtype">int</span> idecmm[NCONTSTEPS+1] ;
<a name="l01354"></a>01354     
<a name="l01355"></a>01355     <span class="comment">// KPK: this routine (which was taken from the old quicklook kumac</span>
<a name="l01356"></a>01356     <span class="comment">// files originally assumed that ra and dec were in &quot;formatted&quot;</span>
<a name="l01357"></a>01357     <span class="comment">// format (ie, hhmmss.ss) instead of radians.  We use radians, so</span>
<a name="l01358"></a>01358     <span class="comment">// we need to first convert to the hhmmss format!  (confusing, but</span>
<a name="l01359"></a>01359     <span class="comment">// easier than modifying this code!)</span>
<a name="l01360"></a>01360 
<a name="l01361"></a>01361     <span class="keywordtype">double</span> ra_h, ra_m, ra_s;
<a name="l01362"></a>01362     <span class="keywordtype">double</span> dec_d, dec_m, dec_s;
<a name="l01363"></a>01363 
<a name="l01364"></a>01364     radToHMS( ra, ra_h,ra_m,ra_s );
<a name="l01365"></a>01365     radToDMS( dec, dec_d,dec_m,dec_s );
<a name="l01366"></a>01366 
<a name="l01367"></a>01367     ra = (((int)ra_h)*10000 +
<a name="l01368"></a>01368           ((int)ra_m)*100 +
<a name="l01369"></a>01369           ra_s);
<a name="l01370"></a>01370     
<a name="l01371"></a>01371     dec = (((int)dec_d)*10000 +
<a name="l01372"></a>01372            ((int)dec_m)*100 +
<a name="l01373"></a>01373            dec_s);
<a name="l01374"></a>01374            
<a name="l01375"></a>01375     <span class="comment">// done with conversion!</span>
<a name="l01376"></a>01376 
<a name="l01377"></a>01377     hh = int(ra/10000.) ;
<a name="l01378"></a>01378     mm = int((ra-hh*10000)/100.) ;
<a name="l01379"></a>01379     ss = ra - hh*10000 - mm*100. ;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381     fraz = (hh+mm/60.)*15.0/(180.0/M_PI) ;
<a name="l01382"></a>01382     radeg = (hh+mm/60.+ss/3600.)*15.0 ;
<a name="l01383"></a>01383 
<a name="l01384"></a>01384     dd = int(dec/10000.) ;
<a name="l01385"></a>01385     arcmm = int((dec-dd*10000.)/100.) ;
<a name="l01386"></a>01386     archm = int((dec-dd*10000.)/(100.*30.)) ;
<a name="l01387"></a>01387     arcss = dec-dd*10000.-arcmm*100. ;
<a name="l01388"></a>01388     fdecz = (dd+0.5*archm)/(180.0/M_PI) ;  <span class="comment">/* DEC in rad truncated to min */</span>
<a name="l01389"></a>01389     decdeg = dd+arcmm/60.0+arcss/3600. ;  <span class="comment">/* DEC in degrees */</span>
<a name="l01390"></a>01390 
<a name="l01391"></a>01391     <span class="keywordflow">for</span>(i=0; i&lt;nbins; i++) {    <span class="comment">/* Find good values for RA given DEC */</span>
<a name="l01392"></a>01392         <span class="keywordflow">if</span>((decdeg &gt; dec_bins[i]) &amp;&amp; (decdeg &lt; dec_bins[i+1])) {
<a name="l01393"></a>01393             xoff = xoff_dec[i] ;
<a name="l01394"></a>01394             dx = xstep_dec[i] ;
<a name="l01395"></a>01395         }
<a name="l01396"></a>01396     }
<a name="l01397"></a>01397     ra = radeg/(180.0/M_PI) ;   
<a name="l01398"></a>01398     dec = decdeg/(180.0/M_PI) ;
<a name="l01399"></a>01399       
<a name="l01400"></a>01400     <span class="keywordflow">for</span>(i=0; i&lt;NCONTSTEPS; i++) {
<a name="l01401"></a>01401         ratmp = fraz*(180.0/M_PI)+xoff ;
<a name="l01402"></a>01402         dectmp = fdecz*(180.0/M_PI)+xoff ;
<a name="l01403"></a>01403         frahh[i] = floor(ratmp*24./360.+0.0001) ;
<a name="l01404"></a>01404         framm[i] = floor((ratmp*24./360.-frahh[i])*60.+0.0001) ;
<a name="l01405"></a>01405         irahh[i] = (int)floor(frahh[i]+0.0001) ;
<a name="l01406"></a>01406         iramm[i] = (int)floor(framm[i]+0.0001) ;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408         <span class="keywordflow">if</span> (dectmp&lt;0) dectmp2 = dectmp*-1;
<a name="l01409"></a>01409         <span class="keywordflow">else</span> dectmp2 = dectmp;
<a name="l01410"></a>01410 
<a name="l01411"></a>01411         fdecdd[i] = floor((dectmp2+0.0001)) ;
<a name="l01412"></a>01412         fdecmm[i] = floor((dectmp2-fdecdd[i])*60.+0.0001) ;
<a name="l01413"></a>01413         idecdd[i] = (int)floor(fdecdd[i]+0.001) ;
<a name="l01414"></a>01414         idecmm[i] = (int)floor(fdecmm[i]+0.001) ;
<a name="l01415"></a>01415 
<a name="l01416"></a>01416         <span class="keywordflow">if</span> (dectmp&lt;0) {
<a name="l01417"></a>01417             fdecdd[i] *= -1;
<a name="l01418"></a>01418             idecdd[i] *= -1;
<a name="l01419"></a>01419         }
<a name="l01420"></a>01420 
<a name="l01421"></a>01421         xoff += dx ;
<a name="l01422"></a>01422         
<a name="l01423"></a>01423         dec_nice[i] = dectmp /= (180.0/M_PI) ;
<a name="l01424"></a>01424         ra_nice[i] = ratmp /= (180.0/M_PI) ;
<a name="l01425"></a>01425 
<a name="l01426"></a>01426         denom = sin(dec)*sin(dectmp)+cos(dec)*cos(dectmp)*cos(ratmp-ra) ;
<a name="l01427"></a>01427         <span class="keywordflow">if</span>(denom &gt; 0.0) {
<a name="l01428"></a>01428             xcont[i]=-(180.0/M_PI)*cos(dectmp)*sin(ratmp-ra)/denom ;
<a name="l01429"></a>01429             ycont[i]=(180.0/M_PI)*(cos(dec)*sin(dectmp)-
<a name="l01430"></a>01430                                   sin(dec)*cos(dectmp)*cos(ratmp-ra))/denom ;
<a name="l01431"></a>01431             <span class="keywordflow">if</span>((xcont[i] &gt; _minx) &amp;&amp; (xcont[i] &lt; _maxx)) 
<a name="l01432"></a>01432                 drawx[i] = 1 ;
<a name="l01433"></a>01433             <span class="keywordflow">else</span> 
<a name="l01434"></a>01434                 drawx[i] = 0 ;
<a name="l01435"></a>01435             <span class="keywordflow">if</span>((ycont[i] &gt; _miny) &amp;&amp; (ycont[i] &lt; _maxy)) 
<a name="l01436"></a>01436                 drawy[i] = 1 ;
<a name="l01437"></a>01437             <span class="keywordflow">else</span> 
<a name="l01438"></a>01438                 drawy[i] = 0 ;
<a name="l01439"></a>01439         } 
<a name="l01440"></a>01440         <span class="keywordflow">else</span> {
<a name="l01441"></a>01441             xcont[i] = 1000.0 ;
<a name="l01442"></a>01442             ycont[i] = 1000.0 ;
<a name="l01443"></a>01443             drawx[i] = 0 ;
<a name="l01444"></a>01444             drawy[i] = 0 ;
<a name="l01445"></a>01445         }
<a name="l01446"></a>01446         
<a name="l01447"></a>01447         sprintf(ra_str[i], <span class="stringliteral">&quot;%2d\\sph\\ep%2d\\spm\\ep&quot;</span>, irahh[i], iramm[i]) ;
<a name="l01448"></a>01448         sprintf(dec_str[i], <span class="stringliteral">&quot;%3d\\de%02d&#39;&quot;</span>, idecdd[i], idecmm[i]) ;
<a name="l01449"></a>01449     } 
<a name="l01450"></a>01450 
<a name="l01451"></a>01451 } 
<a name="l01452"></a>01452                            
<a name="l01453"></a>01453     
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Nov 1 2011 18:52:49 for wuparam by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
