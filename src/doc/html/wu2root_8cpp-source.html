<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: wu2root.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>wu2root.cpp</h1><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">// wu2root  - convert WUParam ntuples to ROOT trees</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// Karl Kosack, from modified version of Paul Rebillot's script</span>
00005 
00006 <span class="preprocessor">#include &lt;iostream&gt;</span>
00007 <span class="preprocessor">#include &lt;getopt.h&gt;</span>
00008 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00009 <span class="preprocessor">#include &lt;fstream&gt;</span>
00010 <span class="preprocessor">#include &lt;string&gt;</span>
00011 <span class="preprocessor">#include &lt;exception&gt;</span>
00012 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00013 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00014 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00015 
00016 <span class="comment">// ROOT stuff:</span>
00017 
00018 <span class="preprocessor">#include &lt;TFile.h&gt;</span>
00019 <span class="preprocessor">#include &lt;TTree.h&gt;</span>
00020 <span class="preprocessor">#include &lt;TSystem.h&gt;</span>
00021 
00022 <span class="comment">// WUPARAM stuff:</span>
00023 
00024 <span class="preprocessor">#include "Types.h"</span>
00025 <span class="preprocessor">#include "Exceptions.h"</span>
00026 <span class="preprocessor">#include "Config.h"</span>
00027 <span class="preprocessor">#include "ImageAnalyzer.h"</span>
00028 <span class="preprocessor">#include "ParamDataReader.h"</span>
00029 <span class="preprocessor">#include "Cutter.h"</span>
00030 <span class="preprocessor">#include "Log.h"</span>
00031 
00032 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00033 
00034 <span class="keyword">namespace </span>WU2Root {
00035     <span class="keywordtype">void</span> getCommandLineOptions(<span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv);
00036     <span class="keywordtype">void</span> showUsage();
00037 }
00038 
00039 <span class="keywordtype">int</span>
00040 main( <span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv ) {
00041 
00042     WU2Root::getCommandLineOptions(argc,argv);
00043     
00044     <a class="code" href="classParamDataReader.html">ParamDataReader</a> *reader;
00045     <a class="code" href="structHillasParameterization.html">HillasParameterization</a> param;
00046 
00047     <span class="keywordflow">if</span> (argc-optind != 1 ) {
00048         WU2Root::showUsage();
00049         exit(1);
00050     }
00051 
00052     string ntuplefilename, newfilename;
00053     ntuplefilename = argv[optind];
00054     newfilename = ntuplefilename+<span class="stringliteral">".root"</span>;
00055 
00056     TFile *tfile = <span class="keyword">new</span> TFile(newfilename.c_str(), <span class="stringliteral">"RECREATE"</span>); 
00057     
00058     
00059     <span class="comment">// ===============================================================</span>
00060     <span class="comment">//define branches:</span>
00061     <span class="comment">// ===============================================================</span>
00062 
00063     TTree *tree = <span class="keyword">new</span> TTree(<span class="stringliteral">"params"</span>,
00064                             <span class="stringliteral">"WUParam parameter output"</span>);
00065 
00066     <span class="comment">// simulation parameters:</span>
00067 
00068     tree-&gt;Branch(<span class="stringliteral">"sim_event_num"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.event_number,<span class="stringliteral">"sim_event_num/I"</span>);
00069     tree-&gt;Branch(<span class="stringliteral">"sim_primary"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.primary_type,<span class="stringliteral">"sim_primary/I"</span>);
00070     tree-&gt;Branch(<span class="stringliteral">"sim_energy"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.primary_energy,<span class="stringliteral">"sim_energy/D"</span>);
00071     tree-&gt;Branch(<span class="stringliteral">"sim_impact_x"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.impact_parameter.x,
00072                  <span class="stringliteral">"sim_impact_x/D"</span>);
00073     tree-&gt;Branch(<span class="stringliteral">"sim_impact_y"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.impact_parameter.y,
00074                  <span class="stringliteral">"sim_impact_y/D"</span>);
00075     tree-&gt;Branch(<span class="stringliteral">"sim_dircos_x"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.direction_cos.x,
00076                  <span class="stringliteral">"sim_dircos_x/D"</span>);
00077     tree-&gt;Branch(<span class="stringliteral">"sim_dircos_y"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o6">sim</a>.direction_cos.y,
00078                  <span class="stringliteral">"sim_dircos_y/D"</span>);
00079     
00080     <span class="comment">// global information</span>
00081     
00082     tree-&gt;Branch(<span class="stringliteral">"tele_id"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o0">telescope_id</a>,<span class="stringliteral">"tele_id/s"</span>);
00083     tree-&gt;Branch(<span class="stringliteral">"osctime"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o1">osctime</a>,<span class="stringliteral">"osctime/D"</span>);
00084     tree-&gt;Branch(<span class="stringliteral">"gpstime"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o2">gpstime</a>,<span class="stringliteral">"gpstime/D"</span>);
00085     tree-&gt;Branch(<span class="stringliteral">"event_num"</span>,&amp;param.<a class="code" href="structImageParameterization.html#o5">event_number</a>,<span class="stringliteral">"gpstime/I"</span>);
00086     
00087     <span class="comment">// HillasParameterization stuff:</span>
00088 
00089     tree-&gt;Branch(<span class="stringliteral">"cen_x"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o0">centroid</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>,<span class="stringliteral">"cen_x/D"</span>);
00090     tree-&gt;Branch(<span class="stringliteral">"cen_y"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o0">centroid</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>,<span class="stringliteral">"cen_y/D"</span>);
00091     tree-&gt;Branch(<span class="stringliteral">"poo_Ax"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o1">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>,<span class="stringliteral">"poo_Ax/D"</span>);
00092     tree-&gt;Branch(<span class="stringliteral">"poo_Ay"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o1">point_of_origin_a</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>,<span class="stringliteral">"poo_Ay/D"</span>);
00093     tree-&gt;Branch(<span class="stringliteral">"poo_Bx"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o2">point_of_origin_b</a>.<a class="code" href="structCoordinate__t.html#o0">x</a>,<span class="stringliteral">"poo_Bx/D"</span>);
00094     tree-&gt;Branch(<span class="stringliteral">"poo_By"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o2">point_of_origin_b</a>.<a class="code" href="structCoordinate__t.html#o1">y</a>,<span class="stringliteral">"poo_By/D"</span>);
00095     tree-&gt;Branch(<span class="stringliteral">"length"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o3">length</a>,<span class="stringliteral">"length/D"</span>);
00096     tree-&gt;Branch(<span class="stringliteral">"width"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o4">width</a>,<span class="stringliteral">"width/D"</span>);
00097     tree-&gt;Branch(<span class="stringliteral">"miss"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o6">miss</a>,<span class="stringliteral">"miss/D"</span>);
00098     tree-&gt;Branch(<span class="stringliteral">"distance"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o7">distance</a>,<span class="stringliteral">"distance/D"</span>);
00099     tree-&gt;Branch(<span class="stringliteral">"azwidth"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o8">azwidth</a>,<span class="stringliteral">"azwidth/D"</span>);
00100     tree-&gt;Branch(<span class="stringliteral">"alpha"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o9">alpha</a>,<span class="stringliteral">"alpha/D"</span>);
00101     tree-&gt;Branch(<span class="stringliteral">"psi"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o11">psi</a>,<span class="stringliteral">"psi/D"</span>);
00102     tree-&gt;Branch(<span class="stringliteral">"phi"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o12">phi</a>,<span class="stringliteral">"phi/D"</span>);
00103     tree-&gt;Branch(<span class="stringliteral">"size"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o5">size</a>,<span class="stringliteral">"size/D"</span>);
00104     tree-&gt;Branch(<span class="stringliteral">"max1"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o13">max</a>[0],<span class="stringliteral">"max1/D"</span>);
00105     tree-&gt;Branch(<span class="stringliteral">"max2"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o13">max</a>[1],<span class="stringliteral">"max2/D"</span>);
00106     tree-&gt;Branch(<span class="stringliteral">"max3"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o13">max</a>[2],<span class="stringliteral">"max3/D"</span>);
00107     tree-&gt;Branch(<span class="stringliteral">"i_max1"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o14">index_of_max</a>[0],<span class="stringliteral">"i_max1/I"</span>);
00108     tree-&gt;Branch(<span class="stringliteral">"i_max2"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o14">index_of_max</a>[1],<span class="stringliteral">"i_max2/I"</span>);
00109     tree-&gt;Branch(<span class="stringliteral">"i_max3"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o14">index_of_max</a>[2],<span class="stringliteral">"i_max3/I"</span>);
00110     tree-&gt;Branch(<span class="stringliteral">"frac1"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o15">frac</a>[0],<span class="stringliteral">"frac1/D"</span>);
00111     tree-&gt;Branch(<span class="stringliteral">"frac2"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o15">frac</a>[1],<span class="stringliteral">"frac2/D"</span>);
00112     tree-&gt;Branch(<span class="stringliteral">"frac3"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o15">frac</a>[2],<span class="stringliteral">"frac3/D"</span>);
00113     tree-&gt;Branch(<span class="stringliteral">"asym"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o17">asymmetry</a>,<span class="stringliteral">"asym/D"</span>);
00114     tree-&gt;Branch(<span class="stringliteral">"len_size"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o10">length_over_size</a>,<span class="stringliteral">"len_size/D"</span>);
00115     tree-&gt;Branch(<span class="stringliteral">"zenith_rad"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o19">zenith</a>,<span class="stringliteral">"zenith_rad/D"</span>);
00116     tree-&gt;Branch(<span class="stringliteral">"energy_est"</span>,&amp;param.<a class="code" href="structHillasParameterization.html#o20">energy_estimate</a>,<span class="stringliteral">"energy_est/D"</span>);
00117     
00118     <span class="keywordflow">try</span> {
00119         
00120     
00121         <span class="keywordflow">try</span> {
00122             
00123             reader = <span class="keyword">new</span> <a class="code" href="classParamDataReader.html">ParamDataReader</a>( ntuplefilename );
00124             
00125             
00126             <span class="keywordflow">while</span> (1) {
00127                 reader-&gt;<a class="code" href="classParamDataReader.html#a3">getNextEventRecord</a>( param );
00128                 tree-&gt;Fill();
00129             }
00130             
00131         }
00132         <span class="keywordflow">catch</span> (<a class="code" href="classEOFException.html">EOFException</a> &amp;e){<span class="comment">/* end of file */</span> }
00133         tree-&gt;Write();
00134 
00135         
00136     }
00137     <span class="keywordflow">catch</span> (<a class="code" href="classAnalysisException.html">AnalysisException</a> &amp;e){
00138         cout &lt;&lt; <span class="stringliteral">"conversion failed: "</span>&lt;&lt; e.what() &lt;&lt; endl;
00139     }
00140     
00141     <span class="keyword">delete</span> reader;
00142     <span class="keyword">delete</span> tree;
00143     <span class="keyword">delete</span> tfile; 
00144    
00145 }
00146 
00147 
00148 
00149 <span class="keywordtype">void</span> 
00150 WU2Root::getCommandLineOptions(<span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv) {
00151 
00152     <span class="keywordtype">char</span> c=0;
00153 
00154     <span class="keywordflow">while</span> ( c != -1 &amp;&amp; c!= 255) {
00155 
00156         c=getopt( argc, argv, <span class="stringliteral">""</span>);
00157 
00158         <span class="keywordflow">switch</span> (c) {
00159 
00160         <span class="keywordflow">default</span>:
00161             <span class="keywordflow">break</span>;
00162         }
00163         
00164     }
00165 
00166 }
00167 
00168 <span class="keywordtype">void</span> WU2Root::showUsage() {
00169 
00170     cerr &lt;&lt; <span class="stringliteral">"USAGE: wu2root &lt;ntuple&gt;"</span> &lt;&lt; endl;
00171     cerr &lt;&lt; <span class="stringliteral">"\tOutput will be to *.ntuple.root"</span>&lt;&lt;endl;
00172 
00173 }
00174 
00175 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:46 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
