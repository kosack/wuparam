<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: wuplot.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>wuplot.cpp</h1><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">// wuplot - external plotting utility for plotting 2d data from WUParam, etc.</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// Karl Kosack</span>
00005 
00006 
00007 <span class="preprocessor">#include &lt;iostream&gt;</span>
00008 <span class="preprocessor">#include &lt;getopt.h&gt;</span>
00009 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00010 <span class="preprocessor">#include &lt;fstream&gt;</span>
00011 <span class="preprocessor">#include &lt;string&gt;</span>
00012 <span class="preprocessor">#include &lt;list&gt;</span>
00013 <span class="preprocessor">#include &lt;exception&gt;</span>
00014 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
00015 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00016 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00017 
00018 <span class="preprocessor">#include "Types.h"</span>
00019 <span class="preprocessor">#include "PlotMaker.h"</span>
00020 <span class="preprocessor">#include "Image2D.h"</span>
00021 <span class="preprocessor">#include "Config.h"</span>
00022 <span class="preprocessor">#include "StarCatalog.h"</span>
00023 <span class="preprocessor">#include "Exceptions.h"</span>
00024 
00025 <span class="comment">//#include "wuplot.h" </span>
00026 
00027 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00028 
00029 <span class="keywordtype">void</span> parsePlot( string filename );
00030 string getStringLiteral( vector&lt;string&gt; &amp;v, <span class="keywordtype">int</span> startelement );
00031 <span class="keywordtype">void</span> expect( <span class="keywordtype">int</span>, vector&lt;string&gt; &amp;v) ;
00032 <span class="keywordtype">void</span> readCurve( string filename, vector&lt;double&gt; &amp;xpoints, 
00033                 vector&lt;double&gt; &amp;ypoints );
00034 
00035 <span class="keywordtype">void</span> prepareQuotedStrings( string &amp;line );
00036 
00037 <span class="keyword">class </span>ParseException : <span class="keyword">public</span> runtime_error {
00038 <span class="keyword">public</span>:
00039     ParseException(string what): runtime_error(what){;}
00040 };
00041 
00042 
00043 <span class="keyword">namespace </span>WUPlot {
00044 
00045     <span class="keywordtype">bool</span> xdisplay=<span class="keyword">true</span>;
00046     string outputfilename;
00047     string outputtype=<span class="stringliteral">"ps"</span>;
00048     <span class="keywordtype">int</span> marker = 16;
00049     <span class="keywordtype">int</span> smooth = 0;
00050     
00051     <span class="keywordtype">void</span> showUsage();
00052     <span class="keywordtype">void</span> getCommandLineOptions(<span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv);
00053 
00054 };
00055 
00056 <span class="keyword">const</span> <span class="keywordtype">char</span> SPACE_PLACEHOLDER = (<span class="keywordtype">char</span>)254;
00057 
00058 
00059 <span class="keywordtype">int</span>
00060 main( <span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv ) {
00061     
00062     cout &lt;&lt; <span class="stringliteral">"===================================="</span>
00063          &lt;&lt; <span class="stringliteral">"===================================="</span> &lt;&lt; endl
00064          &lt;&lt; <span class="stringliteral">"WUPlot - data plotter v"</span>&lt;&lt; VERSION
00065          &lt;&lt; <span class="stringliteral">" &lt;kosack@hbar.wustl.edu&gt; "</span> &lt;&lt; endl
00066          &lt;&lt; <span class="stringliteral">"Washington University Physics Department, St. Louis M0"</span>
00067          &lt;&lt; endl;
00068     cout &lt;&lt; <span class="stringliteral">"===================================="</span>
00069          &lt;&lt; <span class="stringliteral">"===================================="</span>
00070          &lt;&lt; endl &lt;&lt; endl;
00071     
00072     
00073     WUPlot::outputfilename = <span class="stringliteral">"output.eps"</span>;
00074 
00075     WUPlot::getCommandLineOptions( argc, argv );
00076 
00077     <span class="keywordflow">if</span> (argc-optind &lt; 1) {
00078         WUPlot::showUsage();
00079         exit(1);
00080     }
00081 
00082     <span class="keywordflow">if</span> (WUPlot::outputfilename == argv[optind]) {
00083         cout &lt;&lt; <span class="stringliteral">"You can't output to the same file as the input!"</span> &lt;&lt; endl;
00084         exit(1);
00085     }
00086 
00087     <span class="keywordflow">try</span> {
00088     
00089         parsePlot( argv[optind] );
00090 
00091     }
00092     <span class="keywordflow">catch</span>( <a class="code" href="classAnalysisException.html">AnalysisException</a> &amp;e) {
00093         cout &lt;&lt; <span class="stringliteral">"AnalysisException: "</span>&lt;&lt; e.what() &lt;&lt; endl;
00094         exit(1);
00095     }
00096     <span class="keywordflow">catch</span> (exception &amp;e) {
00097         cout &lt;&lt; <span class="stringliteral">"CRITICAL: "</span>&lt;&lt; e.what() &lt;&lt; endl;
00098         exit(1);
00099     }
00100     <span class="keywordflow">catch</span> (...) {
00101         cout &lt;&lt; <span class="stringliteral">"HUH?: caught an unknown exception!"</span> &lt;&lt; endl;
00102         exit(1);
00103     }
00104 
00105     <span class="keywordflow">if</span> (WUPlot::xdisplay)
00106         cout &lt;&lt;<span class="stringliteral">"Tip: Use the -o &lt;filename&gt; option to "</span>
00107              &lt;&lt; <span class="stringliteral">"output to an EPS file (by default) or other format"</span>&lt;&lt;endl;
00108     <span class="keywordflow">else</span> 
00109         cout &lt;&lt; <span class="stringliteral">"Wrote "</span>&lt;&lt;WUPlot::outputtype
00110              &lt;&lt;<span class="stringliteral">" output to '"</span>&lt;&lt;WUPlot::outputfilename&lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt;endl;
00111     
00112     <span class="keywordflow">if</span> (WUPlot::outputtype==<span class="stringliteral">"ps"</span>) {
00113         cout &lt;&lt; <span class="stringliteral">"Tip: the eps plots generated by WUPlot can be very large. "</span>
00114              &lt;&lt; endl
00115              &lt;&lt; <span class="stringliteral">"     try converting to PDF using 'ps2pdf "</span>
00116              &lt;&lt;WUPlot::outputfilename&lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt; endl
00117              &lt;&lt; <span class="stringliteral">"     to drastically reduce the file size."</span> &lt;&lt; endl;        
00118     }
00119 
00120 }
00121 
00122 
00129 <span class="keywordtype">void</span> parsePlot( string filename ) {
00130 
00131     ifstream plotfile( filename.c_str() );
00132     <span class="keywordtype">int</span> linenum=0;
00133     <a class="code" href="classPlotMaker.html">PlotMaker</a> *pm;
00134 
00135     <span class="keywordflow">if</span> (WUPlot::xdisplay == <span class="keyword">true</span>) 
00136         pm = <span class="keyword">new</span> <a class="code" href="classPlotMaker.html">PlotMaker</a>( <span class="stringliteral">"X"</span>, <span class="stringliteral">"x.out"</span> );
00137     <span class="keywordflow">else</span>
00138         pm = <span class="keyword">new</span> PlotMaker( WUPlot::outputtype, WUPlot::outputfilename );
00139 
00140     string line;
00141     <span class="keywordtype">int</span> i;
00142 
00143     <span class="comment">//================================================================</span>
00144     <span class="comment">// open the plot file</span>
00145     <span class="comment">//================================================================</span>
00146 
00147     <span class="keywordflow">if</span> (plotfile.fail()) {
00148         cout &lt;&lt; <span class="stringliteral">"** Couldn't open '"</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">"'"</span>&lt;&lt;endl;
00149         <span class="keywordflow">return</span>;
00150     } 
00151     
00152     
00153     <span class="comment">//================================================================</span>
00154     <span class="comment">// read each line, tokenize, and determine what to do...</span>
00155     <span class="comment">//================================================================</span>
00156     
00157     <span class="keywordflow">while</span> (plotfile &amp;&amp; !plotfile.eof()) {
00158         
00159         vector&lt;string&gt; tokens;
00160 
00161         linenum++;
00162 
00163         getline( plotfile, line, <span class="charliteral">'\n'</span> );
00164 
00165         <span class="comment">// remove white space and comments</span>
00166 
00167         i = line.find(<span class="stringliteral">"#"</span>);
00168         line = line.substr(0,i);
00169         removeWhiteSpace( line );
00170 
00171         <span class="comment">// ensure that quoted strings take up exactly one token</span>
00172         <span class="comment">// (convert whitespace into special characters). Later, quoted</span>
00173         <span class="comment">// strings must be read back with getStringLiteral to remove</span>
00174         <span class="comment">// the excess formatting and quote characters.</span>
00175         
00176         prepareQuotedStrings( line );
00177 
00178         <span class="comment">// tokenize</span>
00179 
00180         tokenize( line, tokens, <span class="stringliteral">" \t,"</span> );
00181         <span class="keywordflow">if</span> (tokens.size() &lt; 1 ) <span class="keywordflow">continue</span>;
00182 
00183         <span class="comment">// process command: </span>
00184 
00185         <span class="keywordflow">try</span> {
00186             <span class="comment">// ----------------------------------------------------------</span>
00187             <span class="comment">// SET</span>
00188             <span class="comment">// ----------------------------------------------------------</span>
00189             <span class="keywordflow">if</span> (tokens[0] == <span class="stringliteral">"set"</span>) {
00190 
00191                 expect(2, tokens);
00192 
00193                 <span class="comment">// -----------------------</span>
00194                 <span class="comment">// axes</span>
00195                 <span class="comment">// -----------------------</span>
00196                 <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"axes"</span>) {
00197                     
00198                     expect( 4, tokens );
00199 
00200                     <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"geometry"</span>) {
00201                         string file = getStringLiteral( tokens, 3 );
00202                         <a class="code" href="classImage2D.html">Image2D</a> im2d;
00203                         im2d.<a class="code" href="classImage2D.html#a8">load</a>( file );
00204 
00205                         pm-&gt;<a class="code" href="classPlotMaker.html#a2">setAxisBox</a>( im2d );
00206                         
00207                     }
00208                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"ticcolor"</span>) {
00209                         string color = getStringLiteral(tokens, 3);
00210                         pm-&gt;<a class="code" href="classPlotMaker.html#a39">setTicMarkColorName</a>( color );
00211                     }
00212                     <span class="keywordflow">else</span> {
00213                         <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown axis type "</span>
00214                                                     +tokens[2]);
00215                     }
00216                     
00217                 }
00218                 
00219                 <span class="comment">// -----------------------</span>
00220                 <span class="comment">// contour</span>
00221                 <span class="comment">// -----------------------</span>
00222                 
00223                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"contour"</span>) {
00224 
00225                     expect(4, tokens);              
00226 
00227                     <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"color"</span>) {
00228                         string color = getStringLiteral(tokens, 3);
00229                         pm-&gt;<a class="code" href="classPlotMaker.html#a38">setContourColorName</a>( color );
00230                     }
00231                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"style"</span>) {
00232                         string style = getStringLiteral(tokens,3);
00233                         pm-&gt;<a class="code" href="classPlotMaker.html#a40">setContourLineStyle</a>( style );
00234                         
00235                     }
00236                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"width"</span>) {
00237                         <span class="keywordtype">double</span> width = atof( tokens[3].c_str() );
00238                         pm-&gt;<a class="code" href="classPlotMaker.html#a42">setContourLineWidth</a>( width );
00239                         
00240                     }
00241                     <span class="keywordflow">else</span> <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown attribute "</span>+tokens[2]);
00242 
00243                     
00244                 }
00245                 
00246                 <span class="comment">// -----------------------</span>
00247                 <span class="comment">// marker</span>
00248                 <span class="comment">// -----------------------</span>
00249 
00250                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"marker"</span>) {
00251                     
00252                     expect( 4, tokens );
00253 
00254                     <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"type"</span>) {
00255                         WUPlot::marker = atoi(tokens[3].c_str());
00256                         pm-&gt;<a class="code" href="classPlotMaker.html#a46">setMarkerType</a>(atoi(tokens[3].c_str()));
00257                     }
00258                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"color"</span>) {
00259                         string color = getStringLiteral(tokens, 3);
00260                         pm-&gt;<a class="code" href="classPlotMaker.html#a48">setMarkerColorName</a>( color );
00261                     }
00262                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"size"</span>) {
00263                         pm-&gt;<a class="code" href="classPlotMaker.html#a47">setMarkerSize</a>( atof(tokens[3].c_str()));
00264                     }
00265                     <span class="keywordflow">else</span> <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown attribute "</span>+tokens[2]);
00266 
00267                 }
00268 
00269                 <span class="comment">// -----------------------</span>
00270                 <span class="comment">// smooth</span>
00271                 <span class="comment">// -----------------------</span>
00272 
00273                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"smooth"</span>) {
00274 
00275                     expect( 3, tokens );
00276 
00277                     WUPlot::smooth = atoi(tokens[2].c_str());
00278 
00279                 }
00280                 
00281                 <span class="comment">// -----------------------</span>
00282                 <span class="comment">// colormap</span>
00283                 <span class="comment">// -----------------------</span>
00284 
00285 
00286                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"colormap"</span>) {
00287 
00288                     expect( 3, tokens );
00289 
00290                     string colormap = getStringLiteral( tokens, 2);
00291                     pm-&gt;<a class="code" href="classPlotMaker.html#a30">setColorMap</a>( colormap );
00292                 }
00293 
00294                 <span class="comment">// -----------------------</span>
00295                 <span class="comment">// colorscale</span>
00296                 <span class="comment">// -----------------------</span>
00297                 
00298                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"colorscale"</span>) {
00299                     expect( 3,tokens );
00300                     <span class="keywordflow">if</span> (tokens.size() == 3) {
00301                         <span class="keywordflow">if</span> (tokens[2]==<span class="stringliteral">"auto"</span>) {
00302                             pm-&gt;<a class="code" href="classPlotMaker.html#a37">enableAutoScale</a>(<span class="keyword">true</span>);
00303                         }
00304                         <span class="keywordflow">else</span> {
00305                             <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown scale "</span>+tokens[2]);
00306                         }
00307                     }
00308                     <span class="keywordflow">else</span> {
00309                         expect(4,tokens);
00310                         pm-&gt;<a class="code" href="classPlotMaker.html#a37">enableAutoScale</a>(<span class="keyword">false</span>);
00311                         pm-&gt;<a class="code" href="classPlotMaker.html#a36">setColorScale</a>( atof(tokens[2].c_str()),
00312                                            atof(tokens[3].c_str()) );
00313                     }
00314                     
00315                 }
00316 
00317                 <span class="comment">// -----------------------</span>
00318                 <span class="comment">// label</span>
00319                 <span class="comment">// -----------------------</span>
00320 
00321                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"label"</span>) {
00322 
00323                     expect( 4, tokens );
00324 
00325                     <span class="keywordflow">if</span> ( tokens[2] == <span class="stringliteral">"size"</span> ) {
00326                         pm-&gt;<a class="code" href="classPlotMaker.html#a45">setLabelSize</a>(atof( tokens[3].c_str() ));
00327                     }
00328                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( tokens[2] == <span class="stringliteral">"angle"</span> ) {
00329                         pm-&gt;<a class="code" href="classPlotMaker.html#a44">setLabelAngle</a>( atof( tokens[3].c_str() ) );
00330                     }
00331                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[2] == <span class="stringliteral">"color"</span> ){
00332                         string name = getStringLiteral( tokens, 3 );
00333                         pm-&gt;<a class="code" href="classPlotMaker.html#a43">setLabelColorName</a>( name );
00334                     }
00335                     <span class="keywordflow">else</span> <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown attribute "</span>+tokens[2]);
00336 
00337                 }
00338 
00339                 <span class="comment">// -----------------------</span>
00340                 <span class="comment">// rotation</span>
00341                 <span class="comment">// -----------------------</span>
00342 
00343                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"rotation"</span>) {
00344                     expect( 3, tokens );
00345                     
00346                     <span class="keywordtype">double</span> theta = atof(tokens[2].c_str());
00347 
00348                     pm-&gt;<a class="code" href="classPlotMaker.html#a10">rotate</a>( theta );
00349 
00350                 }
00351 
00352                 <span class="comment">// -----------------------</span>
00353                 <span class="comment">// unknown</span>
00354                 <span class="comment">// -----------------------              </span>
00355 
00356                 <span class="keywordflow">else</span>{
00357                     <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown attribute '"</span>+
00358                                                 tokens[1]+<span class="stringliteral">"'"</span>);         
00359                 }
00360 
00361 
00362                 
00363             }
00364             <span class="comment">// ----------------------------------------------------------</span>
00365             <span class="comment">// PLOT</span>
00366             <span class="comment">// ----------------------------------------------------------</span>
00367             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[0] == <span class="stringliteral">"plot"</span> ) {
00368 
00369                 expect( 2, tokens );
00370                 
00371                 <span class="comment">// -----------------------</span>
00372                 <span class="comment">// image</span>
00373                 <span class="comment">// -----------------------</span>
00374                 <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"image"</span>) {
00375                     
00376                     expect( 3, tokens );
00377 
00378                     string file = getStringLiteral( tokens, 2 );
00379                     <a class="code" href="classImage2D.html">Image2D</a> im;
00380                     im.load(file);
00381                     <span class="keywordflow">if</span> (WUPlot::smooth) {
00382                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;WUPlot::smooth; i++) 
00383                             im.expand();
00384                     }
00385                     pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>( im );
00386                 
00387 
00388                 }
00389 
00390                 <span class="comment">// -----------------------</span>
00391                 <span class="comment">// axes</span>
00392                 <span class="comment">// -----------------------</span>
00393                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"axes"</span> ) {
00394                     pm-&gt;<a class="code" href="classPlotMaker.html#a11">plotAxes</a>();
00395                 }
00396 
00397                 <span class="comment">// -----------------------</span>
00398                 <span class="comment">// contour</span>
00399                 <span class="comment">// -----------------------</span>
00400                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"contour"</span>) {
00401 
00402                     <span class="keywordtype">double</span> min,max,delta;
00403 
00404                     expect( 6, tokens );
00405 
00406                     min = atof( tokens[2].c_str() );
00407                     max = atof( tokens[3].c_str() );
00408                     delta = atof( tokens[4].c_str() );
00409 
00410                     string file = getStringLiteral( tokens, 5 );
00411                     <a class="code" href="classImage2D.html">Image2D</a> im;
00412 
00413                     im.load(file);
00414                     <span class="keywordflow">if</span> (WUPlot::smooth) im.expand();
00415                     pm-&gt;<a class="code" href="classPlotMaker.html#a18">contourPlot</a>( im, min, max, delta );
00416                 
00417                 }
00418                 
00419                 <span class="comment">// -----------------------</span>
00420                 <span class="comment">// curve</span>
00421                 <span class="comment">// -----------------------</span>
00422 
00423                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"curve"</span>) {
00424 
00425                     expect( 3, tokens );
00426 
00427                     vector&lt;double&gt; xpoints;
00428                     vector&lt;double&gt; ypoints;
00429                     
00430                     string file = getStringLiteral( tokens, 2 );
00431                     
00432                     readCurve( file, xpoints, ypoints );
00433 
00434                     pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>( xpoints, ypoints );
00435 
00436                     
00437                 }
00438 
00439                 <span class="comment">// -----------------------</span>
00440                 <span class="comment">// list of marker points</span>
00441                 <span class="comment">// -----------------------</span>
00442                 
00443                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"points"</span>) {
00444                     expect( 3, tokens );
00445 
00446                     vector&lt;double&gt; xpoints;
00447                     vector&lt;double&gt; ypoints;
00448                     
00449                     string file = getStringLiteral( tokens, 2 );
00450                     
00451                     readCurve( file, xpoints, ypoints );
00452 
00453                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;xpoints.size(); i++) {
00454                         pm-&gt;<a class="code" href="classPlotMaker.html#a29">plotMarker</a>( xpoints[i],ypoints[i] );
00455                     }
00456 
00457                 }
00458                 
00459 
00460                 <span class="comment">// -----------------------</span>
00461                 <span class="comment">// title</span>
00462                 <span class="comment">// -----------------------</span>
00463                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"title"</span> ) {
00464 
00465                     expect( 3, tokens );
00466 
00467                     string title = getStringLiteral( tokens, 2 );
00468                 
00469                     pm-&gt;<a class="code" href="classPlotMaker.html#a12">plotTitle</a>( title );
00470 
00471                 }
00472 
00473                 <span class="comment">// -----------------------</span>
00474                 <span class="comment">// subtitle</span>
00475                 <span class="comment">// -------------9----------</span>
00476                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"subtitle"</span> ) {
00477 
00478                     expect( 3, tokens );
00479 
00480                     string title = getStringLiteral( tokens, 2 );
00481                 
00482                     pm-&gt;<a class="code" href="classPlotMaker.html#a13">plotSubtitle</a>( title );
00483 
00484                 }
00485 
00486                 <span class="comment">// -----------------------</span>
00487                 <span class="comment">// starlist</span>
00488                 <span class="comment">// -----------------------</span>
00489 
00490                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"starlist"</span>) {
00491 
00492                     expect( 3, tokens );
00493 
00494                     string file = getStringLiteral( tokens, 2 );
00495                     <span class="keywordtype">int</span> n;
00496 
00497                     ifstream starfile( file.c_str() );
00498                     <span class="keywordflow">if</span> (starfile.fail()){
00499                         <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Couldn't open "</span>+file);
00500                     }
00501 
00502                     <a class="code" href="classStar.html">Star</a> star;
00503                     starfile &gt;&gt; n;
00504                     <span class="keywordflow">while</span> (starfile) {
00505                         starfile &gt;&gt; star;
00506                         pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>( star , WUPlot::marker );
00507                     }
00508                     
00509                     starfile.close();
00510 
00511                 }
00512 
00513                 <span class="comment">// -----------------------</span>
00514                 <span class="comment">// label</span>
00515                 <span class="comment">// -----------------------</span>
00516 
00517                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"label"</span> ) {
00518                     
00519                     expect( 5, tokens );
00520 
00521                     <span class="keywordtype">double</span> x = atof(tokens[2].c_str());
00522                     <span class="keywordtype">double</span> y = atof(tokens[3].c_str());
00523                     string text = getStringLiteral( tokens, 4 );
00524                    
00525                     pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>( text, x,y  );
00526 
00527                 }
00528 
00529                 
00530                 <span class="comment">// -----------------------</span>
00531                 <span class="comment">// ellipse</span>
00532                 <span class="comment">// -----------------------</span>
00533 
00534                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"ellipse"</span>) {
00535 
00536                     expect( 5, tokens );
00537 
00538                     <span class="keywordtype">double</span> x = atof( tokens[2].c_str() );
00539                     <span class="keywordtype">double</span> y = atof( tokens[3].c_str() );
00540                     <span class="keywordtype">double</span> r1 = atof( tokens[4].c_str() );
00541                     <span class="keywordtype">double</span> r2 = atof( tokens[5].c_str() );
00542                     <span class="keywordtype">double</span> theta = atof( tokens[6].c_str() );
00543 
00544                     pm-&gt;<a class="code" href="classPlotMaker.html#a28">plotEllipse</a>( x,y,r1,r2,theta );
00545 
00546                 }
00547 
00548                 <span class="comment">// -----------------------</span>
00549                 <span class="comment">// Marker</span>
00550                 <span class="comment">// -----------------------</span>
00551 
00552                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"marker"</span> ) {
00553                     expect( 4, tokens );
00554                     <span class="keywordtype">double</span> x = atof( tokens[2].c_str() );
00555                     <span class="keywordtype">double</span> y = atof( tokens[3].c_str() );
00556                     pm-&gt;<a class="code" href="classPlotMaker.html#a29">plotMarker</a>( x,y );
00557                 }
00558 
00559                 <span class="comment">// -----------------------</span>
00560                 <span class="comment">// radecgrid</span>
00561                 <span class="comment">// -----------------------</span>
00562 
00563                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[1] == <span class="stringliteral">"radecgrid"</span>) {
00564                     expect( 4, tokens );
00565                     <a class="code" href="classImage2D.html">Image2D</a> ragrid, decgrid;
00566                     string ramesh = getStringLiteral( tokens, 2 );
00567                     string decmesh = getStringLiteral( tokens, 3 );
00568                     ragrid.<a class="code" href="classImage2D.html#a8">load</a>(ramesh);
00569                     decgrid.<a class="code" href="classImage2D.html#a8">load</a>(decmesh);
00570                     
00571                     pm-&gt;<a class="code" href="classPlotMaker.html#a19">plotRADecGrid</a>( ragrid, decgrid );
00572 
00573                 }
00574 
00575                 <span class="comment">// -----------------------</span>
00576                 <span class="comment">// unknown</span>
00577                 <span class="comment">// -----------------------</span>
00578                    
00579                 <span class="keywordflow">else</span> {
00580                     <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unknown plot type: "</span>
00581                                                 +tokens[1]);
00582                 }
00583             
00584 
00585             }
00586             <span class="comment">// ----------------------------------------------------------</span>
00587             <span class="comment">// OTHERS</span>
00588             <span class="comment">// ----------------------------------------------------------</span>
00589             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[0] == <span class="stringliteral">"push"</span>) {
00590                 pm-&gt;<a class="code" href="classPlotMaker.html#a8">pushState</a>();
00591             }
00592             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tokens[0] == <span class="stringliteral">"pop"</span>) {
00593                 pm-&gt;<a class="code" href="classPlotMaker.html#a9">popState</a>();
00594             }
00595             <span class="keywordflow">else</span> {
00596                 <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Unidentified command '"</span>+tokens[0]+<span class="stringliteral">"'"</span>);
00597             }
00598        
00599         }
00600         <span class="keywordflow">catch</span> (ParseException &amp;e) {
00601             cout &lt;&lt; <span class="stringliteral">"WARNING: "</span>&lt;&lt;e.what()&lt;&lt; <span class="stringliteral">" at line "</span>
00602                  &lt;&lt; linenum &lt;&lt; <span class="stringliteral">" (skipped)"</span>&lt;&lt;endl;
00603             <span class="keywordflow">continue</span>;       
00604         }
00605         <span class="keywordflow">catch</span> (<a class="code" href="classMildAnalysisException.html">MildAnalysisException</a> &amp;e) {
00606             cout &lt;&lt; <span class="stringliteral">"MildAnalysisException: "</span>&lt;&lt;e.what()&lt;&lt; <span class="stringliteral">" at line "</span>
00607                  &lt;&lt; linenum &lt;&lt; <span class="stringliteral">" (skipped)"</span>&lt;&lt;endl;
00608             <span class="keywordflow">continue</span>;       
00609         }
00610 
00611     }
00612     
00613     <span class="keyword">delete</span> pm;
00614     
00615 
00616 }
00617 
00618 
00619 
00625 string 
00626 getStringLiteral( vector&lt;string&gt; &amp;v, <span class="keywordtype">int</span> start ) {
00627     
00628     string s;
00629     <span class="keywordtype">int</span>  q2;
00630 
00631     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=start; i&lt;v.size(); i++) {
00632         s.append(v[i]);
00633         <span class="keywordflow">if</span> (i!= v.size()-1) s.append(<span class="stringliteral">" "</span>);
00634     }
00635     
00636     <span class="keywordflow">if</span> (s[0] != <span class="charliteral">'"'</span>) {
00637         <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Expected a quoted string"</span>);
00638         <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00639     }
00640     
00641     q2 = s.find_first_of(<span class="charliteral">'"'</span>,1);
00642     
00643     string literal =  s.substr(1,q2-1);
00644 
00645     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;literal.length(); i++) 
00646         <span class="keywordflow">if</span> (literal[i]==SPACE_PLACEHOLDER) literal[i]=<span class="charliteral">' '</span>;
00647 
00648     <span class="keywordflow">return</span> literal;
00649 
00650 }
00651 
00652 
00653 
00654 <span class="keywordtype">void</span> 
00655 WUPlot::getCommandLineOptions(<span class="keywordtype">int</span> argc , <span class="keywordtype">char</span> **argv) {
00656 
00657     <span class="keywordtype">int</span> ret=0;
00658     <span class="keywordtype">int</span> c;
00659 
00660     <span class="keywordflow">while</span> ( ret != -1 ) {
00661 
00662         ret=getopt( argc, argv, <span class="stringliteral">"o:T:"</span>);
00663         c = ret;
00664 
00665         <span class="keywordflow">switch</span> (c) {
00666             
00667         <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
00668             outputfilename = optarg;
00669             WUPlot::xdisplay=<span class="keyword">false</span>;
00670             <span class="keywordflow">break</span>;
00671 
00672         <span class="keywordflow">case</span> <span class="charliteral">'T'</span>:
00673             WUPlot::outputtype = optarg;
00674 
00675         <span class="keywordflow">default</span>:
00676             <span class="keywordflow">break</span>;
00677 
00678         }
00679         
00680     }
00681     
00682 }
00683 
00684 
00685 <span class="keywordtype">void</span>
00686 WUPlot::showUsage() {
00687 
00688     cout &lt;&lt; <span class="stringliteral">"USAGE: wuplot [-o filename] [-T &lt;type&gt;] &lt;inputfile&gt;"</span> &lt;&lt; endl;
00689     cout &lt;&lt; <span class="stringliteral">"\t-o filename       send output to specified  file"</span>&lt;&lt; endl
00690          &lt;&lt; <span class="stringliteral">"\t                  instead of to the X display"</span> &lt;&lt; endl;
00691     cout &lt;&lt; <span class="stringliteral">"\t-T type           output file format [ps is default]"</span> &lt;&lt; endl;
00692 
00693     cout &lt;&lt; <span class="stringliteral">"output types: "</span>&lt;&lt;endl
00694          &lt;&lt;<span class="stringliteral">"X, png, pnm, gif, svg, ai, ps, cgm, fig, pcl, hpgl, regis, or tek"</span>
00695          &lt;&lt; endl;
00696         
00697 
00698 }
00699 
00700 
00701 <span class="keywordtype">void</span> expect( <span class="keywordtype">int</span> n, vector&lt;string&gt; &amp;v) {
00702     
00703     <span class="keywordflow">if</span> (v.size()&lt;n) {
00704          <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"wrong number of arguments"</span>);
00705     }           
00706     
00707 
00708 }
00709 
00710 
00711 <span class="keywordtype">void</span> readCurve( string filename, vector&lt;double&gt; &amp;xpoints, 
00712                 vector&lt;double&gt; &amp;ypoints ) {
00713 
00714     string line;
00715     <span class="keywordtype">int</span> linenum=0;
00716     vector&lt;string&gt; tokens;
00717     ifstream infile( filename.c_str() );
00718     <span class="keywordflow">if</span> (infile.fail())
00719         <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Couldn't open curve "</span>
00720                                     +filename );
00721 
00722     xpoints.clear();    
00723     ypoints.clear();
00724     
00725     
00726     <span class="keywordflow">while</span> (infile &amp;&amp; !infile.eof()) {
00727 
00728         getline( infile, line, <span class="charliteral">'\n'</span> );
00729         linenum++;
00730         tokens.clear();
00731         tokenize( line, tokens, <span class="stringliteral">" \t,"</span> );
00732 
00733         <span class="keywordflow">if</span> (tokens.size() == 0 ) <span class="keywordflow">continue</span>;
00734 
00735         <span class="keywordflow">if</span> (tokens.size() != 2) {
00736             cout &lt;&lt; <span class="stringliteral">"** skipping Bad data on line "</span>&lt;&lt; linenum 
00737                  &lt;&lt; <span class="stringliteral">" of "</span>&lt;&lt;filename &lt;&lt; endl;
00738             <span class="keywordflow">continue</span>;
00739         }
00740 
00741         xpoints.push_back( atof(tokens[0].c_str()) );
00742         ypoints.push_back( atof(tokens[1].c_str()) );
00743         
00744     }
00745 
00746 }
00747 
00748 
00749 <span class="keywordtype">void</span> prepareQuotedStrings( string &amp;line ) {
00750 
00751     vector&lt;int&gt; quotes;
00752 
00753     <span class="comment">// find quotes</span>
00754 
00755     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;line.length(); i++) {
00756         <span class="keywordflow">if</span> (line[i] == <span class="charliteral">'"'</span>) quotes.push_back(i);
00757     }
00758     
00759     <span class="keywordflow">if</span> (quotes.size() % 2 != 0) {
00760         <span class="keywordflow">throw</span> ParseException(<span class="stringliteral">"Missing quotation mark"</span>);
00761     }
00762 
00763     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;quotes.size(); i+=2) {
00764         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=quotes[i]; j&lt;=quotes[i+1]; j++) {
00765             <span class="keywordflow">if</span> (line[j] == <span class="charliteral">' '</span>) {
00766                 line[j]=SPACE_PLACEHOLDER;
00767             }
00768         }
00769     }
00770     
00771 
00772 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:46 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
