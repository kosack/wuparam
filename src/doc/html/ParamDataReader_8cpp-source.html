<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: ParamDataReader.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ParamDataReader.cpp</h1><div class="fragment"><pre>00001 <span class="comment">// ParamDataReader.cpp</span>
00002 <span class="comment">// Karl Kosack &lt;kosack@hbar.wustl.edu&gt;</span>
00003 
00004 <span class="preprocessor">#include &lt;fstream&gt;</span>
00005 <span class="preprocessor">#include &lt;gsl/gsl_ntuple.h&gt;</span>
00006 <span class="preprocessor">#include "DataWriter.h"</span>
00007 <span class="preprocessor">#include "ParamDataReader.h"</span>
00008 <span class="preprocessor">#include "Exceptions.h"</span>
00009 <span class="preprocessor">#include "Log.h"</span>
00010 
00011 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00012 
00013 ParamDataReader::ParamDataReader( <span class="keyword">const</span> string &amp;filename )
00014     : <a class="code" href="classDataReader.html">DataReader</a>(filename), _currow(0) {
00015     
00016     <span class="comment">// check version information</span>
00017 
00018     string versionfilename = filename+<span class="stringliteral">".ver"</span>;
00019     ifstream verfile(versionfilename.c_str());
00020     <span class="keywordflow">if</span> (!verfile.fail()){
00021         string version;
00022         verfile &gt;&gt; version;
00023         <span class="keywordflow">if</span> (version != OUTPUT_FILE_VERSION) {
00024             cout &lt;&lt; <span class="stringliteral">"NOTE: "</span>&lt;&lt;filename&lt;&lt;<span class="stringliteral">" was parameterized using "</span>
00025                  &lt;&lt; <span class="stringliteral">"a different"</span>&lt;&lt; endl
00026                  &lt;&lt; <span class="stringliteral">"      version of WUPARAM ("</span>&lt;&lt;version&lt;&lt;<span class="stringliteral">") "</span>
00027                  &lt;&lt; <span class="stringliteral">"and must be re-parameterized since the file format changed."</span>&lt;&lt;endl;
00028             <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"wrong file version for "</span>
00029                                             +filename);
00030         }
00031     }
00032     <span class="keywordflow">else</span> {
00033         <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00034         logger-&gt;<a class="code" href="classLogger.html#a0">printf</a>(<span class="stringliteral">"can't determine version of ntuple file, "</span>
00035                        <span class="stringliteral">"assuming current"</span>);
00036     }
00037 
00038     <span class="comment">// open the ntuple</span>
00039     
00040     _ntuple = gsl_ntuple_open( (<span class="keywordtype">char</span>*)getFilename().c_str(),
00041                                &amp;_ntuplerow, 
00042                                <span class="keyword">sizeof</span>(_ntuplerow));
00043 
00044     <span class="keywordflow">if</span> (_ntuple == NULL) {
00045         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Specified file didn't exist"</span>);
00046     }
00047 
00048 
00049     
00050 
00051 
00052 }
00053 
00054 ParamDataReader::
00055 ~ParamDataReader() {
00056 
00057     gsl_ntuple_close( _ntuple );
00058 
00059 }
00060 
00061 <span class="keywordtype">void</span>
00062 ParamDataReader::getNextEventRecord( <a class="code" href="structHillasParameterization.html">HillasParameterization</a> &amp;param ) {
00063 
00064     <span class="keywordflow">if</span> (gsl_ntuple_read( _ntuple )) {
00065         
00066         <span class="keywordflow">throw</span> <a class="code" href="classEOFException.html">EOFException</a>(<span class="stringliteral">"end of ntuple file"</span>);
00067         
00068     }
00069     param = *((<a class="code" href="structHillasParameterization.html">HillasParameterization</a> *)_ntuple-&gt;ntuple_data);
00070     _currow++;
00071 
00072 }
00073 
00081 <span class="keywordtype">void</span> 
<a name="l00082"></a><a class="code" href="classParamDataReader.html#a2">00082</a> <a class="code" href="classParamDataReader.html#a2">ParamDataReader::getHeaderRecord</a>( <a class="code" href="structHeaderRecord.html">HeaderRecord</a> &amp;hdr ) {
00083 
00084     string hdrfile = getFilename() + <span class="stringliteral">".hdr"</span>;
00085     ifstream infile( hdrfile.c_str() );
00086     <span class="keywordtype">int</span> nadc;
00087 
00088     <span class="keywordflow">if</span> (infile.fail())
00089         <span class="keywordflow">throw</span> <a class="code" href="classCriticalAnalysisException.html">CriticalAnalysisException</a>(<span class="stringliteral">"Couldn't open the header file: "</span>+hdrfile);
00090 
00091     infile &gt;&gt; _datasize 
00092            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o2">ra</a> 
00093            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o3">dec</a>
00094            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o4">starttime</a>
00095            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o5">endtime</a>
00096            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o6">average_elevation</a>
00097            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o8">sourcename</a>
00098            &gt;&gt; hdr.<a class="code" href="structHeaderRecord.html#o0">num_telescopes</a>;
00099     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;hdr.<a class="code" href="structHeaderRecord.html#o0">num_telescopes</a>; i++) {
00100         infile &gt;&gt; nadc;
00101         hdr.<a class="code" href="structHeaderRecord.html#o1">nadc</a>.push_back(nadc);
00102     }
00103    
00104     infile.close();
00105 
00106 }
00107 
00108 <span class="keywordtype">bool</span>
00109 ParamDataReader::isDone() {
00110 
00111     <span class="keywordflow">if</span> (_currow &lt; _datasize-1) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00112     <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">true</span>;
00113 
00114 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:45 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
