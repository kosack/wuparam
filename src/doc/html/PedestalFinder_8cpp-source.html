<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>wuparam: PedestalFinder.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>PedestalFinder.cpp</h1><div class="fragment"><pre>00001 <span class="comment">// PedestalFinder</span>
00002 <span class="comment">// Karl Kosack &lt;kosack@hbar.wustl.edu&gt;</span>
00003 
00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
00005 <span class="preprocessor">#include &lt;fstream&gt;</span>
00006 <span class="preprocessor">#include &lt;string&gt;</span>
00007 <span class="preprocessor">#include &lt;valarray&gt;</span>
00008 <span class="preprocessor">#include &lt;list&gt;</span>
00009 <span class="preprocessor">#include &lt;vector&gt;</span>
00010 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00011 
00012 <span class="preprocessor">#include "Exceptions.h"</span>
00013 <span class="preprocessor">#include "DataReader.h"</span>
00014 <span class="preprocessor">#include "Camera.h"</span>
00015 <span class="preprocessor">#include "Config.h"</span>
00016 <span class="preprocessor">#include "ProgressBar.h"</span>
00017 <span class="preprocessor">#include "PedestalFinder.h"</span>
00018 <span class="preprocessor">#include "PlotMaker.h"</span>
00019 <span class="preprocessor">#include "Log.h"</span>
00020 
00021 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00022 
00023 <span class="comment">//#define DEBUG_PEDS</span>
00024 
00025 <span class="keywordtype">void</span>
00026 PedestalFinder::
00027 getOnSourcePeds( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri, vector&lt;Pedestal&gt; &amp;peds, <span class="keywordtype">int</span> telescope_id ) {
00028     <a class="code" href="classPedestalFinder.html#a4">getPeds</a>( ri,ri.<a class="code" href="classRunInfo.html#o4">onid</a>,peds,telescope_id );
00029 }
00030 
00031 <span class="keywordtype">void</span> 
00032 PedestalFinder::
00033 getOffSourcePeds( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri, vector&lt;Pedestal&gt; &amp;peds, <span class="keywordtype">int</span> telescope_id ) {
00034     <a class="code" href="classPedestalFinder.html#a4">getPeds</a>( ri,ri.<a class="code" href="classRunInfo.html#o5">offid</a>,peds,telescope_id );
00035 }
00036 
00037 
00044 <span class="keywordtype">void</span>
00045 <a class="code" href="classPedestalFinder.html#a5">PedestalFinder::</a>
<a name="l00046"></a><a class="code" href="classPedestalFinder.html#a5">00046</a> <a class="code" href="classPedestalFinder.html#a5">setTubeOffThresholds</a>( <span class="keywordtype">double</span> lower, <span class="keywordtype">double</span> upper ) {
00047 
00048     _upthresh = upper;
00049     _lowthresh = lower;
00050 
00051 }
00052 
00053 
00066 <span class="keywordtype">void</span>
<a name="l00067"></a><a class="code" href="classPedestalFinder.html#a4">00067</a> <a class="code" href="classPedestalFinder.html#a4">PedestalFinder::getPeds</a>( <a class="code" href="classRunInfo.html">RunInfo</a> &amp;ri,  <span class="keyword">const</span> string &amp;id, 
00068                          vector&lt;Pedestal&gt; &amp;peds, <span class="keywordtype">int</span> telescope_id ) {
00069 
00070     <span class="keyword">register</span> <span class="keywordtype">int</span> i;
00071     <a class="code" href="classRawDataReader.html">RawDataReader</a> *data = NULL;
00072     <span class="keywordtype">char</span> telstring[50];
00073     sprintf( telstring, <span class="stringliteral">"%03d"</span>, telescope_id );
00074     string pedsfilename = ri.<a class="code" href="classRunInfo.html#o2">cachedir</a>+id+<span class="stringliteral">"-"</span>+telstring+<span class="stringliteral">".peds"</span>;
00075     ifstream infile;
00076     <span class="keywordtype">int</span> nadc=0, goodnadc=0,n=0, count=0, progcount=0;
00077     Array_t peds2;
00078     <span class="keywordtype">int</span> ntubesoff=0;
00079     RawHeaderRecord header;
00080     <a class="code" href="structRawEventRecord.html">RawEventRecord</a> event;
00081     list&lt;int&gt; startubes;
00082     list&lt;int&gt; offtubes;
00083     <span class="keywordtype">double</span> d2;
00084     <span class="keywordtype">bool</span> badeventflag;
00085     <span class="keywordtype">int</span> badeventcount=0;
00086     <span class="keywordtype">char</span> temp;
00087     vector&lt;int&gt; badpixel;
00088     <span class="keywordtype">int</span> dtype;
00089     <span class="keywordtype">int</span> windowsize;  <span class="comment">//added charge integration window size, for calculating _badpedthresh.</span>
00090     <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00091 
00092     <span class="comment">//===========================================================</span>
00093     <span class="comment">// Check if the pedestals already exist. </span>
00094 
00095     infile.open( pedsfilename.c_str(), ios::in  );
00096     <span class="keywordflow">if</span> (infile) {
00097 
00098         <span class="comment">//---------------------------------------------</span>
00099         <span class="comment">// READ IN PEDESTALS, SINCE THEY EXIST</span>
00100 
00101         readPeds( pedsfilename, peds );
00102 
00103         infile.close(); 
00104         <span class="keywordflow">return</span>;
00105         
00106     }
00107     
00108     <span class="keywordflow">else</span> { 
00109 
00110         <span class="comment">//---------------------------------------------</span>
00111         <span class="comment">// CALCULATE PEDESTALS SINCE THEY DON'T EXIST:</span>
00112 
00113 
00114         cout &lt;&lt; <span class="stringliteral">"PedestalFinder: Calculating telescope "</span>
00115              &lt;&lt;telescope_id&lt;&lt;<span class="stringliteral">" pedestals for "</span> &lt;&lt; id 
00116              &lt;&lt; <span class="stringliteral">" in "</span> &lt;&lt; ri.<a class="code" href="classRunInfo.html#o2">cachedir</a> 
00117              &lt;&lt; <span class="stringliteral">"..."</span>&lt;&lt; endl;
00118 
00119         <span class="comment">// Open the datafile</span>
00120 
00121         <a class="code" href="classRawDataReaderFactory.html">RawDataReaderFactory</a> *datafactory = <a class="code" href="classRawDataReaderFactory.html#e0">RawDataReaderFactory::instance</a>();
00122         
00123         <span class="keywordflow">try</span> {
00124             
00125             data = datafactory-&gt;<a class="code" href="classRawDataReaderFactory.html#a0">getReader</a>( ri, id );
00126             
00127         }
00128         <span class="keywordflow">catch</span> (<a class="code" href="classAnalysisException.html">AnalysisException</a> &amp;e) {
00129             <span class="keyword">delete</span> data;
00130             <span class="keywordflow">throw</span> (e);
00131         } 
00132         
00133         <span class="keywordtype">int</span> datasize = data-&gt;<a class="code" href="classRawDataReader.html#a3">size</a>();
00134         <a class="code" href="classProgressBar.html">ProgressBar</a> progress( datasize, <span class="stringliteral">"Pedestal"</span> );
00135 
00136         
00137         dtype = data-&gt;<a class="code" href="classRawDataReader.html#a5">getType</a>();
00138         data-&gt;<a class="code" href="classRawDataReader.html#a1">getHeaderRecord</a>( header );
00139         <span class="keywordflow">if</span> (telescope_id &gt;= header.num_telescopes ) {
00140             cout &lt;&lt; <span class="stringliteral">"PedestalFinder: WARNING: telescope "</span>&lt;&lt;telescope_id
00141                  &lt;&lt; <span class="stringliteral">" is not in the data file's header!"</span>&lt;&lt;endl;
00142             cout &lt;&lt; <span class="stringliteral">"Since the number is pixels is unknown, I'll try 490."</span>
00143                  &lt;&lt; endl;
00144             nadc = 490;
00145         }
00146         <span class="keywordflow">else</span> {
00147             nadc = header.nadc[telescope_id];
00148         }
00149 
00150         windowsize = header.windowsize;
00151 
00152         goodnadc = nadc;
00153         <span class="keywordflow">if</span> (nadc == 492) goodnadc = 379; <span class="comment">// hack to not include outer tubes!</span>
00154         <span class="keywordflow">if</span> (nadc == 120) goodnadc = 109; <span class="comment">// hack for 109 camera+extra tubes</span>
00155 
00156 
00157         <span class="keywordflow">if</span> (nadc == 499) _badpedthresh = 30*windowsize; 
00158         <span class="comment">// hack to increase bad ped threshold for T1 camera.</span>
00159         
00160 
00161 
00162         peds.resize(goodnadc);
00163         peds2.resize(goodnadc);
00164         badpixel.resize(goodnadc);
00165         <a class="code" href="structPedestal.html">Pedestal</a> zero = {0,0,0};
00166         
00167         <span class="keywordflow">for</span> (i=0; i&lt;goodnadc; i++){
00168             peds[i] = zero;
00169             peds2[i] = 0.0;
00170             badpixel[i] = 0;
00171         }
00172 
00173 
00174 <span class="preprocessor">#ifdef DEBUG_PEDS                       </span>
00175 <span class="preprocessor"></span>        <span class="comment">// for debugging:</span>
00176         <span class="comment">//if (nadc == 499) Camera cam( "veritas_499.camera" );</span>
00177         <a class="code" href="classCamera.html">Camera</a> cam( <span class="stringliteral">"490.camera"</span> );
00178         vector&lt;int&gt; cleanpixels;
00179         vector&lt;Pedestal&gt; dummypeds;
00180         dummypeds.resize( nadc );
00181         <span class="keywordflow">for</span> ( i=0; i&lt;nadc; i++){
00182             dummypeds[i].pedestal = 0.0;
00183             dummypeds[i].dispersion = 0.0;
00184             dummypeds[i].type = Pedestal::GOOD;
00185         }
00186  
00187         <a class="code" href="classPlotMaker.html">PlotMaker</a> *pm  = <span class="keyword">new</span> <a class="code" href="classPlotMaker.html">PlotMaker</a>( <span class="stringliteral">"X"</span>, <span class="stringliteral">"x.out"</span>,
00188                                         cam.<a class="code" href="classCamera.html#a16">getMinX</a>() - 0.4, 
00189                                         cam.<a class="code" href="classCamera.html#a17">getMinY</a>() - 0.4, 
00190                                         cam.<a class="code" href="classCamera.html#a18">getMaxX</a>() + 0.4, 
00191                                         cam.<a class="code" href="classCamera.html#a19">getMaxY</a>() + 0.4 
00192                                         );
00193         pm-&gt;<a class="code" href="classPlotMaker.html#a2">setAxisBox</a>( cam );
00194         pm-&gt;<a class="code" href="classPlotMaker.html#a33">setPixelScale</a>( 100 );
00195         <span class="comment">// end</span>
00196 <span class="preprocessor">#endif</span>
00197 <span class="preprocessor"></span>
00198         <span class="comment">// Go through each event in data.  If event is a pedestal,</span>
00199         <span class="comment">// accumulate it...</span>
00200 
00201         <span class="keywordflow">while</span> (data-&gt;<a class="code" href="classRawDataReader.html#a6">isDone</a>() == <span class="keyword">false</span>) {
00202 
00203             <span class="keywordflow">try</span> {
00204                 data-&gt;<a class="code" href="classRawDataReader.html#a2">getNextEventRecord</a>( event );
00205             }
00206             <span class="keywordflow">catch</span> (<a class="code" href="classEOFException.html">EOFException</a> e) {
00207                 <span class="keywordflow">break</span>;
00208             }
00209 
00210 <span class="preprocessor">#ifdef DEBUG_PEDS           </span>
00211 <span class="preprocessor"></span>            <span class="comment">// display for debugging:</span>
00212             pm-&gt;<a class="code" href="classPlotMaker.html#a20">plot</a>( cam, event.<a class="code" href="structRawEventRecord.html#o7">adc</a>, dummypeds, cleanpixels );
00213 <span class="preprocessor">#endif      </span>
00214 <span class="preprocessor"></span>
00215             <span class="keywordflow">if</span> (event.<a class="code" href="structRawEventRecord.html#o0">type</a> == RawDataReader::PEDESTAL 
00216                 &amp;&amp; event.<a class="code" href="structRawEventRecord.html#o6">telescope_id</a>==telescope_id) {
00217 
00218 <span class="preprocessor">#ifdef DEBUG_PEDS           </span>
00219 <span class="preprocessor"></span>                pm-&gt;<a class="code" href="classPlotMaker.html#a11">plotAxes</a>();
00220 <span class="preprocessor">#endif</span>
00221 <span class="preprocessor"></span>
00222                 <span class="comment">// check if any pixel in the event exceeds a</span>
00223                 <span class="comment">// threshold, if so skip it! (this gets rid of</span>
00224                 <span class="comment">// accidental nitrogen pulses that slip into the</span>
00225                 <span class="comment">// pedestal events</span>
00226                 
00227                 badeventflag=<span class="keyword">false</span>;
00228 
00229                 <span class="keywordflow">for</span> (i=0; i&lt;goodnadc; i++) {
00230 
00231                     <span class="keywordflow">if</span> (event.<a class="code" href="structRawEventRecord.html#o7">adc</a>[i] &gt; _badpedthresh){
00232                         badeventflag = <span class="keyword">true</span>;
00233                         badpixel[i]++;
00234                     }
00235 
00236                 }
00237 
00238                 <span class="comment">// Accumulate pedestal if it's a good event</span>
00239 
00240                 <span class="keywordflow">if</span> (badeventflag == <span class="keyword">false</span> ){
00241                     <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++) {
00242                         peds[i].pedestal += event.<a class="code" href="structRawEventRecord.html#o7">adc</a>[i];
00243                         peds2[i] += (event.<a class="code" href="structRawEventRecord.html#o7">adc</a>[i]*event.<a class="code" href="structRawEventRecord.html#o7">adc</a>[i]);
00244                     }
00245                     n++;
00246                 }
00247                 <span class="keywordflow">else</span> {
00248                     badeventcount++;
00249                 }
00250 
00251 
00252             }
00253 
00254             <span class="comment">// update progressbar</span>
00255             <span class="keywordflow">if</span> (progcount == 512 || progcount == 0) { 
00256                 progress.<a class="code" href="classProgressBar.html#a2">print</a>( count );
00257                 progcount = 0;
00258             }
00259             progcount++;
00260 
00261             count++;
00262 
00263             <span class="keywordflow">if</span> (count &gt; ri.<a class="code" href="classRunInfo.html#o33">max_ped_events</a>) {
00264                 cout &lt;&lt; <span class="stringliteral">"PedestalFinder: bailed out after "</span>&lt;&lt;ri.<a class="code" href="classRunInfo.html#o33">max_ped_events</a>
00265                      &lt;&lt;<span class="stringliteral">" events"</span>&lt;&lt; endl;
00266                 <span class="keywordflow">break</span>;
00267             }
00268 
00269 
00270 <span class="preprocessor">#ifdef DEBUG_PEDS           </span>
00271 <span class="preprocessor"></span>            cout &lt;&lt; <span class="stringliteral">"DEBUG: ped event "</span>&lt;&lt; n &lt;&lt; <span class="stringliteral">" total events "</span> 
00272                  &lt;&lt; count &lt;&lt;endl;
00273             pm-&gt;<a class="code" href="classPlotMaker.html#a7">newPage</a>();
00274             cout &lt;&lt; <span class="stringliteral">"NEXT EVENT?"</span>;
00275             cin &gt;&gt; temp;
00276 <span class="preprocessor">#endif      </span>
00277 <span class="preprocessor"></span>
00278             
00279         }
00280         
00281         progress.<a class="code" href="classProgressBar.html#a3">printClear</a>();
00282 
00283         <span class="comment">// Output warning messages when there may be bad pixels</span>
00284         cout &lt;&lt; <span class="stringliteral">"PedestalFinder: events with pixels above 'bad' threshold: "</span>
00285              &lt;&lt; badeventcount &lt;&lt; endl;
00286         <span class="keywordflow">if</span> (badeventcount&gt;0){
00287             <span class="keywordflow">for</span> (i=0; i&lt;goodnadc; i++) {
00288                 <span class="keywordflow">if</span> (badpixel[i] &gt; 3) {
00289                     logger-&gt;<a class="code" href="classLogger.html#a0">printf</a>(<span class="stringliteral">"PedestalFinder (%s): pixel %d had high peds in %d events (it may be bad)"</span>, id.c_str(), i, badpixel[i]); 
00290                 }
00291             }
00292         }
00293 
00294 
00295         <span class="keywordflow">if</span> (n&gt;0) {
00296             <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++) {
00297                 peds[i].pedestal /= (<span class="keywordtype">double</span>)n;
00298                 peds2[i] /= (<span class="keywordtype">double</span>)n;
00299             }
00300         }
00301         <span class="keywordflow">else</span> {
00302 
00303             logger-&gt;<a class="code" href="classLogger.html#a0">printf</a>(<span class="stringliteral">"PedestalFinder (%s): There were no pedestal"</span>
00304                            <span class="stringliteral">" events in the data!"</span>, id.c_str());
00305             
00306         }
00307 
00308         <span class="keyword">delete</span> data;
00309         
00310         <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++){
00311             d2 = peds2[i] - pow(peds[i].pedestal,2);
00312             peds[i].dispersion = d2&gt;=0? sqrt(d2) : 0;
00313         }
00314         
00315         <span class="comment">// now peds contains the correct pedestals and dispersions</span>
00316         
00317         <span class="comment">//----------------------------------------------------</span>
00318         <span class="comment">// Check for tubes which are off or malfunctioning:</span>
00319         <span class="comment">// (Simulations have no pedvars as of yet, so don't turn tubes</span>
00320         <span class="comment">// off for them)</span>
00321     
00322         <span class="comment">// First we want to calculate the median, 1/4 median, and 3/4</span>
00323         <span class="comment">// median points of the pedestal dispersions.  To do this, we</span>
00324         <span class="comment">// need to sort the list of dispersions.  upperlimit will be</span>
00325         <span class="comment">// the 3/4 median value times the _upthresh and lowerlimit is</span>
00326         <span class="comment">// the 1/4 median value times the _lowthresh</span>
00327 
00328         <span class="keywordtype">double</span> median, lowerlimit, upperlimit;
00329         vector&lt;double&gt; disps;
00330         <span class="keywordtype">int</span> midpoint;
00331         disps.resize( peds.size() );
00332         <span class="keywordflow">for</span> (i=0; i&lt;peds.size(); i++)  disps[i] = peds[i].dispersion;
00333         sort( disps.begin(), disps.end() );
00334 
00335         midpoint = static_cast&lt;int&gt;(rint((static_cast&lt;double&gt;(disps.size())/2.0)));
00336 
00337         median = disps[midpoint];
00338         lowerlimit = median * _lowthresh;
00339         upperlimit = median * _upthresh;
00340         cout &lt;&lt; <span class="stringliteral">"PedestalFinder: median pedestal dispersion is "</span>
00341              &lt;&lt; median &lt;&lt; endl;
00342         
00343         <span class="comment">// Now, go through the tubes and mark them as good, or off</span>
00344 
00345         <span class="keywordflow">if</span> (dtype != RawDataReader::SIM ) {
00346             cout &lt;&lt; <span class="stringliteral">"PedestalFinder: threshold range = ("</span>&lt;&lt;lowerlimit&lt;&lt; <span class="stringliteral">","</span>
00347                  &lt;&lt;upperlimit &lt;&lt;<span class="stringliteral">")"</span> &lt;&lt; endl;
00348             
00349             <span class="keywordflow">for</span> (i=0; i&lt;(<span class="keywordtype">int</span>)peds.size(); i++ ) {
00350                 
00351                 <span class="keywordflow">if</span> (peds[i].dispersion &lt; lowerlimit) {
00352                     offtubes.push_back(i);
00353                     peds[i].type = Pedestal::TUBEOFF; <span class="comment">// mark as off</span>
00354                     ntubesoff++;
00355                 }  
00356                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (peds[i].dispersion &gt;= upperlimit) {
00357                     startubes.push_back(i);
00358                     peds[i].type = Pedestal::STAR; <span class="comment">// mark as star</span>
00359                     ntubesoff++;
00360                 }
00361                 <span class="keywordflow">else</span> {
00362                     peds[i].type == Pedestal::GOOD;
00363                 }
00364 
00365             }
00366         }
00367 
00368         <span class="comment">// Print out the off tubes:</span>
00369         
00370         startubes.sort();
00371         offtubes.sort();
00372         
00373         cout &lt;&lt; endl;
00374         list&lt;int&gt;::iterator tube;
00375         cout &lt;&lt; <span class="stringliteral">"The following tubes were shut off due to excess brightness"</span>
00376              &lt;&lt; <span class="stringliteral">" (i.e. a star):"</span>&lt;&lt;endl;
00377         cout &lt;&lt; <span class="stringliteral">"-----------------------------------------"</span>
00378              &lt;&lt; <span class="stringliteral">"-----------------------------"</span> &lt;&lt; endl;
00379         <span class="keywordflow">for</span> (tube=startubes.begin(); tube != startubes.end(); tube++) {
00380             cout &lt;&lt; *tube &lt;&lt; <span class="stringliteral">" "</span>;
00381         }
00382         cout &lt;&lt; endl &lt;&lt; endl;
00383         cout &lt;&lt; <span class="stringliteral">"The following tubes appear to have been turned off "</span>
00384              &lt;&lt; <span class="stringliteral">"manually: "</span>&lt;&lt;endl;
00385         cout &lt;&lt; <span class="stringliteral">"-----------------------------------------"</span>
00386              &lt;&lt; <span class="stringliteral">"-----------------------------"</span> &lt;&lt; endl;
00387         <span class="keywordflow">for</span> (tube=offtubes.begin(); tube != offtubes.end(); tube++) {
00388             cout &lt;&lt; *tube &lt;&lt; <span class="stringliteral">" "</span>;
00389         }
00390         cout &lt;&lt; endl &lt;&lt; endl;
00391 
00392 
00393         cout &lt;&lt; endl&lt;&lt; <span class="stringliteral">"PedestalFinder: "</span> &lt;&lt; ntubesoff &lt;&lt; <span class="stringliteral">" of "</span> &lt;&lt; nadc 
00394              &lt;&lt; <span class="stringliteral">" tubes were shut off."</span> &lt;&lt; endl;
00395 
00396         <span class="comment">//---------------------------------------------</span>
00397         <span class="comment">// write pedestals to disk:</span>
00398         
00399         writePeds(pedsfilename, peds);
00400 
00401         cout &lt;&lt; <span class="stringliteral">"PedestalFinder: Done calculating pedestals for "</span> 
00402              &lt;&lt; id &lt;&lt; endl;
00403         cout &lt;&lt; <span class="stringliteral">"PedestalFinder: total pedestal events: "</span>&lt;&lt; n &lt;&lt; endl;
00404         cout &lt;&lt; endl;
00405 
00406     }
00407 
00408 }
00409 
00410 
00411 <span class="keywordtype">void</span>
00412 PedestalFinder::writePeds( string &amp;filename, vector&lt;Pedestal&gt; &amp;peds ) {
00413 
00414     ofstream outfile;
00415 
00416     outfile.open(filename.c_str(), ios::out);
00417     <span class="keywordflow">if</span> (!outfile) {
00418 
00419         cout &lt;&lt; <span class="stringliteral">"*** Couldn't open "</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">" for writing!"</span> &lt;&lt; endl;
00420 
00421     }
00422     <span class="keywordflow">else</span> {
00423 
00424         outfile &lt;&lt; peds.size() &lt;&lt; endl;
00425         
00426         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;(<span class="keywordtype">int</span>)peds.size(); i++) {
00427             outfile &lt;&lt; i 
00428                     &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; peds[i].pedestal 
00429                     &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; peds[i].dispersion 
00430                     &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; peds[i].type
00431                     &lt;&lt; endl;
00432         }
00433         
00434         outfile.close();
00435 
00436     }
00437 
00438 
00439 }
00440 
00441 
00442 <span class="keywordtype">void</span>
00443 PedestalFinder::readPeds( string &amp;filename, vector&lt;Pedestal&gt; &amp;peds ) {
00444 
00445     ifstream infile(filename.c_str());
00446     <span class="keywordtype">int</span> n;
00447     <span class="keywordtype">int</span> id;
00448     <a class="code" href="classLogger.html">Logger</a> *logger = Logger::instance();
00449 
00450     <span class="keywordflow">if</span> (!infile) {
00451         
00452         <span class="comment">// shouldn't ever get here since we already tried opening...</span>
00453         cout &lt;&lt; <span class="stringliteral">"PedestalFinder::readPeds() Couldn't read pedestal file: "</span>
00454              &lt;&lt; filename&lt;&lt; endl;
00455         exit(1);
00456 
00457     }
00458 
00459 
00460     infile &gt;&gt; n;
00461     peds.resize(n);
00462 
00463     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;n; i++) {
00464         
00465         infile &gt;&gt; id 
00466                &gt;&gt; peds[i].pedestal 
00467                &gt;&gt; peds[i].dispersion
00468                &gt;&gt; peds[i].type;
00469 
00470         <span class="keywordflow">if</span> (id != i) {
00471             logger-&gt;<a class="code" href="classLogger.html#a0">printf</a>(<span class="stringliteral">"PedestalFinder (%s): tube %d seems to be "</span>
00472                            <span class="stringliteral">"misnumbered in the cache file"</span>, 
00473                            filename.c_str(), id);
00474                 
00475         }
00476 
00477     }
00478     
00479     infile.close();
00480 
00481 }
00482 
00483 
00484 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Apr 21 10:22:45 2007 for wuparam by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
